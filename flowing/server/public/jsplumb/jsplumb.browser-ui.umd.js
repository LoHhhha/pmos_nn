/**
 * jsPlumb Community Edition v6.2.10
 * https://github.com/jsplumb/community-edition
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).jsPlumb={})}(this,(function(e){"use strict";function _typeof(e){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _getPrototypeOf(e){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(e){return e.__proto__||Object.getPrototypeOf(e)},_getPrototypeOf(e)}function _setPrototypeOf(e,t){return _setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(e,t){return e.__proto__=t,e},_setPrototypeOf(e,t)}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _possibleConstructorReturn(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?_assertThisInitialized(e):t}function _createSuper(e){var t=function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function _createSuperInternal(){var n,i=_getPrototypeOf(e);if(t){var r=_getPrototypeOf(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return _possibleConstructorReturn(this,n)}}function _get(e,t,n){return _get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function _get(e,t,n){var i=function _superPropBase(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=_getPrototypeOf(e)););return e}(e,t);if(i){var r=Object.getOwnPropertyDescriptor(i,t);return r.get?r.get.call(n):r.value}},_get(e,t,n||e)}function _slicedToArray(e,t){return function _arrayWithHoles(e){if(Array.isArray(e))return e}(e)||function _iterableToArrayLimit(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var i,r,o=[],a=!0,l=!1;try{for(n=n.call(e);!(a=(i=n.next()).done)&&(o.push(i.value),!t||o.length!==t);a=!0);}catch(e){l=!0,r=e}finally{try{a||null==n.return||n.return()}finally{if(l)throw r}}return o}(e,t)||_unsupportedIterableToArray(e,t)||function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _toConsumableArray(e){return function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}(e)||function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||_unsupportedIterableToArray(e)||function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function filterList(e,t,n){return"*"===e||(e.length>0?-1!==e.indexOf(t):!n)}function extend(e,t,n){var i,r=e=e||{},o=t=t||{};if(n)for(i=0;i<n.length;i++)r[n[i]]=o[n[i]];else for(i in o)r[i]=o[i];return e}function isNumber(e){return"[object Number]"===Object.prototype.toString.call(e)}function isString(e){return"string"==typeof e}function isBoolean(e){return"boolean"==typeof e}function isObject(e){return null!=e&&"[object Object]"===Object.prototype.toString.call(e)}function isDate(e){return"[object Date]"===Object.prototype.toString.call(e)}function isFunction(e){return"[object Function]"===Object.prototype.toString.call(e)}function clone(e){if(isString(e))return""+e;if(isBoolean(e))return!!e;if(isDate(e))return new Date(e.getTime());if(isFunction(e))return e;if(Array.isArray(e)){for(var t=[],n=0;n<e.length;n++)t.push(clone(e[n]));return t}if(isObject(e)){var i={};for(var r in e)i[r]=clone(e[r]);return i}return e}function merge(e,t,n,i){var r,o,a={},l={};for(n=n||[],i=i||[],o=0;o<n.length;o++)a[n[o]]=!0;for(o=0;o<i.length;o++)l[i[o]]=!0;var u=clone(e);for(o in t)if(null==u[o]||l[o])u[o]=t[o];else if(a[o])(r=[]).push.apply(r,Array.isArray(u[o])?u[o]:[u[o]]),r.push(t[o]),u[o]=r;else if(isString(t[o])||isBoolean(t[o])||isFunction(t[o])||isNumber(t[o]))u[o]=t[o];else if(Array.isArray(t[o]))r=[],Array.isArray(u[o])&&r.push.apply(r,u[o]),r.push.apply(r,t[o]),u[o]=r;else if(isObject(t[o]))for(var h in isObject(u[o])||(u[o]={}),t[o])u[o][h]=t[o][h];return u}function _areEqual(e,t){if(null!=e&&null==t)return!1;if((null==e||isString(e)||isBoolean(e)||isNumber(e))&&e!==t)return!1;if(Array.isArray(e)){if(!Array.isArray(t))return!1;if(!arraysEqual(e,t))return!1}else if(isObject(e)){if(!isObject(e))return!1;if(!objectsEqual(e,t))return!1}return!0}function arraysEqual(e,t){if(null==e&&null==t)return!0;if(null==e&&null!=t)return!1;if(null!=e&&null==t)return!1;if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(!_areEqual(e[n],t[n]))return!1;return!0}function objectsEqual(e,t){if(null==e&&null==t)return!0;if(null==e&&null!=t)return!1;if(null!=e&&null==t)return!1;for(var n in e){if(!_areEqual(e[n],t[n]))return!1}return!0}function functionChain(e,t,n){for(var i=0;i<n.length;i++){var r=n[i][0][n[i][1]].apply(n[i][0],n[i][2]);if(r===t)return r}return e}function populate(e,t,n,i){return function _one(e){if(null!=e){if(isString(e))return function getValue(e){var n=e.match(/(\${.*?})/g);if(null!=n)for(var i=0;i<n.length;i++){var r=t[n[i].substring(2,n[i].length-1)]||"";null!=r&&(e=e.replace(n[i],r))}if(null!=(n=e.match(/({{.*?}})/g)))for(var o=0;o<n.length;o++){var a=t[n[o].substring(2,n[o].length-2)]||"";null!=a&&(e=e.replace(n[o],a))}return e}(e);if(!isFunction(e)||i||null!=n&&0!==(e.name||"").indexOf(n)){if(Array.isArray(e)){for(var r=[],o=0;o<e.length;o++)r.push(_one(e[o]));return r}if(isObject(e)){var a={};for(var l in e)a[l]=_one(e[l]);return a}return e}return e(t)}}(e)}function forEach(e,t){if(!e)return null;for(var n=0;n<e.length;n++)t(e[n])}function findWithFunction(e,t){if(e)for(var n=0;n<e.length;n++)if(t(e[n]))return n;return-1}function findAllWithFunction(e,t){var n=[];if(e)for(var i=0;i<e.length;i++)t(e[i])&&n.push(i);return n}function getWithFunction(e,t){var n=findWithFunction(e,t);return-1===n?null:e[n]}function getAllWithFunction(e,t){return findAllWithFunction(e,t).map((function(t){return e[t]}))}function getFromSetWithFunction(e,t){var n=null;return e.forEach((function(e){t(e)&&(n=e)})),n}function setToArray(e){var t=[];return e.forEach((function(e){t.push(e)})),t}function removeWithFunction(e,t){var n=findWithFunction(e,t);return n>-1&&e.splice(n,1),-1!==n}function fromArray(e){if(null!=Array.fromArray)return Array.from(e);var t=[];return Array.prototype.push.apply(t,e),t}function remove(e,t){var n=e.indexOf(t);return n>-1&&e.splice(n,1),-1!==n}function addToDictionary(e,t,n,i){var r=e[t];return null==r&&(r=[],e[t]=r),r[i?"unshift":"push"](n),r}function suggest(e,t,n){return-1===e.indexOf(t)&&(n?e.unshift(t):e.push(t),!0)}for(var t=[],n=0;n<256;n++)t[n]=(n<16?"0":"")+n.toString(16);function uuid(){var e=4294967295*Math.random()|0,n=4294967295*Math.random()|0,i=4294967295*Math.random()|0,r=4294967295*Math.random()|0;return t[255&e]+t[e>>8&255]+t[e>>16&255]+t[e>>24&255]+"-"+t[255&n]+t[n>>8&255]+"-"+t[n>>16&15|64]+t[n>>24&255]+"-"+t[63&i|128]+t[i>>8&255]+"-"+t[i>>16&255]+t[i>>24&255]+t[255&r]+t[r>>8&255]+t[r>>16&255]+t[r>>24&255]}function rotatePoint(e,t,n){var i=e.x-t.x,r=e.y-t.y,o=Math.cos(n/360*Math.PI*2),a=Math.sin(n/360*Math.PI*2);return{x:i*o-r*a+t.x,y:r*o+i*a+t.y,cr:o,sr:a}}function fastTrim(e){if(null==e)return null;for(var t=e.replace(/^\s\s*/,""),n=/\s/,i=t.length;n.test(t.charAt(--i)););return t.slice(0,i+1)}function each(e,t){e=null==e.length||"string"==typeof e?[e]:e;for(var n=0;n<e.length;n++)t(e[n])}function map(e,t){for(var n=[],i=0;i<e.length;i++)n.push(t(e[i]));return n}var i;function log(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if("undefined"!=typeof console)try{var i=arguments[arguments.length-1];console.log(i)}catch(e){}}function sgn$1(e){return e<0?-1:e>0?1:0}function wrap(e,t,n){return function(){var i=null;try{null!=t&&(i=t.apply(this,arguments))}catch(e){log("jsPlumb function failed : "+e)}if(null!=e&&(null==n||i!==n))try{i=e.apply(this,arguments)}catch(e){log("wrapped function failed : "+e)}return i}}function getsert(e,t,n){return e.has(t)||e.set(t,n()),e.get(t)}function isAssignableFrom(e,t){for(var n=e.__proto__;null!=n;){if(n instanceof t)return!0;n=n.__proto__}return!1}function insertSorted(e,t,n,i){if(0===t.length)t.push(e);else{for(var r=i?-1:1,o=0,a=t.length,l=Math.floor((o+a)/2);a>o;){n(e,t[l])*r<0?a=l:o=l+1,l=Math.floor((o+a)/2)}t.splice(l,0,e)}}function matchesSelector$1(e,t,n){for(var i=(n=n||e.parentNode).querySelectorAll(t),r=0;r<i.length;r++)if(i[r]===e)return!0;return!1}function consume(e,t){e.stopPropagation?e.stopPropagation():e.returnValue=!1,!t&&e.preventDefault&&e.preventDefault()}function findParent(e,t,n,i){if(i&&matchesSelector$1(e,t,n))return e;for(e=e.parentNode;null!=e&&e!==n;){if(matchesSelector$1(e,t))return e;e=e.parentNode}}function getEventSource(e){return e.srcElement||e.target}function _getClassName(e){return null!=e.className?void 0===e.className.baseVal?e.className:e.className.baseVal:""}function _classManip(e,t,n){var i=null==t?[]:Array.isArray(t)?t:t.split(/\s+/),r=null==n?[]:Array.isArray(n)?n:n.split(/\s+/),o=_getClassName(e).split(/\s+/),a=function _oneSet(e,t){for(var n=0;n<t.length;n++)if(e)-1===o.indexOf(t[n])&&o.push(t[n]);else{var i=o.indexOf(t[n]);-1!==i&&o.splice(i,1)}};a(!0,i),a(!1,r),function _setClassName(e,t,n){t=fastTrim(t),void 0!==e.className.baseVal?e.className.baseVal=t:e.className=t;try{var i=e.classList;if(null!=i){for(;i.length>0;)i.remove(i.item(0));for(var r=0;r<n.length;r++)n[r]&&i.add(n[r])}}catch(e){log("WARN: cannot set class list",e)}}(e,o.join(" "),o)}function isNodeList(e){return!isString(e)&&!Array.isArray(e)&&null!=e.length&&null==e.documentElement&&null==e.nodeType}function getClass(e){return _getClassName(e)}function addClass(e,t){var n=function _one(e,t){null!=e&&null!=t&&t.length>0&&(e.classList?forEach(fastTrim(t).split(/\s+/),(function(t){e.classList.add(t)})):_classManip(e,t))};isNodeList(e)?forEach(e,(function(e){return n(e,t)})):n(e,t)}function hasClass(e,t){return e.classList?e.classList.contains(t):-1!==_getClassName(e).indexOf(t)}function removeClass(e,t){var n=function _one(e,t){null!=e&&null!=t&&t.length>0&&(e.classList?fastTrim(t).split(/\s+/).forEach((function(t){e.classList.remove(t)})):_classManip(e,null,t))};isNodeList(e)?forEach(e,(function(e){return n(e,t)})):n(e,t)}function toggleClass(e,t){var n=this,i=function _one(e,t){null!=e&&null!=t&&t.length>0&&(e.classList?e.classList.toggle(t):n.hasClass(e,t)?n.removeClass(e,t):n.addClass(e,t))};isNodeList(e)?forEach(e,(function(e){return i(e,t)})):i(e,t)}function createElement(e,t,n,i){return createElementNS(null,e,t,n,i)}function createElementNS(e,t,n,i,r){var o,a=null==e?document.createElement(t):document.createElementNS(e,t);for(o in n=n||{})a.style[o]=n[o];for(o in i&&(a.className=i),r=r||{})a.setAttribute(o,""+r[o]);return a}function offsetRelativeToRoot(e){var t=e.getBoundingClientRect(),n=document.body,i=document.documentElement,r=window.pageYOffset||i.scrollTop||n.scrollTop,o=window.pageXOffset||i.scrollLeft||n.scrollLeft,a=i.clientTop||n.clientTop||0,l=i.clientLeft||n.clientLeft||0,u=t.top+r-a,h=t.left+o-l;return{x:Math.round(h),y:Math.round(u)}}function offsetSize(e){return{w:e.offsetWidth,h:e.offsetHeight}}function svgWidthHeightSize(e){try{return{w:parseFloat(e.width.baseVal.value),h:parseFloat(e.height.baseVal.value)}}catch(e){return{w:0,h:0}}}function svgXYPosition(e){try{return{x:parseFloat(e.x.baseVal.value),y:parseFloat(e.y.baseVal.value)}}catch(e){return{x:0,y:0}}}function getElementPosition(e,t){var n=t.getContainer().getBoundingClientRect(),i=e.getBoundingClientRect(),r=t.currentZoom;return{x:(i.left-n.left)/r,y:(i.top-n.top)/r}}function getElementSize(e,t){var n=e.getBoundingClientRect(),i=t.currentZoom;return{w:n.width/i,h:n.height/i}}function getElementType(t){return t instanceof SVGElement?e.ElementTypes.SVG:e.ElementTypes.HTML}function isSVGElement(t){return getElementType(t)===e.ElementTypes.SVG}function cls(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.map((function(e){return"."+e})).join(",")}function classList(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.join(" ")}function att(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.map((function(e){return"["+e+"]"})).join(",")}e.ElementTypes=void 0,(i=e.ElementTypes||(e.ElementTypes={})).SVG="SVG",i.HTML="HTML";var r="source",o="target",a="block",l="none",u="absolute",h="fixed",d="static",p="data-jtk-group",v="data-jtk-managed",g="data-jtk-not-draggable",_="tabindex",m="data-jtk-scope",E=m+"-",P="checkCondition",C="checkDropAllowed",T="jtk-connector",b="jtk-connector-outline",S="jtk-connected",k="jtk-endpoint",I="jtk-endpoint-connected",A="jtk-endpoint-full",O="jtk-floating-endpoint",D="jtk-endpoint-drop-allowed",w="jtk-endpoint-drop-forbidden",M="jtk-endpoint-anchor",L="jtk-group-collapsed",G="jtk-group-expanded",j="jtk-overlay",N="anchor:changed",z="connection",F="internal.connection",R="connection:detach",B="connection:move",H="container:change",V="endpoint:replaced",U="internal.endpoint:unregistered",Y="internal.connection:detached",X="element:manage",W="group:added",q="group:collapse",J="group:expand",K="group:member:added",$="group:member:removed",Z="group:removed",Q="maxConnections",ee="group:nested:added",te="group:nested:removed",ne="element:unmanage",ie="zoom",re="isDetachAllowed",oe="beforeDrag",se="beforeDrop",ae="beforeDetach",le="beforeStartDetach",ce=att(v),ue="Cannot establish connection: source endpoint is full",he="Cannot establish connection: target endpoint is full",de="Cannot establish connection: source does not exist",pe="Cannot establish connection: target does not exist",fe="connectionOverlays",ye={"stroke-linejoin":"stroke-linejoin","stroke-dashoffset":"stroke-dashoffset","stroke-linecap":"stroke-linecap"},ve="stroke-dasharray",ge="dashstyle",_e="svg",me="path",Ee={svg:"http://www.w3.org/2000/svg"};function _attr(e,t){for(var n in t)e.setAttribute(n,""+t[n])}function _node(e,t){return(t=t||{}).version="1.1",t.xmlns=Ee.svg,createElementNS(Ee.svg,e,null,null,t)}function _pos(e){return"position:absolute;left:"+e[0]+"px;top:"+e[1]+"px"}function _applyStyles(e,t,n){if(t.setAttribute("fill",n.fill?n.fill:l),t.setAttribute("stroke",n.stroke?n.stroke:l),n.strokeWidth&&t.setAttribute("stroke-width",n.strokeWidth),n[ge]&&n.strokeWidth&&!n[ve]){var i=-1===n[ge].indexOf(",")?" ":",",r=n[ge].split(i),o="";forEach(r,(function(e){o+=Math.floor(e*n.strokeWidth)+i})),t.setAttribute(ve,o)}else n[ve]&&t.setAttribute(ve,n[ve]);for(var a in ye)n[a]&&t.setAttribute(ye[a],n[a])}function _appendAtIndex(e,t,n){e.childNodes.length>n?e.insertBefore(t,e.childNodes[n]):e.appendChild(t)}var Pe={attr:_attr,node:_node,ns:Ee};function compoundEvent(e,t,n){var i=[e,t];return n&&i.push(n),i.join(":")}var Ce,xe,Te="data-jtk-container",be="data-jtk-group-content",Se="data-jtk-enabled",ke="data-jtk-scope",Ie="endpoint",Ae="element",Oe="connection",De="div",we="click",Me="contextmenu",Le="dblclick",Ge="dbltap",je="focus",Ne="mousedown",ze="mouseenter",Fe="mouseexit",Re="mousemove",Be="mouseup",He="mouseout",Ve="mouseover",Ue="tap",Ye="touchstart",Xe="touchend",We="touchmove",qe="drag:move",Je="drag:stop",Ke="drag:start",$e="revert",Ze="connection:abort",Qe="connection:drag",et=compoundEvent(Ae,we),tt=compoundEvent(Ae,Le),nt=compoundEvent(Ae,Ge),it=compoundEvent(Ae,He),rt=compoundEvent(Ae,Ve),ot=compoundEvent(Ae,Re),st=compoundEvent(Ae,Be),at=compoundEvent(Ae,Ne),lt=compoundEvent(Ae,Me),ct=compoundEvent(Ae,Ue),ut=compoundEvent(Ie,we),ht=compoundEvent(Ie,Le),dt=compoundEvent(Ie,Ge),pt=compoundEvent(Ie,He),ft=compoundEvent(Ie,Ve),yt=compoundEvent(Ie,Be),vt=compoundEvent(Ie,Ne),gt=compoundEvent(Ie,Ue),mt=compoundEvent(Oe,we),Et=compoundEvent(Oe,Le),Pt=compoundEvent(Oe,Ge),Ct=compoundEvent(Oe,He),xt=compoundEvent(Oe,Ve),Tt=compoundEvent(Oe,Be),bt=compoundEvent(Oe,Ne),St=compoundEvent(Oe,Me),kt=compoundEvent(Oe,Ue),It="position",At=cls(T),Ot=cls(k),Dt=att(p),wt=att(be),Mt=cls(j);function EMPTY_BOUNDS(){return{xmin:1/0,xmax:-1/0,ymin:1/0,ymax:-1/0}}e.PerimeterAnchorShapes=void 0,(Ce=e.PerimeterAnchorShapes||(e.PerimeterAnchorShapes={})).Circle="Circle",Ce.Ellipse="Ellipse",Ce.Triangle="Triangle",Ce.Diamond="Diamond",Ce.Rectangle="Rectangle",Ce.Square="Square",e.AnchorLocations=void 0,(xe=e.AnchorLocations||(e.AnchorLocations={})).Assign="Assign",xe.AutoDefault="AutoDefault",xe.Bottom="Bottom",xe.BottomLeft="BottomLeft",xe.BottomRight="BottomRight",xe.Center="Center",xe.Continuous="Continuous",xe.ContinuousBottom="ContinuousBottom",xe.ContinuousLeft="ContinuousLeft",xe.ContinuousRight="ContinuousRight",xe.ContinuousTop="ContinuousTop",xe.ContinuousLeftRight="ContinuousLeftRight",xe.ContinuousTopBottom="ContinuousTopBottom",xe.Left="Left",xe.Perimeter="Perimeter",xe.Right="Right",xe.Top="Top",xe.TopLeft="TopLeft",xe.TopRight="TopRight";var Lt,Gt,jt=function(){function AbstractSegment(e){_classCallCheck(this,AbstractSegment),this.params=e,_defineProperty(this,"x1",void 0),_defineProperty(this,"x2",void 0),_defineProperty(this,"y1",void 0),_defineProperty(this,"y2",void 0),_defineProperty(this,"extents",{xmin:1/0,xmax:-1/0,ymin:1/0,ymax:-1/0}),_defineProperty(this,"type",void 0),this.x1=e.x1,this.y1=e.y1,this.x2=e.x2,this.y2=e.y2}return _createClass(AbstractSegment,[{key:"findClosestPointOnPath",value:function findClosestPointOnPath(e,t){return{d:1/0,x:null,y:null,l:null,x1:null,y1:null,x2:null,y2:null}}},{key:"lineIntersection",value:function lineIntersection(e,t,n,i){return[]}},{key:"boxIntersection",value:function boxIntersection(e,t,n,i){var r=[];return r.push.apply(r,this.lineIntersection(e,t,e+n,t)),r.push.apply(r,this.lineIntersection(e+n,t,e+n,t+i)),r.push.apply(r,this.lineIntersection(e+n,t+i,e,t+i)),r.push.apply(r,this.lineIntersection(e,t+i,e,t)),r}},{key:"boundingBoxIntersection",value:function boundingBoxIntersection(e){return this.boxIntersection(e.x,e.y,e.w,e.h)}}]),AbstractSegment}(),Nt="undefined",zt="default",Ft="true",Rt="false",Bt="*";function _touchAndList(e,t,n,i,r,o,a){return function _touchList(){var e=[];return e.push.apply(e,arguments),e.item=function(e){return this[e]},e}(function _touch(e,t,n,i,r,o,a){return new Touch({target:e,identifier:uuid(),pageX:t,pageY:n,screenX:i,screenY:r,clientX:o||i,clientY:a||r})}(e,t,n,i,r,o,a))}function matchesSelector(e,t,n){for(var i=(n=n||e.parentNode).querySelectorAll(t),r=0;r<i.length;r++)if(i[r]===e)return!0;return!1}function _t(e){return e.srcElement||e.target}function _pi(e,t,n,i){if(i){var r=e.composedPath?e.composedPath():e.path;if(void 0!==r&&r.indexOf)return{path:r,end:r.indexOf(n)};var o={path:[],end:-1};return function _one(e){o.path.push(e),e===n?o.end=o.path.length-1:null!=e.parentNode&&_one(e.parentNode)}(t),o}return{path:[t],end:1}}var Ht=1,Vt=!1,Ut=!1;function isTouchDevice(){return Vt||"ontouchstart"in document.documentElement||null!=navigator.maxTouchPoints&&navigator.maxTouchPoints>0}function isMouseDevice(){return Ut||"onmousedown"in document.documentElement}var Yt=(_defineProperty(Lt={},Ne,Ye),_defineProperty(Lt,Be,Xe),_defineProperty(Lt,Re,We),Lt);function _genLoc(e,t){if(null==e)return{x:0,y:0};var n=getTouch(touches(e),0);return{x:n[t+"X"],y:n[t+"Y"]}}function pageLocation(e){return _genLoc(e,"page")}function getTouch(e,t){return e.item?e.item(t):e[t]}function touches(e){return e.touches&&e.touches.length>0?e.touches:e.changedTouches&&e.changedTouches.length>0?e.changedTouches:e.targetTouches&&e.targetTouches.length>0?e.targetTouches:[e]}function touchCount(e){return touches(e).length}function _bind(e,t,n,i,r){if(_store(e,t,n),i.__tauid=n.__tauid,e.addEventListener)e.addEventListener(t,n,!1,r);else if(e.attachEvent){var o=t+n.__tauid;e["e"+o]=n,e[o]=function(){e["e"+o]&&e["e"+o](window.event)},e.attachEvent("on"+t,e[o])}}function _unbind(e,t,n){var i=this;null!=n&&_each$1(e,(function(r){if(function _unstore(e,t,n){if(e.__ta&&e.__ta[t]&&delete e.__ta[t][n.__tauid],n.__taExtra){for(var i=0;i<n.__taExtra.length;i++)_unbind(e,n.__taExtra[i][0],n.__taExtra[i][1]);n.__taExtra.length=0}n.__taUnstore&&n.__taUnstore()}(r,t,n),null!=n.__tauid)if(r.removeEventListener)r.removeEventListener(t,n,!1),isTouchDevice()&&Yt[t]&&r.removeEventListener(Yt[t],n,!1);else if(i.detachEvent){var o=t+n.__tauid;r[o]&&r.detachEvent("on"+t,r[o]),r[o]=null,r["e"+o]=null}n.__taTouchProxy&&_unbind(e,n.__taTouchProxy[1],n.__taTouchProxy[0])}))}function _each$1(e,t){if(null!=e)for(var n="string"==typeof e?document.querySelectorAll(e):null!=e.length?e:[e],i=0;i<n.length;i++)t(n[i])}function _store(e,t,n){var i=Ht++;return e.__ta=e.__ta||{},e.__ta[t]=e.__ta[t]||{},e.__ta[t][i]=n,n.__tauid=i,i}var Xt=/:not\(([^)]+)\)/;function _curryChildFilter(e,t,n,i){if(null==e)return n;var r=e.split(","),o=[],a=[];forEach(r,(function(e){var t=e.match(Xt);null!=t?a.push(t[1]):o.push(e)})),a.length>0&&0===o.length&&o.push(Bt);var l=function _fn(i){_fn.__tauid=n.__tauid;var r=_t(i),l=!1,u=r,h=_pi(i,r,t,null!=e);if(-1!=h.end)for(var d=0;!l&&d<h.end;d++){u=h.path[d];for(var p=0;p<a.length;p++)if(matchesSelector(u,a[p],t))return;for(var v=0;!l&&v<o.length;v++)if(matchesSelector(u,o[v],t)){n.apply(u,[i,u]),l=!0;break}}};return function registerExtraFunction(e,t,n){e.__taExtra=e.__taExtra||[],e.__taExtra.push([t,n])}(n,i,l),l}var Wt=function DefaultHandler(e,t,n,i,r){if(isTouchDevice()&&Yt[t]){var o=_curryChildFilter(i,e,n,Yt[t]);_bind(e,Yt[t],o,n,r)}t===je&&null==e.getAttribute(_)&&e.setAttribute(_,"1"),_bind(e,t,_curryChildFilter(i,e,n,t),n,r)},qt=(_defineProperty(Gt={},Ue,{touches:1,taps:1}),_defineProperty(Gt,Ge,{touches:1,taps:2}),_defineProperty(Gt,Me,{touches:2,taps:1}),Gt);function meeHelper(e,t,n,i){for(var r in n.__tamee[e])n.__tamee[e].hasOwnProperty(r)&&n.__tamee[e][r].apply(i,[t])}var Jt=function(){function TapHandler(){_classCallCheck(this,TapHandler)}return _createClass(TapHandler,null,[{key:"generate",value:function generate(e,t){return function(n,i,r,o){if(i==Me&&isMouseDevice())Wt(n,i,r,o);else{if(null==n.__taTapHandler){var a=n.__taTapHandler={tap:[],dbltap:[],down:!1,taps:0,downSelectors:[]},l=function down(i){for(var r=_t(i),l=_pi(i,r,n,null!=o),u=!1,p=0;p<l.end;p++){if(u)return;r=l.path[p];for(var v=0;v<a.downSelectors.length;v++)if(null==a.downSelectors[v]||matchesSelector(r,a.downSelectors[v],n)){a.down=!0,setTimeout(h,e),setTimeout(d,t),u=!0;break}}},u=function up(e){if(a.down){var t,i,r=_t(e);a.taps++;var o=touchCount(e);for(var l in qt)if(qt.hasOwnProperty(l)){var u=qt[l];if(u.touches===o&&(1===u.taps||u.taps===a.taps))for(var h=0;h<a[l].length;h++){i=_pi(e,r,n,null!=a[l][h][1]);for(var d=0;d<i.end;d++)if(t=i.path[d],null==a[l][h][1]||matchesSelector(t,a[l][h][1],n)){a[l][h][0].apply(t,[e,t]);break}}}}},h=function clearSingle(){a.down=!1},d=function clearDouble(){a.taps=0};n.__taTapHandler.downHandler=l,n.__taTapHandler.upHandler=u,Wt(n,Ne,l),Wt(n,Be,u)}n.__taTapHandler.downSelectors.push(o),n.__taTapHandler[i].push([r,o]),r.__taUnstore=function(){null!=n.__taTapHandler&&(removeWithFunction(n.__taTapHandler.downSelectors,(function(e){return e===o})),function _d(e,t){var n,i=0;for(i=0,n=e.length;i<n&&e[i][0]!==t;i++);i<e.length&&e.splice(i,1)}(n.__taTapHandler[i],r),0===n.__taTapHandler.downSelectors.length&&(_unbind(n,Ne,n.__taTapHandler.downHandler),_unbind(n,Be,n.__taTapHandler.upHandler),delete n.__taTapHandler))}}}}}]),TapHandler}(),Kt=function(){function MouseEnterExitHandler(){_classCallCheck(this,MouseEnterExitHandler)}return _createClass(MouseEnterExitHandler,null,[{key:"generate",value:function generate(){var e=[];return function(t,n,i,r){if(!t.__tamee){t.__tamee={over:!1,mouseenter:[],mouseexit:[]};var o=function over(n){var i=_t(n);(null==r&&i==t&&!t.__tamee.over||matchesSelector(i,r,t)&&(null==i.__tamee||!i.__tamee.over))&&(meeHelper(ze,n,t,i),i.__tamee=i.__tamee||{},i.__tamee.over=!0,e.push(i))},a=function out(n){for(var i=_t(n),r=0;r<e.length;r++)i!=e[r]||matchesSelector(n.relatedTarget||n.toElement,"*",i)||(i.__tamee.over=!1,e.splice(r,1),meeHelper(Fe,n,t,i))};_bind(t,Ve,_curryChildFilter(r,t,o,Ve),o),_bind(t,He,_curryChildFilter(r,t,a,He),a)}i.__taUnstore=function(){delete t.__tamee[n][i.__tauid]},_store(t,n,i),t.__tamee[n][i.__tauid]=i}}}]),MouseEnterExitHandler}(),$t=function(){function EventManager(e){_classCallCheck(this,EventManager),_defineProperty(this,"clickThreshold",void 0),_defineProperty(this,"dblClickThreshold",void 0),_defineProperty(this,"tapHandler",void 0),_defineProperty(this,"mouseEnterExitHandler",void 0),e=e||{},this.clickThreshold=e.clickThreshold||250,this.dblClickThreshold=e.dblClickThreshold||450,this.mouseEnterExitHandler=Kt.generate(),this.tapHandler=Jt.generate(this.clickThreshold,this.dblClickThreshold)}return _createClass(EventManager,[{key:"_doBind",value:function _doBind(e,t,n,i,r){if(null!=n){var o=e;t===Ue||t===Ge||t===Me?this.tapHandler(o,t,n,i,r):t===ze||t==Fe?this.mouseEnterExitHandler(o,t,n,i,r):Wt(o,t,n,i,r)}}},{key:"on",value:function on(e,t,n,i,r){var o=null==i?null:n,a=null==i?n:i;return this._doBind(e,t,a,o,r),this}},{key:"off",value:function off(e,t,n){return _unbind(e,t,n),this}},{key:"trigger",value:function trigger(e,t,n,i,r){var o=isMouseDevice()&&("undefined"==typeof MouseEvent||null==n||n.constructor===MouseEvent),a=isTouchDevice()&&!isMouseDevice()&&Yt[t]?Yt[t]:t,l=!(isTouchDevice()&&!isMouseDevice()&&Yt[t]),u=pageLocation(n),h=function screenLocation(e){return _genLoc(e,"screen")}(n),d=function clientLocation(e){return _genLoc(e,"client")}(n);return _each$1(e,(function(e){var p;n=n||{screenX:h.x,screenY:h.y,clientX:d.x,clientY:d.y};var v={TouchEvent:function TouchEvent(t){var n=_touchAndList(e,u.x,u.y,h.x,h.y,d.x,d.y);(t.initTouchEvent||t.initEvent)(a,!0,!0,window,null,h.x,h.y,d.x,d.y,!1,!1,!1,!1,n,n,n,1,0)},MouseEvents:function MouseEvents(t){t.initMouseEvent(a,!0,!0,window,null==r?1:r,h.x,h.y,d.x,d.y,!1,!1,!1,!1,1,e)}},g=!l&&!o&&isTouchDevice()&&Yt[t]?"TouchEvent":"MouseEvents";p=document.createEvent(g),v[g](p),function _decorate(e){i&&(e.payload=i)}(p),e.dispatchEvent(p)})),this}}]),EventManager}();var Zt=[null,[1,-1],[1,1],[-1,1],[-1,-1]],Qt=[null,[-1,-1],[-1,1],[1,1],[1,-1]],en=2*Math.PI;function gradient(e,t){return t.x===e.x?t.y>e.y?1/0:-1/0:t.y===e.y?t.x>e.x?0:-0:(t.y-e.y)/(t.x-e.x)}function normal(e,t){return-1/gradient(e,t)}function lineLength(e,t){return Math.sqrt(Math.pow(t.y-e.y,2)+Math.pow(t.x-e.x,2))}function quadrant(e,t){return t.x>e.x||t.x==e.x?t.y>e.y?2:1:t.y>e.y?3:4}function theta(e,t){var n=gradient(e,t),i=Math.atan(n),r=quadrant(e,t);return 4!=r&&3!=r||(i+=Math.PI),i<0&&(i+=2*Math.PI),i}function intersects(e,t){var n=e.x,i=e.x+e.w,r=e.y,o=e.y+e.h,a=t.x,l=t.x+t.w,u=t.y,h=t.y+t.h;return n<=a&&a<=i&&r<=u&&u<=o||n<=l&&l<=i&&r<=u&&u<=o||n<=a&&a<=i&&r<=h&&h<=o||n<=l&&a<=i&&r<=h&&h<=o||a<=n&&n<=l&&u<=r&&r<=h||a<=i&&i<=l&&u<=r&&r<=h||a<=n&&n<=l&&u<=o&&o<=h||a<=i&&n<=l&&u<=o&&o<=h}function toABC(e){var t=e[1].y-e[0].y,n=e[0].x-e[1].x;return{A:t,B:n,C:fixPrecision(t*e[0].x+n*e[0].y)}}function fixPrecision(e,t){return t=null==t?3:t,Math.floor(e*Math.pow(10,t))/Math.pow(10,t)}function lineIntersection(e,t){var n=toABC(e),i=toABC(t),r=n.A*i.B-i.A*n.B;if(0==r)return null;var o={x:Math.round((i.B*n.C-n.B*i.C)/r),y:Math.round((n.A*i.C-i.A*n.C)/r)},a=Math.floor(Math.min(e[0].x,e[1].x)),l=Math.round(Math.max(e[0].x,e[1].x)),u=Math.floor(Math.min(e[0].y,e[1].y)),h=Math.round(Math.max(e[0].y,e[1].y)),d=Math.floor(Math.min(t[0].x,t[1].x)),p=Math.round(Math.max(t[0].x,t[1].x)),v=Math.floor(Math.min(t[0].y,t[1].y)),g=Math.round(Math.max(t[0].y,t[1].y));return o.x>=a&&o.x<=l&&o.y>=u&&o.y<=h&&o.x>=d&&o.x<=p&&o.y>=v&&o.y<=g?o:null}function pointOnLine(e,t,n){var i=gradient(e,t),r=quadrant(e,t),o=n>0?Zt[r]:Qt[r],a=Math.atan(i),l=Math.abs(n*Math.sin(a))*o[1],u=Math.abs(n*Math.cos(a))*o[0];return{x:e.x+u,y:e.y+l}}function perpendicularLineTo(e,t,n){var i=gradient(e,t),r=Math.atan(-1/i),o=n/2*Math.sin(r),a=n/2*Math.cos(r);return[{x:t.x+a,y:t.y+o},{x:t.x-a,y:t.y-o}]}function snapToGrid(e,t,n,i){n=null==n?null==t.thresholdX?t.w/2:t.thresholdX:n,i=null==i?null==t.thresholdY?t.h/2:t.thresholdY:i;var r=Math.floor(e.x/t.w),o=t.w*r,a=o+t.w,l=Math.abs(e.x-o)<=n?o:Math.abs(a-e.x)<=n?a:e.x,u=Math.floor(e.y/t.h),h=t.h*u,d=h+t.h;return{x:l,y:Math.abs(e.y-h)<=i?h:Math.abs(d-e.y)<=i?d:e.y}}function findDelegateElement(e,t,n){if(matchesSelector$1(t,n,e))return t;for(var i=t.parentNode;null!=i&&i!==e;){if(matchesSelector$1(i,n,e))return i;i=i.parentNode}}function isInsideParent(e,t,n){var i=t.parentNode,r=e.getSize(i),o=e.getSize(t),a=n.x,l=a+o.w,u=n.y,h=u+o.h;return l>0&&a<r.w&&h>0&&u<r.h}var tn,nn="start",rn="beforeStart",sn="drag",an="drop",ln="over",cn="stop",un="katavorio-draggable",hn=function TRUE(){return!0},dn=function FALSE(){return!1},pn="katavorio-delegated-draggable",fn="katavorio-drag-no-select",yn="katavorio-ghost-proxy",vn="katavorio-clone-drag";e.PositioningStrategies=void 0,(tn=e.PositioningStrategies||(e.PositioningStrategies={})).absolutePosition="absolutePosition",tn.transform="transform",tn.xyAttributes="xyAttributes";var gn=new Map;gn.set(e.PositioningStrategies.absolutePosition,(function(e,t){e.style.left="".concat(t.x,"px"),e.style.top="".concat(t.y,"px")})),gn.set(e.PositioningStrategies.xyAttributes,(function(e,t){e.setAttribute("x","".concat(t.x)),e.setAttribute("y","".concat(t.y))}));var _n=new Map;_n.set(e.PositioningStrategies.absolutePosition,(function(e){return{x:e.offsetLeft,y:e.offsetTop}})),_n.set(e.PositioningStrategies.xyAttributes,(function(e){return{x:parseFloat(e.getAttribute("x")),y:parseFloat(e.getAttribute("y"))}}));var mn=new Map;mn.set(e.PositioningStrategies.absolutePosition,(function(e,t){e.style.width="".concat(t.w,"px"),e.style.height="".concat(t.h,"px")})),mn.set(e.PositioningStrategies.xyAttributes,(function(e,t){e.setAttribute("width","".concat(t.w)),e.setAttribute("height","".concat(t.h))}));var En=new Map;En.set(e.PositioningStrategies.absolutePosition,(function(e){return{w:e.offsetWidth,h:e.offsetHeight}})),En.set(e.PositioningStrategies.xyAttributes,(function(e){return{w:parseFloat(e.getAttribute("width")),h:parseFloat(e.getAttribute("height"))}}));var Pn,Cn=[cn,nn,sn,an,ln,"out",rn],xn=function _devNull(){},Tn=function _each(e,t){if(null!=e){e=isString(e)||null!=e.tagName||null==e.length?[e]:e;for(var n=0;n<e.length;n++)t.apply(e[n],[e[n]])}},bn=function(){function Base(e,t){_classCallCheck(this,Base),this.el=e,this.manager=t,_defineProperty(this,"_class",void 0),_defineProperty(this,"uuid",uuid()),_defineProperty(this,"enabled",!0),_defineProperty(this,"scopes",[]),_defineProperty(this,"eventManager",void 0),this.eventManager=t.eventManager}return _createClass(Base,[{key:"setEnabled",value:function setEnabled(e){this.enabled=e}},{key:"isEnabled",value:function isEnabled(){return this.enabled}},{key:"toggleEnabled",value:function toggleEnabled(){this.enabled=!this.enabled}},{key:"addScope",value:function addScope(e){var t={};for(var n in Tn(this.scopes,(function(e){t[e]=!0})),Tn(e?e.split(/\s+/):[],(function(e){t[e]=!0})),this.scopes.length=0,t)this.scopes.push(n)}},{key:"removeScope",value:function removeScope(e){var t={};for(var n in Tn(this.scopes,(function(e){t[e]=!0})),Tn(e?e.split(/\s+/):[],(function(e){delete t[e]})),this.scopes.length=0,t)this.scopes.push(n)}},{key:"toggleScope",value:function toggleScope(e){var t={};for(var n in Tn(this.scopes,(function(e){t[e]=!0})),Tn(e?e.split(/\s+/):[],(function(e){t[e]?delete t[e]:t[e]=!0})),this.scopes.length=0,t)this.scopes.push(n)}}]),Base}();e.ContainmentType=void 0,(Pn=e.ContainmentType||(e.ContainmentType={})).notNegative="notNegative",Pn.parent="parent",Pn.parentEnclosed="parentEnclosed";var Sn=function(e){_inherits(Drag,e);var t=_createSuper(Drag);function Drag(e,n,i){var r;if(_classCallCheck(this,Drag),_defineProperty(_assertThisInitialized(r=t.call(this,e,i)),"_class",void 0),_defineProperty(_assertThisInitialized(r),"rightButtonCanDrag",void 0),_defineProperty(_assertThisInitialized(r),"consumeStartEvent",void 0),_defineProperty(_assertThisInitialized(r),"clone",void 0),_defineProperty(_assertThisInitialized(r),"scroll",void 0),_defineProperty(_assertThisInitialized(r),"trackScroll",void 0),_defineProperty(_assertThisInitialized(r),"_downAt",void 0),_defineProperty(_assertThisInitialized(r),"_posAtDown",void 0),_defineProperty(_assertThisInitialized(r),"_pagePosAtDown",void 0),_defineProperty(_assertThisInitialized(r),"_pageDelta",{x:0,y:0}),_defineProperty(_assertThisInitialized(r),"_moving",void 0),_defineProperty(_assertThisInitialized(r),"_lastPosition",void 0),_defineProperty(_assertThisInitialized(r),"_lastScrollValues",{x:0,y:0}),_defineProperty(_assertThisInitialized(r),"_initialScroll",{x:0,y:0}),_defineProperty(_assertThisInitialized(r),"_size",void 0),_defineProperty(_assertThisInitialized(r),"_currentParentPosition",void 0),_defineProperty(_assertThisInitialized(r),"_ghostParentPosition",void 0),_defineProperty(_assertThisInitialized(r),"_dragEl",void 0),_defineProperty(_assertThisInitialized(r),"_multipleDrop",void 0),_defineProperty(_assertThisInitialized(r),"_ghostProxyOffsets",void 0),_defineProperty(_assertThisInitialized(r),"_ghostDx",void 0),_defineProperty(_assertThisInitialized(r),"_ghostDy",void 0),_defineProperty(_assertThisInitialized(r),"_isConstrained",!1),_defineProperty(_assertThisInitialized(r),"_ghostProxyParent",void 0),_defineProperty(_assertThisInitialized(r),"_useGhostProxy",void 0),_defineProperty(_assertThisInitialized(r),"_ghostProxyFunction",void 0),_defineProperty(_assertThisInitialized(r),"_activeSelectorParams",void 0),_defineProperty(_assertThisInitialized(r),"_availableSelectors",[]),_defineProperty(_assertThisInitialized(r),"_canDrag",void 0),_defineProperty(_assertThisInitialized(r),"_consumeFilteredEvents",void 0),_defineProperty(_assertThisInitialized(r),"_parent",void 0),_defineProperty(_assertThisInitialized(r),"_ignoreZoom",void 0),_defineProperty(_assertThisInitialized(r),"_filters",{}),_defineProperty(_assertThisInitialized(r),"_constrainRect",void 0),_defineProperty(_assertThisInitialized(r),"_elementToDrag",void 0),_defineProperty(_assertThisInitialized(r),"downListener",void 0),_defineProperty(_assertThisInitialized(r),"moveListener",void 0),_defineProperty(_assertThisInitialized(r),"upListener",void 0),_defineProperty(_assertThisInitialized(r),"scrollTracker",void 0),_defineProperty(_assertThisInitialized(r),"listeners",{start:[],drag:[],stop:[],over:[],out:[],beforeStart:[],revert:[]}),r._class=r.manager.css.draggable,addClass(r.el,r._class),r.downListener=r._downListener.bind(_assertThisInitialized(r)),r.upListener=r._upListener.bind(_assertThisInitialized(r)),r.moveListener=r._moveListener.bind(_assertThisInitialized(r)),r.rightButtonCanDrag=!0===n.rightButtonCanDrag,r.consumeStartEvent=!1!==n.consumeStartEvent,r._dragEl=r.el,r.clone=!0===n.clone,r.scroll=!0===n.scroll,r.trackScroll=!1!==n.trackScroll,r._multipleDrop=!1!==n.multipleDrop,r._canDrag=n.canDrag||hn,r._consumeFilteredEvents=n.consumeFilteredEvents,r._parent=n.parent,r._ignoreZoom=!0===n.ignoreZoom,r._ghostProxyParent=n.ghostProxyParent,r.trackScroll&&(r.scrollTracker=r._trackScroll.bind(_assertThisInitialized(r)),document.addEventListener("scroll",r.scrollTracker)),!0===n.ghostProxy?r._useGhostProxy=hn:n.ghostProxy&&"function"==typeof n.ghostProxy?r._useGhostProxy=n.ghostProxy:r._useGhostProxy=function(e,t){return!(!r._activeSelectorParams||!r._activeSelectorParams.useGhostProxy)&&r._activeSelectorParams.useGhostProxy(e,t)},n.makeGhostProxy?r._ghostProxyFunction=n.makeGhostProxy:r._ghostProxyFunction=function(e){return r._activeSelectorParams&&r._activeSelectorParams.makeGhostProxy?r._activeSelectorParams.makeGhostProxy(e):e.cloneNode(!0)},n.selector){var o=r.el.getAttribute(un);null==o&&(o=""+(new Date).getTime(),r.el.setAttribute("katavorio-draggable",o)),r._availableSelectors.push(n)}return r.eventManager.on(r.el,Ne,r.downListener),r}return _createClass(Drag,[{key:"_trackScroll",value:function _trackScroll(e){if(this._moving){var t={x:document.documentElement.scrollLeft,y:document.documentElement.scrollTop},n=t.x-this._lastScrollValues.x,i=t.y-this._lastScrollValues.y,r={x:n+this._lastPosition.x,y:i+this._lastPosition.y},o=r.x-this._downAt.x,a=r.y-this._downAt.y,l=this._ignoreZoom?1:this.manager.getZoom();this._dragEl&&this._dragEl.parentNode&&(o+=this._dragEl.parentNode.scrollLeft-this._initialScroll.x,a+=this._dragEl.parentNode.scrollTop-this._initialScroll.y),o/=l,a/=l,this.moveBy(o,a,e),this._lastPosition=r,this._lastScrollValues=t}}},{key:"on",value:function on(e,t){this.listeners[e]&&this.listeners[e].push(t)}},{key:"off",value:function off(e,t){if(this.listeners[e]){for(var n=[],i=0;i<this.listeners[e].length;i++)this.listeners[e][i]!==t&&n.push(this.listeners[e][i]);this.listeners[e]=n}}},{key:"_upListener",value:function _upListener(e){this._downAt&&(this._downAt=null,this.eventManager.off(document,Re,this.moveListener),this.eventManager.off(document,Be,this.upListener),removeClass(document.body,fn),this.unmark(e),this.stop(e),this._moving=!1,this.clone?(this._dragEl&&this._dragEl.parentNode&&this._dragEl.parentNode.removeChild(this._dragEl),this._dragEl=null):this._activeSelectorParams&&this._activeSelectorParams.revertFunction&&!0===this._activeSelectorParams.revertFunction(this._dragEl,this.manager.getPosition(this._dragEl))&&(this.manager.setPosition(this._dragEl,this._posAtDown),this._dispatch($e,this._dragEl)))}},{key:"_downListener",value:function _downListener(e){if(!e.defaultPrevented&&((this.rightButtonCanDrag||3!==e.which&&2!==e.button)&&this.isEnabled()&&this._canDrag())){var t=this._testFilter(e)&&function _inputFilter(e,t,n){return!matchesSelector$1(e.srcElement||e.target,n.getInputFilterSelector(),t)}(e,this.el,this.manager);if(t){this._activeSelectorParams=null,this._elementToDrag=null,0===this._availableSelectors.length&&console.log("JSPLUMB: no available drag selectors");var n=e.target||e.srcElement,i=function findMatchingSelector(e,t,n){for(var i=null,r=t.getAttribute("katavorio-draggable"),o=null!=r?"[katavorio-draggable='"+r+"'] ":"",a=0;a<e.length;a++)if(null!=(i=findDelegateElement(t,n,o+e[a].selector))){if(e[a].filter){var l=matchesSelector$1(n,e[a].filter,i);if(!0===e[a].filterExclude&&!l||l)return null}return[e[a],i]}return null}(this._availableSelectors,this.el,n);if(null!=i&&(this._activeSelectorParams=i[0],this._elementToDrag=i[1]),null==this._activeSelectorParams||null==this._elementToDrag)return;var r=this._activeSelectorParams.dragInit?this._activeSelectorParams.dragInit(this._elementToDrag,e):null;if(null!=r&&(this._elementToDrag=r),this.clone)if(this._dragEl=this._elementToDrag.cloneNode(!0),addClass(this._dragEl,vn),this._dragEl.setAttribute("id",null),this._dragEl.style.position="absolute",null!=this._parent){var o=this.manager.getPosition(this.el);this._dragEl.style.left=o.x+"px",this._dragEl.style.top=o.y+"px",this._parent.appendChild(this._dragEl)}else{var a=offsetRelativeToRoot(this._elementToDrag);this._dragEl.style.left=a.x+"px",this._dragEl.style.top=a.y+"px",document.body.appendChild(this._dragEl)}else this._dragEl=this._elementToDrag;this.consumeStartEvent&&consume(e),this._downAt=pageLocation(e),this._dragEl&&this._dragEl.parentNode&&(this._initialScroll={x:this._dragEl.parentNode.scrollLeft,y:this._dragEl.parentNode.scrollTop}),this._posAtDown=this.manager.getPosition(this._dragEl),this._pagePosAtDown=offsetRelativeToRoot(this._dragEl),this._pageDelta={x:this._pagePosAtDown.x-this._posAtDown.x,y:this._pagePosAtDown.y-this._posAtDown.y},this._size=this.manager.getSize(this._dragEl),this.eventManager.on(document,Re,this.moveListener),this.eventManager.on(document,Be,this.upListener),addClass(document.body,fn),this._dispatch(rn,{el:this.el,pos:this._posAtDown,e:e,drag:this,size:this._size})}else this._consumeFilteredEvents&&consume(e)}}},{key:"_moveListener",value:function _moveListener(e){if(this._downAt){if(!this._moving){var t=this._dispatch(nn,{el:this.el,pos:this._posAtDown,e:e,drag:this,size:this._size});if(!1!==t){if(!this._downAt)return;this.mark(t),this._moving=!0}else this.abort()}if(this._downAt){var n=pageLocation(e),i=n.x-this._downAt.x,r=n.y-this._downAt.y,o=this._ignoreZoom?1:this.manager.getZoom();this._lastPosition={x:n.x,y:n.y},this._lastScrollValues={x:document.documentElement.scrollLeft,y:document.documentElement.scrollTop},this._dragEl&&this._dragEl.parentNode&&(i+=this._dragEl.parentNode.scrollLeft-this._initialScroll.x,r+=this._dragEl.parentNode.scrollTop-this._initialScroll.y),i/=o,r/=o,this.moveBy(i,r,e)}}}},{key:"getDragDelta",value:function getDragDelta(){return null!=this._posAtDown&&null!=this._downAt?{x:this._downAt.x-this._posAtDown.x,y:this._downAt.y-this._posAtDown.y}:{x:0,y:0}}},{key:"mark",value:function mark(e){this._posAtDown=this.manager.getPosition(this._dragEl),this._pagePosAtDown=offsetRelativeToRoot(this._dragEl),this._pageDelta={x:this._pagePosAtDown.x-this._posAtDown.x,y:this._pagePosAtDown.y-this._posAtDown.y},this._size=this.manager.getSize(this._dragEl),addClass(this._dragEl,this.manager.css.drag),this._constrainRect=function getConstrainingRectangle(e){return{w:e.parentNode.offsetWidth+e.parentNode.scrollLeft,h:e.parentNode.offsetHeight+e.parentNode.scrollTop}}(this._dragEl),this._ghostDx=0,this._ghostDy=0}},{key:"unmark",value:function unmark(e){this._isConstrained&&this._useGhostProxy(this._elementToDrag,this._dragEl)?(this._ghostProxyOffsets={x:this._dragEl.offsetLeft-this._ghostDx,y:this._dragEl.offsetTop-this._ghostDy},this._dragEl.parentNode.removeChild(this._dragEl),this._dragEl=this._elementToDrag):this._ghostProxyOffsets=null,removeClass(this._dragEl,this.manager.css.drag),this._isConstrained=!1}},{key:"moveBy",value:function moveBy(e,t,n){var i=this.toGrid({x:this._posAtDown.x+e,y:this._posAtDown.y+t}),r=this._doConstrain(i,this._dragEl,this._constrainRect,this._size,n);if(null!=r){if(this._useGhostProxy(this.el,this._dragEl))if(i.x!==r.x||i.y!==r.y){if(!this._isConstrained){var o=this._ghostProxyFunction(this._elementToDrag);addClass(o,yn),this._ghostProxyParent?(this._ghostProxyParent.appendChild(o),this._currentParentPosition=offsetRelativeToRoot(this._elementToDrag.parentNode),this._ghostParentPosition=offsetRelativeToRoot(this._ghostProxyParent),this._ghostDx=this._currentParentPosition.x-this._ghostParentPosition.x,this._ghostDy=this._currentParentPosition.y-this._ghostParentPosition.y):this._elementToDrag.parentNode.appendChild(o),this._dragEl=o,this._isConstrained=!0}r=i}else this._isConstrained&&(this._dragEl.parentNode.removeChild(this._dragEl),this._dragEl=this._elementToDrag,this._isConstrained=!1,this._currentParentPosition=null,this._ghostParentPosition=null,this._ghostDx=0,this._ghostDy=0);this.manager.setPosition(this._dragEl,{x:r.x+this._ghostDx,y:r.y+this._ghostDy}),this._dispatch(sn,{el:this.el,pos:r,e:n,drag:this,size:this._size,originalPos:this._posAtDown})}}},{key:"abort",value:function abort(){null!=this._downAt&&this._upListener()}},{key:"getDragElement",value:function getDragElement(e){return e?this._elementToDrag||this.el:this._dragEl||this.el}},{key:"stop",value:function stop(e,t){if(t||this._moving){var n=[],i=this.manager.getPosition(this._dragEl);n.push([this._dragEl,i,this,this._size]),this._dispatch(cn,{el:this._dragEl,pos:this._ghostProxyOffsets||i,finalPos:i,e:e,drag:this,selection:n,size:this._size,originalPos:{x:this._posAtDown.x,y:this._posAtDown.y}})}else this._moving||this._activeSelectorParams.dragAbort&&this._activeSelectorParams.dragAbort(this._elementToDrag)}},{key:"_dispatch",value:function _dispatch(e,t){var n=null;if(this._activeSelectorParams&&this._activeSelectorParams[e])n=this._activeSelectorParams[e](t);else if(this.listeners[e])for(var i=0;i<this.listeners[e].length;i++)try{var r=this.listeners[e][i](t);null!=r&&(n=r)}catch(e){}return n}},{key:"resolveGrid",value:function resolveGrid(){var e={grid:null,thresholdX:5,thresholdY:5};return null!=this._activeSelectorParams&&null!=this._activeSelectorParams.grid&&(e.grid=this._activeSelectorParams.grid,null!=this._activeSelectorParams.snapThreshold&&(e.thresholdX=this._activeSelectorParams.snapThreshold,e.thresholdY=this._activeSelectorParams.snapThreshold)),e}},{key:"toGrid",value:function toGrid(e){var t=this.resolveGrid(),n=t.grid,i=t.thresholdX,r=t.thresholdY;return null==n?e:snapToGrid(e,n,n?n.w/2:i,n?n.h/2:r)}},{key:"setUseGhostProxy",value:function setUseGhostProxy(e){this._useGhostProxy=e?hn:dn}},{key:"_doConstrain",value:function _doConstrain(e,t,n,i,r){return null!=this._activeSelectorParams&&this._activeSelectorParams.constrainFunction&&"function"==typeof this._activeSelectorParams.constrainFunction?this._activeSelectorParams.constrainFunction(e,t,n,i,r):e}},{key:"_testFilter",value:function _testFilter(e){for(var t in this._filters){var n=this._filters[t],i=n[0](e);if(n[1]&&(i=!i),!i)return!1}return!0}},{key:"addFilter",value:function addFilter(e,t){var n=this;if(e){var i=function _assignId(e){return"function"==typeof e?(e._katavorioId=uuid(),e._katavorioId):e}(e);this._filters[i]=[function(t){var i,r=t.srcElement||t.target;return isString(e)?i=matchesSelector$1(r,e,n.el):"function"==typeof e&&(i=e(t,n.el)),i},!1!==t]}}},{key:"removeFilter",value:function removeFilter(e){var t="function"==typeof e?e._katavorioId:e;delete this._filters[t]}},{key:"clearAllFilters",value:function clearAllFilters(){this._filters={}}},{key:"addSelector",value:function addSelector(e,t){e.selector&&(t?this._availableSelectors.unshift(e):this._availableSelectors.push(e))}},{key:"destroy",value:function destroy(){this.eventManager.off(this.el,Ne,this.downListener),this.eventManager.off(document,Re,this.moveListener),this.eventManager.off(document,Be,this.upListener),this.downListener=null,this.upListener=null,this.moveListener=null,null!=this.scrollTracker&&document.removeEventListener("scroll",this.scrollTracker)}}]),Drag}(bn),kn=["input","textarea","select","button","option"].join(","),In=function(){function Collicat(t){_classCallCheck(this,Collicat),_defineProperty(this,"eventManager",void 0),_defineProperty(this,"zoom",1),_defineProperty(this,"css",{}),_defineProperty(this,"inputFilterSelector",void 0),_defineProperty(this,"positioningStrategy",void 0),_defineProperty(this,"_positionSetter",void 0),_defineProperty(this,"_positionGetter",void 0),_defineProperty(this,"_sizeSetter",void 0),_defineProperty(this,"_sizeGetter",void 0),t=t||{},this.inputFilterSelector=t.inputFilterSelector||kn,this.eventManager=new $t,this.zoom=t.zoom||1,this.positioningStrategy=t.positioningStrategy||e.PositioningStrategies.absolutePosition,this._positionGetter=_n.get(this.positioningStrategy),this._positionSetter=gn.get(this.positioningStrategy),this._sizeGetter=En.get(this.positioningStrategy),this._sizeSetter=mn.get(this.positioningStrategy);var n=t.css||{};extend(this.css,n)}return _createClass(Collicat,[{key:"getPosition",value:function getPosition(e){return this._positionGetter(e)}},{key:"setPosition",value:function setPosition(e,t){this._positionSetter(e,t)}},{key:"getSize",value:function getSize(e){return this._sizeGetter(e)}},{key:"getZoom",value:function getZoom(){return this.zoom}},{key:"setZoom",value:function setZoom(e){this.zoom=e}},{key:"_prepareParams",value:function _prepareParams(e){e=e||{};var t,n={events:{}};for(t in e)n[t]=e[t];for(t=0;t<Cn.length;t++)n.events[Cn[t]]=e[Cn[t]]||xn;return n}},{key:"getInputFilterSelector",value:function getInputFilterSelector(){return this.inputFilterSelector}},{key:"setInputFilterSelector",value:function setInputFilterSelector(e){return this.inputFilterSelector=e,this}},{key:"draggable",value:function draggable(e,t){if(null==e._katavorioDrag){var n=this._prepareParams(t),i=new Sn(e,n,this);return addClass(e,pn),e._katavorioDrag=i,i}return e._katavorioDrag}},{key:"destroyDraggable",value:function destroyDraggable(e){e._katavorioDrag&&(e._katavorioDrag.destroy(),delete e._katavorioDrag)}}]),Collicat}(),An="jtk-drag-selected",On=function(){function DragSelection(e){_classCallCheck(this,DragSelection),this.instance=e,_defineProperty(this,"_dragSelection",[]),_defineProperty(this,"_dragSizes",new Map),_defineProperty(this,"_dragElements",new Map),_defineProperty(this,"_dragElementStartPositions",new Map),_defineProperty(this,"_dragElementPositions",new Map),_defineProperty(this,"__activeSet",void 0)}return _createClass(DragSelection,[{key:"_activeSet",get:function get(){return null==this.__activeSet?this._dragSelection:this.__activeSet}},{key:"length",get:function get(){return this._dragSelection.length}},{key:"filterActiveSet",value:function filterActiveSet(e){var t=this;this.__activeSet=[],forEach(this._dragSelection,(function(n){e(n)&&t.__activeSet.push(n)}))}},{key:"clear",value:function clear(){var e=this;this.reset(),forEach(this._dragSelection,(function(t){return e.instance.removeClass(t.jel,An)})),this._dragSelection.length=0}},{key:"reset",value:function reset(){this._dragElementStartPositions.clear(),this._dragElementPositions.clear(),this._dragSizes.clear(),this._dragElements.clear(),this.__activeSet=null}},{key:"initialisePositions",value:function initialisePositions(){var e=this;forEach(this._activeSet,(function(t){var n=e.instance.viewport.getPosition(t.id),i={x:parseInt(""+t.jel.offsetLeft,10),y:parseInt(""+t.jel.offsetTop,10)};e._dragElementStartPositions.set(t.id,i),e._dragElementPositions.set(t.id,i),e._dragSizes.set(t.id,{w:n.w,h:n.h})}))}},{key:"updatePositions",value:function updatePositions(e,t,n){var i=this,r=e.x-t.x,o=e.y-t.y;forEach(this._activeSet,(function(e){var t=i._dragElementStartPositions.get(e.id);if(t){var a=t.x+r,l=t.y+o,u=i._dragSizes.get(e.id),h={x:a,y:l,w:u.w,h:u.h};if(e.jel._jsPlumbParentGroup&&e.jel._jsPlumbParentGroup.constrain){var d={w:e.jel.parentNode.offsetWidth+e.jel.parentNode.scrollLeft,h:e.jel.parentNode.offsetHeight+e.jel.parentNode.scrollTop};h.x=Math.max(h.x,0),h.y=Math.max(h.y,0),h.x=Math.min(h.x,d.w-u.w),h.y=Math.min(h.y,d.h-u.h)}i._dragElementPositions.set(e.id,{x:a,y:l}),e.jel.style.left=h.x+"px",e.jel.style.top=h.y+"px",n(e.jel,e.id,u,h)}}))}},{key:"each",value:function each(e){var t=this;forEach(this._activeSet,(function(n){var i=t._dragSizes.get(n.id),r=t._dragElementPositions.get(n.id),o=t._dragElementStartPositions.get(n.id);e(n.jel,n.id,r,i,o)}))}},{key:"add",value:function add(e,t){var n=e;t=t||this.instance.getId(n),-1===findWithFunction(this._dragSelection,(function(e){return e.id===t}))&&(this.instance.addClass(e,An),this._dragSelection.push({id:t,jel:n}))}},{key:"remove",value:function remove(e){var t=this,n=e;this._dragSelection=this._dragSelection.filter((function(e){var i=e.jel!==n;return i||t.instance.removeClass(e.jel,An),i}))}},{key:"toggle",value:function toggle(e){var t=e;-1!==findWithFunction(this._dragSelection,(function(e){return e.jel===t}))?this.remove(t):this.add(e)}}]),DragSelection}(),Dn="jtk-delegated-draggable",wn="jtk-draggable",Mn="jtk-drag",Ln="jtk-ghost-proxy",Gn="jtk-drag-active",jn="jtk-dragged",Nn="jtk-drag-hover",zn=function(){function DragManager(e,t,n){var i=this;_classCallCheck(this,DragManager),this.instance=e,this.dragSelection=t,_defineProperty(this,"collicat",void 0),_defineProperty(this,"drag",void 0),_defineProperty(this,"_draggables",{}),_defineProperty(this,"_dlist",[]),_defineProperty(this,"_elementsWithEndpoints",{}),_defineProperty(this,"_draggablesForElements",{}),_defineProperty(this,"handlers",[]),_defineProperty(this,"_trackScroll",void 0),_defineProperty(this,"_filtersToAdd",[]),this.collicat=new In({zoom:this.instance.currentZoom,css:{noSelect:this.instance.dragSelectClass,delegatedDraggable:Dn,draggable:wn,drag:Mn,selected:An,active:Gn,hover:Nn,ghostProxy:Ln}}),this.instance.bind(ie,(function(e){i.collicat.setZoom(e)})),n=n||{},this._trackScroll=!1!==n.trackScroll}return _createClass(DragManager,[{key:"addHandler",value:function addHandler(t,n){var i=this,r=extend({selector:t.selector},n||{});r.start=wrap(r.start,(function(e){return t.onStart(e)}),!1),r.drag=wrap(r.drag,(function(e){return t.onDrag(e)})),r.stop=wrap(r.stop,(function(e){return t.onStop(e)}));var o=(t.onBeforeStart||function(e){}).bind(t);if(r.beforeStart=wrap(r.beforeStart,(function(e){return o(e)})),r.dragInit=function(e,n){return t.onDragInit(e,n)},r.dragAbort=function(e){return t.onDragAbort(e)},t.useGhostProxy&&(r.useGhostProxy=t.useGhostProxy,r.makeGhostProxy=t.makeGhostProxy),null==r.constrainFunction&&null!=r.containment)switch(r.containment){case e.ContainmentType.notNegative:r.constrainFunction=function(e,t,n,i){return{x:Math.max(0,Math.min(e.x)),y:Math.max(0,Math.min(e.y))}};break;case e.ContainmentType.parent:var a=r.containmentPadding||5;r.constrainFunction=function(e,t,n,i){return{x:e.x<0?0:e.x>n.w-a?n.w-a:e.x,y:e.y<0?0:e.y>n.h-a?n.h-a:e.y}};break;case e.ContainmentType.parentEnclosed:r.constrainFunction=function(e,t,n,i){return{x:e.x<0?0:e.x+i.w>n.w?n.w-i.w:e.x,y:e.y<0?0:e.y+i.h>n.h?n.h-i.h:e.y}}}null==this.drag?(r.trackScroll=this._trackScroll,this.drag=this.collicat.draggable(this.instance.getContainer(),r),forEach(this._filtersToAdd,(function(e){return i.drag.addFilter(e[0],e[1])})),this.drag.on($e,(function(e){i.instance.revalidate(e)}))):this.drag.addSelector(r),this.handlers.push({handler:t,options:r}),t.init(this.drag)}},{key:"addSelector",value:function addSelector(e,t){this.drag&&this.drag.addSelector(e,t)}},{key:"addFilter",value:function addFilter(e,t){null==this.drag?this._filtersToAdd.push([e,!0===t]):this.drag.addFilter(e,t)}},{key:"removeFilter",value:function removeFilter(e){null!=this.drag&&this.drag.removeFilter(e)}},{key:"setFilters",value:function setFilters(e){var t=this;forEach(e,(function(e){t.drag.addFilter(e[0],e[1])}))}},{key:"reset",value:function reset(){var e=[];if(forEach(this.handlers,(function(e){e.handler.reset()})),this.handlers.length=0,null!=this.drag){var t=this.drag._filters;for(var n in t)e.push([n,t[n][1]]);this.collicat.destroyDraggable(this.instance.getContainer())}return delete this.drag,e}},{key:"setOption",value:function setOption(e,t){var n=getWithFunction(this.handlers,(function(t){return t.handler===e}));null!=n&&extend(n.options,t||{})}}]),DragManager}();function decodeDragGroupSpec(e,t){return isString(t)?{id:t,active:!0}:{id:t.id,active:t.active}}var Fn,Rn,Bn,Hn,Vn=function(){function ElementDragHandler(e,t){_classCallCheck(this,ElementDragHandler),this.instance=e,this._dragSelection=t,_defineProperty(this,"selector","> "+ce+":not("+cls(j)+")"),_defineProperty(this,"_dragOffset",null),_defineProperty(this,"_groupLocations",[]),_defineProperty(this,"_intersectingGroups",[]),_defineProperty(this,"_currentDragParentGroup",null),_defineProperty(this,"_dragGroupByElementIdMap",{}),_defineProperty(this,"_dragGroupMap",{}),_defineProperty(this,"_currentDragGroup",null),_defineProperty(this,"_currentDragGroupOffsets",new Map),_defineProperty(this,"_currentDragGroupSizes",new Map),_defineProperty(this,"_currentDragGroupOriginalPositions",new Map),_defineProperty(this,"_dragPayload",null),_defineProperty(this,"drag",void 0),_defineProperty(this,"originalPosition",void 0)}return _createClass(ElementDragHandler,[{key:"onDragInit",value:function onDragInit(e){return null}},{key:"onDragAbort",value:function onDragAbort(e){return null}},{key:"getDropGroup",value:function getDropGroup(){var e=null;if(this._intersectingGroups.length>0){var t=this._intersectingGroups[0].groupLoc.group,n=this._intersectingGroups[0].intersectingElement,i=n._jsPlumbParentGroup;i!==t&&(null!=i&&i.overrideDrop(n,t)||(e=this._intersectingGroups[0]))}return e}},{key:"onStop",value:function onStop(e){var t,n=this,i=e.drag.getDragElement(),r=this.getDropGroup(),o=[];function addElementToProcess(e,t,n,i,a){var l=n.x,u=n.y;if(e._jsPlumbParentGroup&&e._jsPlumbParentGroup.constrain){var h={w:e.parentNode.offsetWidth+e.parentNode.scrollLeft,h:e.parentNode.offsetHeight+e.parentNode.scrollTop};l=Math.max(l,0),u=Math.max(u,0),l=Math.min(l,h.w-i.w),u=Math.min(u,h.h-i.h),n.x=l,n.y=u}o.push({el:e,id:t,pos:n,originalPos:a,originalGroup:e._jsPlumbParentGroup,redrawResult:null,reverted:!1,dropGroup:null==r?void 0:r.groupLoc.group})}if(o.push({el:i,id:this.instance.getId(i),pos:e.finalPos,originalGroup:i._jsPlumbParentGroup,redrawResult:null,originalPos:e.originalPos,reverted:!1,dropGroup:null!=r?r.groupLoc.group:null}),this._dragSelection.each((function(t,n,i,r,o){t!==e.el&&addElementToProcess(t,n,{x:i.x,y:i.y},r,o)})),null===(t=this._currentDragGroup)||void 0===t||t.members.forEach((function(t){if(t.el!==e.el){var i=n._currentDragGroupOffsets.get(t.elId),r=n._currentDragGroupSizes.get(t.elId),o={x:e.finalPos.x+i[0].x,y:e.finalPos.y+i[0].y};addElementToProcess(t.el,t.elId,o,r,n._currentDragGroupOriginalPositions.get(t.elId))}})),forEach(o,(function(e){var t=null!=e.originalGroup,i=t&&isInsideParent(n.instance,e.el,e.pos),o={x:0,y:0};if(t&&!i){if(null==r){var a=n._pruneOrOrphan(e,!0,!0);null!=a.pos?e.pos=a.pos.pos:!a.pruned&&e.originalGroup.revert&&(e.pos=e.originalPos,e.reverted=!0)}}else t&&i&&(o=n._computeOffsetByParentGroup(e.originalGroup));null==r||i?e.dropGroup=null:n.instance.groupManager.addToGroup(r.groupLoc.group,!1,e.el),e.reverted&&n.instance.setPosition(e.el,e.pos),e.redrawResult=n.instance.setElementPosition(e.el,e.pos.x+o.x,e.pos.y+o.y),n.instance.removeClass(e.el,jn),n.instance.select({source:e.el}).removeClass(n.instance.elementDraggingClass+" "+n.instance.sourceElementDraggingClass,!0),n.instance.select({target:e.el}).removeClass(n.instance.elementDraggingClass+" "+n.instance.targetElementDraggingClass,!0)})),null!=o[0].originalGroup){var a=i._jsPlumbParentGroup;if(a!==o[0].originalGroup){var l=e.drag.getDragElement(!0);if(o[0].originalGroup.ghost){var u=this.instance.getPosition(this.instance.getGroupContentArea(a)),h=this.instance.getPosition(this.instance.getGroupContentArea(o[0].originalGroup)),d={x:h.x+e.pos.x-u.x,y:h.y+e.pos.y-u.y};l.style.left=d.x+"px",l.style.top=d.y+"px",this.instance.revalidate(l)}}}this.instance.fire(Je,{elements:o,e:e.e,el:i,payload:this._dragPayload}),this._cleanup()}},{key:"_cleanup",value:function _cleanup(){var e=this;forEach(this._groupLocations,(function(t){e.instance.removeClass(t.el,Gn),e.instance.removeClass(t.el,Nn)})),this._currentDragParentGroup=null,this._groupLocations.length=0,this.instance.hoverSuspended=!1,this._dragOffset=null,this._dragSelection.reset(),this._dragPayload=null,this._currentDragGroupOffsets.clear(),this._currentDragGroupSizes.clear(),this._currentDragGroupOriginalPositions.clear(),this._currentDragGroup=null}},{key:"reset",value:function reset(){}},{key:"init",value:function init(e){this.drag=e}},{key:"onDrag",value:function onDrag(e){var t=this,n=e.drag.getDragElement(),i=this.instance.getId(n),r=e.pos,o=this.instance.viewport.getPosition(i),a={x:r.x,y:r.y};this._intersectingGroups.length=0,null!=this._dragOffset&&(a.x+=this._dragOffset.x,a.y+=this._dragOffset.y);var l=function _one(n,i,r){if(r){var o=new Set;forEach(t._groupLocations,(function(n){!o.has(n.group.id)&&intersects(i,n.r)?(n.group!==t._currentDragParentGroup&&t.instance.addClass(n.el,Nn),t._intersectingGroups.push({groupLoc:n,intersectingElement:e.drag.getDragElement(!0),d:0}),forEach(t.instance.groupManager.getAncestors(n.group),(function(e){return o.add(e.id)}))):t.instance.removeClass(n.el,Nn)}))}t.instance.setElementPosition(n,i.x,i.y),t.instance.fire(qe,{el:n,e:e.e,pos:{x:i.x,y:i.y},originalPosition:t.originalPosition,payload:t._dragPayload})},u={x:a.x,y:a.y,w:o.w,h:o.h};l(n,u,!0),this._dragSelection.updatePositions(r,this.originalPosition,(function(e,t,n,i){l(e,i,!1)})),this._currentDragGroupOffsets.forEach((function(e,n){var i=t._currentDragGroupSizes.get(n),r={x:u.x+e[0].x,y:u.y+e[0].y,w:i.w,h:i.h};e[1].style.left=r.x+"px",e[1].style.top=r.y+"px",l(e[1],r,!1)}))}},{key:"_computeOffsetByParentGroup",value:function _computeOffsetByParentGroup(e){var t=this.instance.getPosition(e.el),n=e.contentArea;if(n!==e.el){var i=this.instance.getPosition(n);t.x+=i.x,t.y+=i.y}if(e.el._jsPlumbParentGroup){var r=this._computeOffsetByParentGroup(e.el._jsPlumbParentGroup);t.x+=r.x,t.y+=r.y}return t}},{key:"onStart",value:function onStart(e){var t=this,n=e.drag.getDragElement(),i=this.instance.getPosition(n);this.originalPosition={x:e.pos.x,y:e.pos.y},n._jsPlumbParentGroup&&(this._dragOffset=this._computeOffsetByParentGroup(n._jsPlumbParentGroup),this._currentDragParentGroup=n._jsPlumbParentGroup);var r=!0,o=n.getAttribute(g);if((!1===this.instance.elementsDraggable||null!=o&&o!==Rt)&&(r=!1),r){this._groupLocations.length=0,this._intersectingGroups.length=0,this.instance.hoverSuspended=!0;var a=e.drag.getDragElement(!0),l=a.querySelectorAll(ce),u=function getAncestors(e){for(var t=[],n=e._jsPlumbParentGroup;null!=n;)t.push(n.el),n=n.group;return t}(a),h=[];Array.prototype.push.apply(h,l),Array.prototype.push.apply(h,u),this._dragSelection.filterActiveSet((function(e){return-1===h.indexOf(e.jel)})),this._dragSelection.initialisePositions();var d=function _one(n,i,r){if(!n._isJsPlumbGroup||t.instance.allowNestedGroups){var o=!n._jsPlumbParentGroup,a=o||!0!==n._jsPlumbParentGroup.dropOverride,l=!o&&(n._jsPlumbParentGroup.ghost||!0!==n._jsPlumbParentGroup.constrain);(o||a&&l)&&(forEach(t.instance.groupManager.getGroups(),(function(e){var i=n._jsPlumbGroup;if(!1!==e.droppable&&!1!==e.enabled&&n._jsPlumbGroup!==e&&!t.instance.groupManager.isDescendant(e,i)){var r=e.el,o=t.instance.getId(r),a=t.instance.viewport.getPosition(o),l={el:r,r:{x:a.x,y:a.y,w:a.w,h:a.h},group:e};t._groupLocations.push(l),e!==t._currentDragParentGroup&&t.instance.addClass(r,Gn)}})),t._groupLocations.sort((function(e,n){return t.instance.groupManager.isDescendant(e.group,n.group)?-1:t.instance.groupManager.isAncestor(n.group,e.group)?1:0})))}return t.instance.select({source:n}).addClass(t.instance.elementDraggingClass+" "+t.instance.sourceElementDraggingClass,!0),t.instance.select({target:n}).addClass(t.instance.elementDraggingClass+" "+t.instance.targetElementDraggingClass,!0),t.instance.fire(Ke,{el:n,e:e.e,originalPosition:t.originalPosition,pos:t.originalPosition,dragGroup:i,dragGroupMemberSpec:r})},p=this.instance.getId(n);this._currentDragGroup=this._dragGroupByElementIdMap[p],this._currentDragGroup&&!function isActiveDragGroupMember(e,t){var n=getFromSetWithFunction(e.members,(function(e){return e.el===t}));return null!==n&&!0===n.active}(this._currentDragGroup,n)&&(this._currentDragGroup=null);var v=d(n);if(!1===v)return this._cleanup(),!1;this._dragPayload=v,null!=this._currentDragGroup&&(this._currentDragGroupOffsets.clear(),this._currentDragGroupSizes.clear(),this._currentDragGroup.members.forEach((function(e){var n=t.instance.viewport.getPosition(e.elId);t._currentDragGroupOffsets.set(e.elId,[{x:n.x-i.x,y:n.y-i.y},e.el]),t._currentDragGroupSizes.set(e.elId,n),t._currentDragGroupOriginalPositions.set(e.elId,{x:n.x,y:n.y}),d(e.el,t._currentDragGroup,e)})))}return r}},{key:"addToDragGroup",value:function addToDragGroup(e){var t=this,n=decodeDragGroupSpec(this.instance,e),i=this._dragGroupMap[n.id];null==i&&(i={id:n.id,members:new Set},this._dragGroupMap[n.id]=i);for(var r=arguments.length,o=new Array(r>1?r-1:0),a=1;a<r;a++)o[a-1]=arguments[a];this.removeFromDragGroup.apply(this,o),forEach(o,(function(e){var r=t.instance.getId(e);i.members.add({elId:r,el:e,active:n.active}),t._dragGroupByElementIdMap[r]=i}))}},{key:"removeFromDragGroup",value:function removeFromDragGroup(){for(var e=this,t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];forEach(n,(function(t){var n=e.instance.getId(t),i=e._dragGroupByElementIdMap[n];if(null!=i){var r=new Set;i.members.forEach((function(e){e.el!==t&&r.add(e)})),i.members=r,delete e._dragGroupByElementIdMap[n]}}))}},{key:"setDragGroupState",value:function setDragGroupState(e){for(var t=this,n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];var o=i.map((function(e){return t.instance.getId(e)}));forEach(o,(function(n){var i=t._dragGroupByElementIdMap[n];if(null!=i){var r=getFromSetWithFunction(i.members,(function(e){return e.elId===n}));null!=r&&(r.active=e)}}))}},{key:"clearDragGroup",value:function clearDragGroup(e){var t=this,n=this._dragGroupMap[e];null!=n&&(n.members.forEach((function(e){delete t._dragGroupByElementIdMap[e.elId]})),n.members.clear())}},{key:"_pruneOrOrphan",value:function _pruneOrOrphan(e,t,n){var i=e.el,r={pruned:!1,pos:null};if(n||!isInsideParent(this.instance,i,e.pos)){var o=i._jsPlumbParentGroup;o.prune?(i._isJsPlumbGroup?this.instance.removeGroup(i._jsPlumbGroup):o.remove(e.el,!0),r.pruned=!0):o.orphan&&(r.pos=this.instance.groupManager.orphan(e.el,t),i._isJsPlumbGroup?o.removeGroup(i._jsPlumbGroup):o.remove(e.el))}return r}}]),ElementDragHandler}(),Un={},Yn={},Xn={},Wn={get:function get(e,t,n){var i=Un[t];if(i)return new i(e,n);throw{message:"jsPlumb: unknown endpoint type '"+t+"'"}},clone:function clone(e){var t=Xn[e.type];return Wn.get(e.endpoint,e.type,t.getParams(e))},compute:function compute(e,t,n,i){var r=Yn[e.type];if(null!=r)return r(e,t,n,i);log("jsPlumb: cannot find endpoint calculator for endpoint of type ",e.type)},registerHandler:function registerHandler(e){Xn[e.type]=e,Un[e.type]=e.cls,Yn[e.type]=e.compute}},qn=function(){function EndpointRepresentation(e,t){_classCallCheck(this,EndpointRepresentation),this.endpoint=e,_defineProperty(this,"typeId",void 0),_defineProperty(this,"x",void 0),_defineProperty(this,"y",void 0),_defineProperty(this,"w",void 0),_defineProperty(this,"h",void 0),_defineProperty(this,"computedValue",void 0),_defineProperty(this,"bounds",{xmin:1/0,xmax:-1/0,ymin:1/0,ymax:-1/0}),_defineProperty(this,"classes",[]),_defineProperty(this,"instance",void 0),_defineProperty(this,"type",void 0),t=t||{},this.instance=e.instance,e.cssClass&&this.classes.push(e.cssClass),t.cssClass&&this.classes.push(t.cssClass)}return _createClass(EndpointRepresentation,[{key:"addClass",value:function addClass(e){this.classes.push(e),this.instance.addEndpointClass(this.endpoint,e)}},{key:"removeClass",value:function removeClass(e){this.classes=this.classes.filter((function(t){return t!==e})),this.instance.removeEndpointClass(this.endpoint,e)}},{key:"compute",value:function compute(e,t,n){this.computedValue=Wn.compute(this,e,t,n),this.bounds.xmin=this.x,this.bounds.ymin=this.y,this.bounds.xmax=this.x+this.w,this.bounds.ymax=this.y+this.h}},{key:"setVisible",value:function setVisible(e){this.instance.setEndpointVisible(this.endpoint,e)}}]),EndpointRepresentation}();!function(e){e.top="top",e.left="left",e.right="right",e.bottom="bottom"}(Hn||(Hn={}));var Jn=Hn.top,Kn=Hn.left,$n=Hn.right,Zn=Hn.bottom,Qn=[Kn,$n],ei=[Jn,Zn],ti=function(){function LightweightFloatingAnchor(e,t,n){_classCallCheck(this,LightweightFloatingAnchor),this.instance=e,this.element=t,_defineProperty(this,"isFloating",!0),_defineProperty(this,"isContinuous",void 0),_defineProperty(this,"isDynamic",void 0),_defineProperty(this,"locations",[]),_defineProperty(this,"currentLocation",0),_defineProperty(this,"locked",!1),_defineProperty(this,"cssClass",""),_defineProperty(this,"timestamp",null),_defineProperty(this,"type","Floating"),_defineProperty(this,"id",uuid()),_defineProperty(this,"orientation",[0,0]),_defineProperty(this,"size",void 0),this.size=e.viewport.getPosition(n),this.locations.push({x:.5,y:.5,ox:this.orientation[0],oy:this.orientation[1],offx:0,offy:0,iox:this.orientation[0],ioy:this.orientation[1],cls:""})}return _createClass(LightweightFloatingAnchor,[{key:"_updateOrientationInRouter",value:function _updateOrientationInRouter(){this.instance.router.setAnchorOrientation(this,[this.locations[0].ox,this.locations[0].oy])}},{key:"over",value:function over(e){this.orientation=this.instance.router.getEndpointOrientation(e),this.locations[0].ox=this.orientation[0],this.locations[0].oy=this.orientation[1],this._updateOrientationInRouter()}},{key:"out",value:function out(){this.orientation=null,this.locations[0].ox=this.locations[0].iox,this.locations[0].oy=this.locations[0].ioy,this._updateOrientationInRouter()}}]),LightweightFloatingAnchor}(),ni=(_defineProperty(Fn={},Jn,Zn),_defineProperty(Fn,$n,Kn),_defineProperty(Fn,Kn,$n),_defineProperty(Fn,Zn,Jn),Fn),ii=(_defineProperty(Rn={},Jn,$n),_defineProperty(Rn,$n,Zn),_defineProperty(Rn,Kn,Jn),_defineProperty(Rn,Zn,Kn),Rn),ri=(_defineProperty(Bn={},Jn,Kn),_defineProperty(Bn,$n,Jn),_defineProperty(Bn,Kn,Zn),_defineProperty(Bn,Zn,$n),Bn);function getDefaultFace(e){return 0===e.faces.length?Jn:e.faces[0]}function _isFaceAvailable(e,t){return-1!==e.faces.indexOf(t)}function isEdgeSupported(e,t){return null==e.lockedAxis?null==e.lockedFace?!0===_isFaceAvailable(e,t):e.lockedFace===t:-1!==e.lockedAxis.indexOf(t)}function verifyFace(e,t){if(_isFaceAvailable(e,t))return t;if(_isFaceAvailable(e,ni[t]))return ni[t];var n=function _secondBest(e,t){return(e.clockwise?ii:ri)[t]}(e,t);if(_isFaceAvailable(e,n))return n;var i=function _lastChoice(e,t){return(e.clockwise?ri:ii)[t]}(e,t);return _isFaceAvailable(e,i)?i:t}var oi={x:.5,y:0,ox:0,oy:-1,offx:0,offy:0},si={x:.5,y:1,ox:0,oy:1,offx:0,offy:0},ai={x:0,y:.5,ox:-1,oy:0,offx:0,offy:0},li={x:1,y:.5,ox:1,oy:0,offx:0,offy:0},ci={Top:[oi],Bottom:[si],Left:[ai],Right:[li],TopLeft:[{x:0,y:0,ox:0,oy:-1,offx:0,offy:0}],TopRight:[{x:1,y:0,ox:1,oy:-1,offx:0,offy:0}],BottomLeft:[{x:0,y:1,ox:0,oy:1,offx:0,offy:0}],BottomRight:[{x:1,y:1,ox:0,oy:1,offx:0,offy:0}],Center:[{x:.5,y:.5,ox:0,oy:0,offx:0,offy:0}],AutoDefault:[oi,ai,si,li]},ui={Continuous:{faces:[Jn,Kn,Zn,$n]},ContinuousTop:{faces:[Jn]},ContinuousRight:{faces:[$n]},ContinuousBottom:{faces:[Zn]},ContinuousLeft:{faces:[Kn]},ContinuousLeftRight:{faces:[Kn,$n]},ContinuousTopBottom:{faces:[Jn,Zn]}};function getNamedAnchor(t,n){if(n=n||{},t===e.AnchorLocations.Perimeter)return _createPerimeterAnchor(n);var i=ci[t];if(null!=i)return _createAnchor(t,map(i,(function(e){return extend({iox:e.ox,ioy:e.oy},e)})),n);if(null!=(i=ui[t]))return function _createContinuousAnchor(e,t,n){var i={type:e,locations:[],currentLocation:0,locked:!1,id:uuid(),cssClass:n.cssClass||"",isFloating:!1,isContinuous:!0,timestamp:null,faces:n.faces||t,lockedFace:null,lockedAxis:null,clockwise:!(!1===n.clockwise),__currentFace:null};return Object.defineProperty(i,hi,{get:function get(){return this.__currentFace},set:function set(e){this.__currentFace=verifyFace(this,e)}}),i}(t,i.faces,n);throw{message:"jsPlumb: unknown anchor type '"+t+"'"}}function _createAnchor(e,t,n){return{type:e,locations:t,currentLocation:0,locked:!1,id:uuid(),isFloating:!1,isContinuous:!1,isDynamic:t.length>1,timestamp:null,cssClass:n.cssClass||""}}function createFloatingAnchor(e,t,n){return new ti(e,t,n)}var hi="currentFace";function isPrimitiveAnchorSpec(e){return e.length<7&&e.every(isNumber)||7===e.length&&e.slice(0,5).every(isNumber)&&isString(e[6])}function makeLightweightAnchorFromSpec(e){if(isString(e))return getNamedAnchor(e,null);if(Array.isArray(e)){if(isPrimitiveAnchorSpec(e)){var t=e;return _createAnchor(null,[{x:t[0],y:t[1],ox:t[2],oy:t[3],offx:null==t[4]?0:t[4],offy:null==t[5]?0:t[5],iox:t[2],ioy:t[3],cls:t[6]||""}],{cssClass:t[6]||""})}return _createAnchor("Dynamic",map(e,(function(e){if(isString(e)){var t=ci[e];return null!=t?extend({iox:t[0].ox,ioy:t[0].oy,cls:""},t[0]):null}if(isPrimitiveAnchorSpec(e))return{x:e[0],y:e[1],ox:e[2],oy:e[3],offx:null==e[4]?0:e[4],offy:null==e[5]?0:e[5],iox:e[2],ioy:e[3],cls:e[6]||""}})).filter((function(e){return null!=e})),{})}var n=e;return getNamedAnchor(n.type,n.options)}function circleGenerator(e){for(var t=.5,n=2*Math.PI/e,i=[],r=0,o=0;o<e;o++){var a=t+t*Math.sin(r),l=t+t*Math.cos(r);i.push({x:a,y:l,ox:0,oy:0,offx:0,offy:0,iox:0,ioy:0,cls:""}),r+=n}return i}function shapeGenerator(e,t){for(var n=[],i=0;i<e.length;i++)n.push([e[i][0],e[i][1],e[i][2],e[i][3],1/e.length,e[i][4],e[i][5]]);return function _path(e,t){for(var n=t/e.length,i=[],r=function _computeFace(e,r,o,a,l,u,h){for(var d=(o-e)/(n=t*l),p=(a-r)/n,v=0;v<n;v++)i.push({x:e+d*v,y:r+p*v,ox:null==u?0:u,oy:null==h?0:h,offx:0,offy:0,iox:0,ioy:0,cls:""})},o=0;o<e.length;o++)r.apply(null,e[o]);return i}(n,t)}function rectangleGenerator(e){return shapeGenerator([[0,0,1,0,0,-1],[1,0,1,1,1,0],[1,1,0,1,0,1],[0,1,0,0,-1,0]],e)}var di=new Map;function _createPerimeterAnchor(t){var n=(t=t||{}).anchorCount||60,i=t.shape;if(!i)throw new Error("no shape supplied to Perimeter Anchor type");if(!di.has(i))throw new Error("Shape ["+i+"] is unknown by Perimeter Anchor type");var r=di.get(i)(n);return t.rotation&&(r=function rotate$1(e,t){for(var n=[],i=t/180*Math.PI,r=0;r<e.length;r++){var o=e[r].x-.5,a=e[r].y-.5;n.push({x:o*Math.cos(i)-a*Math.sin(i)+.5,y:o*Math.sin(i)+a*Math.cos(i)+.5,ox:e[r].ox,oy:e[r].oy,offx:0,offy:0,iox:0,ioy:0,cls:""})}return n}(r,t.rotation)),extend(_createAnchor(e.AnchorLocations.Perimeter,r,t),{shape:i})}di.set(e.PerimeterAnchorShapes.Circle,circleGenerator),di.set(e.PerimeterAnchorShapes.Ellipse,circleGenerator),di.set(e.PerimeterAnchorShapes.Rectangle,rectangleGenerator),di.set(e.PerimeterAnchorShapes.Square,rectangleGenerator),di.set(e.PerimeterAnchorShapes.Diamond,(function diamondGenerator(e){return shapeGenerator([[.5,0,1,.5],[1,.5,.5,1],[.5,1,0,.5],[0,.5,.5,0]],e)})),di.set(e.PerimeterAnchorShapes.Triangle,(function triangleGenerator(e){return shapeGenerator([[.5,0,1,1],[1,1,0,1],[0,1,.5,0]],e)}));var pi=function(){function ConnectionDragSelector(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];_classCallCheck(this,ConnectionDragSelector),this.selector=e,this.def=t,this.exclude=n,_defineProperty(this,"id",void 0),_defineProperty(this,"redrop",void 0),this.id=uuid(),this.redrop=t.def.redrop||fi}return _createClass(ConnectionDragSelector,[{key:"setEnabled",value:function setEnabled(e){this.def.enabled=e}},{key:"isEnabled",value:function isEnabled(){return!1!==this.def.enabled}}]),ConnectionDragSelector}(),fi="strict",yi="anySource",vi="anyTarget",gi="anySourceOrTarget";function selectorFilter(e,t,n,i,r){for(var o=e.target||e.srcElement,a=!1,l=i.getSelector(t,n),u=0;u<l.length;u++)if(l[u]===o){a=!0;break}return r?!a:a}var _i=cls(Gn,Nn),mi="sourceSelectorEndpoint",Ei=function(){function EndpointDragHandler(e){_classCallCheck(this,EndpointDragHandler),this.instance=e,_defineProperty(this,"jpc",void 0),_defineProperty(this,"existingJpc",void 0),_defineProperty(this,"_originalAnchorSpec",void 0),_defineProperty(this,"ep",void 0),_defineProperty(this,"endpointRepresentation",void 0),_defineProperty(this,"canvasElement",void 0),_defineProperty(this,"_activeDefinition",void 0),_defineProperty(this,"placeholderInfo",{id:null,element:null}),_defineProperty(this,"floatingIndex",void 0),_defineProperty(this,"floatingId",void 0),_defineProperty(this,"floatingElement",void 0),_defineProperty(this,"floatingEndpoint",void 0),_defineProperty(this,"floatingAnchor",void 0),_defineProperty(this,"_stopped",void 0),_defineProperty(this,"inPlaceCopy",void 0),_defineProperty(this,"endpointDropTargets",[]),_defineProperty(this,"currentDropTarget",null),_defineProperty(this,"payload",void 0),_defineProperty(this,"floatingConnections",{}),_defineProperty(this,"_forceReattach",void 0),_defineProperty(this,"_forceDetach",void 0),_defineProperty(this,"mousedownHandler",void 0),_defineProperty(this,"mouseupHandler",void 0),_defineProperty(this,"selector",cls(k));var t=e.getContainer();this.mousedownHandler=this._mousedownHandler.bind(this),this.mouseupHandler=this._mouseupHandler.bind(this),e.on(t,Ne,ce,this.mousedownHandler),e.on(t,Be,[ce,cls(k)].join(","),this.mouseupHandler)}return _createClass(EndpointDragHandler,[{key:"_resolveDragParent",value:function _resolveDragParent(e,t){var n=this.instance.getContainer(),i=findParent(t,ce,n,!0);if(null!=e.parentSelector){var r=findParent(t,e.parentSelector,n,!0);return null!=r&&(i=findParent(r.parentNode,ce,n,!1)),r||i}return i}},{key:"_mousedownHandler",value:function _mousedownHandler(e){var t,n;if(3!==e.which&&2!==e.button){var i=e.target||e.srcElement;if((null==(n=this._getSourceDefinition(e))||null!=(t=this._resolveDragParent(n.def.def,i))&&t.getAttribute(Se)!==Rt)&&n){var r,o=e.currentTarget;if(i.getAttribute(Se)!==Rt){if(consume(e),this._activeDefinition=n,null!=(r=n.def.def).canAcceptNewConnection&&!r.canAcceptNewConnection(t,e))return!1;var a=getPositionOnElement(e,t,this.instance.currentZoom),l={element:t};if(extend(l,r),l.isTemporarySource=!0,r.scope)l.scope=r.scope;else{var u=i.getAttribute(ke);null!=u&&(l.scope=u)}if(null!=(l=merge(l,r.parameterExtractor?r.parameterExtractor(t,i,e):{})).maxConnections&&l.maxConnections>=0)if(this.instance.select({source:t}).length>=l.maxConnections)return consume(e),r.onMaxConnections&&r.onMaxConnections({element:t,maxConnections:l.maxConnections},e),e.stopImmediatePropagation&&e.stopImmediatePropagation(),!1;if(r.anchorPositionFinder){var h=r.anchorPositionFinder(t,a,r,e);null!=h&&(l.anchor=h)}this._originalAnchorSpec=l.anchor||(this.instance.areDefaultAnchorsSet()?this.instance.defaults.anchors[0]:this.instance.defaults.anchor);var d=this.instance.router.prepareAnchor(this._originalAnchorSpec),p=[a.x,a.y,0,0];if(d.locations.length>0)p[2]=d.locations[0].ox,p[3]=d.locations[0].oy;else if(d.isContinuous){var v=a.x<.5?a.x:1-a.x,g=a.y<.5?a.y:1-a.y;p[2]=v<g?a.x<.5?-1:1:0,p[3]=g<v?a.y<.5?-1:1:0}l.anchor=p,l.deleteOnEmpty=!0,this.ep=this.instance._internal_newEndpoint(l);var _={};if(r.extract){for(var m in r.extract){var E=i.getAttribute(m);E&&(_[r.extract[m]]=E)}this.ep.mergeParameters(_)}if(l.uniqueEndpoint){var P=this.ep.elementId,C=this.instance.getManagedData(P,mi,n.id);null==C?(this.instance.setManagedData(P,mi,n.id,this.ep),this.ep.deleteOnEmpty=!1):this.ep.finalEndpoint=C}o._jsPlumbOrphanedEndpoints=o._jsPlumbOrphanedEndpoints||[],o._jsPlumbOrphanedEndpoints.push(this.ep),this.instance.trigger(this.ep.endpoint.canvas,Ne,e,_)}}}}},{key:"_mouseupHandler",value:function _mouseupHandler(e){var t=e.currentTarget||e.srcElement;t._jsPlumbOrphanedEndpoints&&(each(t._jsPlumbOrphanedEndpoints,this.instance._maybePruneEndpoint.bind(this.instance)),t._jsPlumbOrphanedEndpoints.length=0),this._activeDefinition=null}},{key:"onDragInit",value:function onDragInit(e){var t=getElementPosition(e,this.instance),n=getElementSize(e,this.instance);return this._makeDraggablePlaceholder(t,n),this.placeholderInfo.element.jtk=e.jtk,this.placeholderInfo.element}},{key:"onDragAbort",value:function onDragAbort(e){this._cleanupDraggablePlaceholder()}},{key:"_makeDraggablePlaceholder",value:function _makeDraggablePlaceholder(e,t){this.placeholderInfo=this.placeholderInfo||{};var n=createElement(De,{position:"absolute"});this.instance._appendElementToContainer(n);var i=this.instance.getId(n);return this.instance.setPosition(n,e),n.style.width=t.w+"px",n.style.height=t.h+"px",this.instance.manage(n),this.placeholderInfo.id=i,this.placeholderInfo.element=n,n}},{key:"_cleanupDraggablePlaceholder",value:function _cleanupDraggablePlaceholder(){this.placeholderInfo.element&&(this.instance.unmanage(this.placeholderInfo.element,!0),delete this.placeholderInfo.element,delete this.placeholderInfo.id)}},{key:"reset",value:function reset(){var e=this.instance.getContainer();this.instance.off(e,Be,this.mouseupHandler),this.instance.off(e,Ne,this.mousedownHandler)}},{key:"init",value:function init(e){}},{key:"startNewConnectionDrag",value:function startNewConnectionDrag(e,t){this.jpc=this.instance._newConnection({sourceEndpoint:this.ep,targetEndpoint:this.floatingEndpoint,source:this.ep.element,target:this.placeholderInfo.element,paintStyle:this.ep.connectorStyle,hoverPaintStyle:this.ep.connectorHoverStyle,connector:this.ep.connector,overlays:this.ep.connectorOverlays,type:this.ep.edgeType,cssClass:this.ep.connectorClass,hoverClass:this.ep.connectorHoverClass,scope:e,data:t}),this.jpc.pending=!0,this.jpc.addClass(this.instance.draggingClass),this.ep.addClass(this.instance.draggingClass),this.instance.fire(Qe,this.jpc)}},{key:"startExistingConnectionDrag",value:function startExistingConnectionDrag(){this.existingJpc=!0,this.instance.setHover(this.jpc,!1);var e=this.jpc.endpoints[0].id===this.ep.id?0:1;this.ep.detachFromConnection(this.jpc,null,!0),this.floatingEndpoint.addConnection(this.jpc),this.instance.fire(Qe,this.jpc),this.instance.sourceOrTargetChanged(this.jpc.endpoints[e].elementId,this.placeholderInfo.id,this.jpc,this.placeholderInfo.element,e),this.jpc.suspendedEndpoint=this.jpc.endpoints[e],this.jpc.suspendedElement=this.jpc.endpoints[e].element,this.jpc.suspendedElementId=this.jpc.endpoints[e].elementId,this.jpc.suspendedElementType=0===e?r:o,this.instance.setHover(this.jpc.suspendedEndpoint,!1),this.floatingEndpoint.referenceEndpoint=this.jpc.suspendedEndpoint,this.floatingEndpoint.mergeParameters(this.jpc.suspendedEndpoint.parameters),this.jpc.endpoints[e]=this.floatingEndpoint,this.jpc.addClass(this.instance.draggingClass),this.floatingId=this.placeholderInfo.id,this.floatingIndex=e,this.instance._refreshEndpoint(this.ep)}},{key:"_shouldStartDrag",value:function _shouldStartDrag(){var e=!0;this.ep.enabled||(e=!1),null!=this.jpc||this.ep.isSource||this.ep.isTemporarySource||(e=!1),!this.ep.isSource||!this.ep.isFull()||null!=this.jpc&&this.ep.dragAllowedWhenFull||(e=!1),null==this.jpc||this.jpc.isDetachable(this.ep)||(this.ep.isFull()?e=!1:this.jpc=null);var t={},n=this.instance.checkCondition(null==this.jpc?oe:le,{endpoint:this.ep,source:this.ep.element,sourceId:this.ep.elementId,connection:this.jpc});return!1===n?e=!1:"object"===_typeof(n)?extend(t=n,this.payload||{}):t=this.payload||{},[e,t]}},{key:"_createFloatingEndpoint",value:function _createFloatingEndpoint(e){var t=this.ep.endpoint;null!=this.ep.edgeType&&(t=this.instance._deriveEndpointAndAnchorSpec(this.ep.edgeType).endpoints[1]);this.floatingEndpoint=function _makeFloatingEndpoint(e,t,n,i,r,o){var a=createFloatingAnchor(o,i,r),l={paintStyle:e.getPaintStyle(),preparedAnchor:a,element:i,scope:e.scope,cssClass:[O,e.cssClass].join(" ")};null!=t&&(isAssignableFrom(t,qn)?l.existingEndpoint=t:l.endpoint=t);var u=o._internal_newEndpoint(l);return o._paintEndpoint(u,{}),u}(this.ep,t,0,this.placeholderInfo.element,this.placeholderInfo.id,this.instance),this.floatingAnchor=this.floatingEndpoint._anchor,this.floatingEndpoint.deleteOnEmpty=!0,this.floatingElement=this.floatingEndpoint.endpoint.canvas,this.floatingId=this.instance.getId(this.floatingElement)}},{key:"_populateTargets",value:function _populateTargets(e,t){var n,i=this,r=this.jpc&&this.jpc.endpoints[0]===this.ep;if(forEach(this.instance.getContainer().querySelectorAll([".",k,"[",E,this.ep.scope,"]:not(.",O,")"].join("")),(function(t){if(!(null==i.jpc&&t===e||t===i.floatingElement||null==i.jpc&&t.jtk.endpoint.isFull())&&(r&&t.jtk.endpoint.isSource||!r&&t.jtk.endpoint.isTarget)){var o=getElementPosition(t,i.instance),a=getElementSize(t,i.instance);n={x:o.x,y:o.y,w:a.w,h:a.h},i.endpointDropTargets.push({el:t,targetEl:t,r:n,endpoint:t.jtk.endpoint,def:null}),i.instance.addClass(t,Gn)}})),r){var o=getWithFunction(this.instance.sourceSelectors,(function(e){return e.isEnabled()&&(null==e.def.def.scope||e.def.def.scope===i.ep.scope)}));if(null!=o)forEach(this._findTargetZones(o),(function(e){if(e.getAttribute(Se)!==Rt){var t=e.getAttribute(ke);if(null!=t&&t!==i.ep.scope)return;var n={r:null,el:e};n.targetEl=findParent(e,ce,i.instance.getContainer(),!0);var r=getElementPosition(n.el,i.instance),a=getElementSize(n.el,i.instance);n.r={x:r.x,y:r.y,w:a.w,h:a.h},null!=o.def.def.rank&&(n.rank=o.def.def.rank),n.def=o.def,i.endpointDropTargets.push(n),i.instance.addClass(n.targetEl,Gn)}}))}else{getAllWithFunction(this.instance.targetSelectors,(function(e){return e.isEnabled()})).forEach((function(e){forEach(i._findTargetZones(e),(function(n){if(n.getAttribute(Se)!==Rt){var r=n.getAttribute(ke);if(null!=r&&r!==i.ep.scope)return;var o={r:null,el:n};if(null!=e.def.def.parentSelector&&(o.targetEl=findParent(n,e.def.def.parentSelector,i.instance.getContainer(),!0)),null==o.targetEl&&(o.targetEl=findParent(n,ce,i.instance.getContainer(),!0)),(!1===e.def.def.allowLoopback||i._activeDefinition&&!1===i._activeDefinition.def.def.allowLoopback)&&o.targetEl===i.ep.element)return;if(null!=e.def.def.canAcceptNewConnection&&!e.def.def.canAcceptNewConnection(o.targetEl,t))return;var a=e.def.def.maxConnections;if(null!=a&&-1!==a&&i.instance.select({target:o.targetEl}).length>=a)return;var l=getElementPosition(n,i.instance),u=getElementSize(n,i.instance);o.r={x:l.x,y:l.y,w:u.w,h:u.h},o.def=e.def,null!=e.def.def.rank&&(o.rank=e.def.def.rank),i.endpointDropTargets.push(o),i.instance.addClass(o.targetEl,Gn)}}))}))}this.endpointDropTargets.sort((function(e,t){if(e.targetEl._isJsPlumbGroup&&!t.targetEl._isJsPlumbGroup)return 1;if(!e.targetEl._isJsPlumbGroup&&t.targetEl._isJsPlumbGroup)return-1;if(e.targetEl._isJsPlumbGroup&&t.targetEl._isJsPlumbGroup){if(i.instance.groupManager.isAncestor(e.targetEl._jsPlumbGroup,t.targetEl._jsPlumbGroup))return-1;if(i.instance.groupManager.isAncestor(t.targetEl._jsPlumbGroup,e.targetEl._jsPlumbGroup))return 1}else{if(null==e.rank||null==t.rank)return 0;if(e.rank>t.rank)return-1;if(e.rank<t.rank)return 1}}))}},{key:"_findTargetZones",value:function _findTargetZones(e){var t;if("any"===e.redrop){var n=this.instance.targetSelectors.map((function(e){return e.selector}));n.push.apply(n,_toConsumableArray(this.instance.sourceSelectors.map((function(e){return e.selector})))),n.push(ce),t=n.join(",")}else if(e.redrop===fi)t=e.selector;else if(e.redrop===yi)t=this.instance.sourceSelectors.map((function(e){return e.selector})).join(",");else if(e.redrop===vi)t=this.instance.targetSelectors.map((function(e){return e.selector})).join(",");else if(e.redrop===gi){var i=this.instance.targetSelectors.map((function(e){return e.selector}));i.push.apply(i,_toConsumableArray(this.instance.sourceSelectors.map((function(e){return e.selector})))),t=i.join(",")}return this.instance.getContainer().querySelectorAll(t)}},{key:"onStart",value:function onStart(e){this.endpointDropTargets.length=0,this.currentDropTarget=null,this._stopped=!1;var t=e.drag.getDragElement();if(this.ep=t.jtk.endpoint,!this.ep)return!1;this.endpointRepresentation=this.ep.endpoint,this.canvasElement=this.endpointRepresentation.canvas,this.jpc=this.ep.connectorSelector();var n=_slicedToArray(this._shouldStartDrag(),2),i=n[0],r=n[1];if(!1===i)return this._stopped=!0,!1;this.instance.setHover(this.ep,!1),this.instance.isConnectionBeingDragged=!0,this.jpc&&!this.ep.isFull()&&this.ep.isSource&&(this.jpc=null),this._createFloatingEndpoint(this.canvasElement),this._populateTargets(this.canvasElement,e.e),null==this.jpc?this.startNewConnectionDrag(this.ep.scope,r):this.startExistingConnectionDrag(),this._registerFloatingConnection(this.placeholderInfo,this.jpc),this.instance.currentlyDragging=!0}},{key:"onBeforeStart",value:function onBeforeStart(e){this.payload=e.e.payload||{}}},{key:"onDrag",value:function onDrag(e){if(this._stopped)return!0;if(this.placeholderInfo.element){var t=getElementSize(this.floatingElement,this.instance);this.instance.setElementPosition(this.placeholderInfo.element,e.pos.x,e.pos.y);for(var n,i,r={x:e.pos.x,y:e.pos.y,w:t.w,h:t.h},o=0;o<this.endpointDropTargets.length;o++)if(intersects(r,this.endpointDropTargets[o].r)){n=this.endpointDropTargets[o];break}if(n!==this.currentDropTarget&&null!=this.currentDropTarget&&(i=this._getFloatingAnchorIndex(),this.instance.removeClass(this.currentDropTarget.el,Nn),this.currentDropTarget.endpoint&&(this.currentDropTarget.endpoint.endpoint.removeClass(this.instance.endpointDropAllowedClass),this.currentDropTarget.endpoint.endpoint.removeClass(this.instance.endpointDropForbiddenClass)),this.floatingAnchor.out()),null!=n)if(this.instance.addClass(n.el,Nn),i=this._getFloatingAnchorIndex(),null!=n.endpoint)if(n.endpoint.isSource&&0===i||n.endpoint.isTarget&&0!==i||this.jpc.suspendedEndpoint&&n.endpoint.referenceEndpoint&&n.endpoint.referenceEndpoint.id===this.jpc.suspendedEndpoint.id)this.instance.checkCondition(C,{sourceEndpoint:this.jpc.endpoints[i],targetEndpoint:n.endpoint.endpoint,connection:this.jpc})?(n.endpoint.endpoint.addClass(this.instance.endpointDropAllowedClass),n.endpoint.endpoint.removeClass(this.instance.endpointDropForbiddenClass)):(n.endpoint.endpoint.removeClass(this.instance.endpointDropAllowedClass),n.endpoint.endpoint.addClass(this.instance.endpointDropForbiddenClass)),this.floatingAnchor.over(n.endpoint),this.instance._paintConnection(this.jpc);else n=null;this.currentDropTarget=n}}},{key:"_maybeCleanup",value:function _maybeCleanup(e){e._mtNew&&0===e.connections.length?this.instance.deleteEndpoint(e):delete e._mtNew}},{key:"_reattachOrDiscard",value:function _reattachOrDiscard(e){var t=null!=this.jpc.suspendedEndpoint,n=this._getFloatingAnchorIndex();return t&&this._shouldReattach()?(0===n?(this.jpc.source=this.jpc.suspendedElement,this.jpc.sourceId=this.jpc.suspendedElementId):(this.jpc.target=this.jpc.suspendedElement,this.jpc.targetId=this.jpc.suspendedElementId),this._doForceReattach(n),!0):(this._discard(n,e),!1)}},{key:"onStop",value:function onStop(e){var t=this,n=e.e;this.instance.isConnectionBeingDragged=!1,this.instance.currentlyDragging=!1;var i=classList(Nn,Gn);if(forEach(this.instance.getContainer().querySelectorAll(_i),(function(e){t.instance.removeClass(e,i)})),this.jpc&&null!=this.jpc.endpoints){var r,o=null!=this.jpc.suspendedEndpoint,a=this._getFloatingAnchorIndex(),l=this.jpc.suspendedEndpoint;if(null!=this.currentDropTarget)if(null==(r=this._getDropEndpoint(e,this.jpc)))this._reattachOrDiscard(e.e);else if(l&&l.id===r.id)this._doForceReattach(a);else if(r.enabled)if(r.isFull())r.fire(Q,{endpoint:this,connection:this.jpc,maxConnections:this.instance.defaults.maxConnections},n),this._reattachOrDiscard(e.e);else{0===a?(this.jpc.source=r.element,this.jpc.sourceId=r.elementId):(this.jpc.target=r.element,this.jpc.targetId=r.elementId);var u=!0;o&&this.jpc.suspendedEndpoint.id!==r.id&&(this.jpc.isDetachAllowed(this.jpc)&&this.jpc.endpoints[a].isDetachAllowed(this.jpc)&&this.jpc.suspendedEndpoint.isDetachAllowed(this.jpc)&&this.instance.checkCondition("beforeDetach",this.jpc)||(u=!1)),(u=u&&r.isDropAllowed(this.jpc.sourceId,this.jpc.targetId,this.jpc.scope,this.jpc,r))?this._drop(r,a,n,u):this._reattachOrDiscard(e.e)}else this._reattachOrDiscard(e.e);else this._reattachOrDiscard(e.e);this.instance._refreshEndpoint(this.ep),this.ep.removeClass(this.instance.draggingClass),this._cleanupDraggablePlaceholder(),this.jpc.removeClass(this.instance.draggingClass),delete this.jpc.suspendedEndpoint,delete this.jpc.suspendedElement,delete this.jpc.suspendedElementType,delete this.jpc.suspendedElementId,delete this.jpc.suspendedIndex,delete this.floatingId,delete this.floatingIndex,delete this.floatingElement,delete this.floatingEndpoint,delete this.floatingAnchor,delete this.jpc.pending,null!=r&&this._maybeCleanup(r)}}},{key:"_getSourceDefinition",value:function _getSourceDefinition(e){for(var t,n=this.instance.getContainer(),i=0;i<this.instance.sourceSelectors.length;i++){if((t=this.instance.sourceSelectors[i]).isEnabled())if(!1!==selectorFilter(e,n,t.selector,this.instance,t.exclude))return t}}},{key:"_getDropEndpoint",value:function _getDropEndpoint(e,t){var n;if(null==this.currentDropTarget.endpoint){var i=this.currentDropTarget.def,r=e.e.target||e.e.srcElement;if(null==i)return null;var o=this.currentDropTarget.targetEl,a=getPositionOnElement(e.e,o,this.instance.currentZoom),l=this.instance._deriveEndpointAndAnchorSpec(t.getType().join(" "),!0),u=l.endpoints?extend(e,{endpoint:i.def.endpoint||l.endpoints[1],cssClass:i.def.cssClass||"",source:!0===i.def.source,target:!0===i.def.target}):e,h=this.instance.validAnchorsSpec(l.anchors)?l.anchors:this.instance.areDefaultAnchorsSet()?this.instance.defaults.anchors:null,d=i.def.anchor,p=i.def.anchorPositionFinder?i.def.anchorPositionFinder(o,a,i.def,e.e):null,v=null!=p?p:null!=d?d:null!=h&&null!=h[1]?h[1]:null;if(null!=v&&(u=extend(u,{anchor:v})),null!=i.def.portId&&(u.portId=i.def.portId),(u=merge(u,i.def.parameterExtractor?i.def.parameterExtractor(this.currentDropTarget.el,r,e.e):{})).element=o,(n=this.instance._internal_newEndpoint(u))._mtNew=!0,n.deleteOnEmpty=!0,i.def.parameters&&n.mergeParameters(i.def.parameters),i.def.extract){var g={};for(var _ in i.def.extract){var m=this.currentDropTarget.el.getAttribute(_);m&&(g[i.def.extract[_]]=m)}n.mergeParameters(g)}}else n=this.currentDropTarget.endpoint;return n&&(n.removeClass(this.instance.endpointDropAllowedClass),n.removeClass(this.instance.endpointDropForbiddenClass)),n}},{key:"_doForceReattach",value:function _doForceReattach(e){this.floatingEndpoint.detachFromConnection(this.jpc,null,!0),this.jpc.endpoints[e]=this.jpc.suspendedEndpoint,this.instance.setHover(this.jpc,!1),this.jpc._forceDetach=!0,this.jpc.suspendedEndpoint.addConnection(this.jpc),this.instance.sourceOrTargetChanged(this.floatingId,this.jpc.suspendedEndpoint.elementId,this.jpc,this.jpc.suspendedEndpoint.element,e),this.instance.deleteEndpoint(this.floatingEndpoint),this.instance.repaint(this.jpc.source),delete this.jpc._forceDetach}},{key:"_shouldReattach",value:function _shouldReattach(){if(this.jpc.isReattach()||this.jpc._forceReattach)return!0;var e=this.jpc.suspendedEndpoint,t=this.jpc.suspendedElementType==r?1:0,n=this.jpc.endpoints[t];return!functionChain(!0,!1,[[e,re,[this.jpc]],[n,re,[this.jpc]],[this.jpc,re,[this.jpc]],[this.instance,P,[ae,this.jpc]]])}},{key:"_discard",value:function _discard(e,t){this.jpc.pending?this.instance.fire(Ze,this.jpc,t):(0===e?(this.jpc.source=this.jpc.suspendedEndpoint.element,this.jpc.sourceId=this.jpc.suspendedEndpoint.elementId):(this.jpc.target=this.jpc.suspendedEndpoint.element,this.jpc.targetId=this.jpc.suspendedEndpoint.elementId),this.jpc.endpoints[e]=this.jpc.suspendedEndpoint),this.floatingEndpoint&&this.floatingEndpoint.detachFromConnection(this.jpc),this.instance.deleteConnection(this.jpc,{originalEvent:t,force:!0})}},{key:"_drop",value:function _drop(e,t,n,i){if(this.jpc.endpoints[t].detachFromConnection(this.jpc),this.jpc.suspendedEndpoint&&this.jpc.suspendedEndpoint.detachFromConnection(this.jpc),this.jpc.endpoints[t]=e,e.addConnection(this.jpc),this.jpc.suspendedEndpoint){var r=this.jpc.suspendedEndpoint.elementId;this.instance.fireMoveEvent({index:t,originalSourceId:0===t?r:this.jpc.sourceId,newSourceId:0===t?e.elementId:this.jpc.sourceId,originalTargetId:1===t?r:this.jpc.targetId,newTargetId:1===t?e.elementId:this.jpc.targetId,originalEndpoint:this.jpc.suspendedEndpoint,connection:this.jpc,newEndpoint:e},n)}(1===t?this.instance.sourceOrTargetChanged(this.floatingId,this.jpc.targetId,this.jpc,this.jpc.target,1):this.instance.sourceOrTargetChanged(this.floatingId,this.jpc.sourceId,this.jpc,this.jpc.source,0),this.jpc.endpoints[0].finalEndpoint)&&(this.jpc.endpoints[0].detachFromConnection(this.jpc),this.jpc.endpoints[0]=this.jpc.endpoints[0].finalEndpoint,this.jpc.endpoints[0].addConnection(this.jpc));isObject(i)&&this.jpc.mergeData(i),this._originalAnchorSpec&&(this.jpc.endpoints[0].setAnchor(this._originalAnchorSpec),this._originalAnchorSpec=null),this.instance._finaliseConnection(this.jpc,null,n),this.instance.setHover(this.jpc,!1),this.instance.revalidate(this.jpc.endpoints[0].element)}},{key:"_registerFloatingConnection",value:function _registerFloatingConnection(e,t){this.floatingConnections[e.id]=t}},{key:"_getFloatingAnchorIndex",value:function _getFloatingAnchorIndex(){return null==this.floatingIndex?1:this.floatingIndex}}]),EndpointDragHandler}(),Pi=function(e){_inherits(GroupDragHandler,e);var t=_createSuper(GroupDragHandler);function GroupDragHandler(e,n){var i;return _classCallCheck(this,GroupDragHandler),(i=t.call(this,e,n)).instance=e,i.dragSelection=n,_defineProperty(_assertThisInitialized(i),"selector",[">",Dt,ce].join(" ")),_defineProperty(_assertThisInitialized(i),"doRevalidate",void 0),i.doRevalidate=i._revalidate.bind(_assertThisInitialized(i)),i}return _createClass(GroupDragHandler,[{key:"reset",value:function reset(){this.drag.off($e,this.doRevalidate)}},{key:"_revalidate",value:function _revalidate(e){this.instance.revalidate(e)}},{key:"init",value:function init(e){this.drag=e,e.on($e,this.doRevalidate)}},{key:"useGhostProxy",value:function useGhostProxy(e,t){var n=t._jsPlumbParentGroup;return null!=n&&!0===n.ghost}},{key:"makeGhostProxy",value:function makeGhostProxy(e){var t=e,n=t.cloneNode(!0);return n._jsPlumbParentGroup=t._jsPlumbParentGroup,n}}]),GroupDragHandler}(Vn),Ci=function(){function HTMLElementOverlay(e,t){_classCallCheck(this,HTMLElementOverlay),this.instance=e,this.overlay=t,_defineProperty(this,"htmlElementOverlay",void 0),this.htmlElementOverlay=t}return _createClass(HTMLElementOverlay,null,[{key:"getElement",value:function getElement(e,t,n){if(null==e.canvas){if(n&&t){e.canvas=n(t);var i=e.instance.overlayClass+" "+(e.cssClass?e.cssClass:"");e.instance.addClass(e.canvas,i)}else e.canvas=createElement(De,{},e.instance.overlayClass+" "+(e.cssClass?e.cssClass:""));for(var r in e.instance.setAttribute(e.canvas,"jtk-overlay-id",e.id),e.attributes)e.instance.setAttribute(e.canvas,r,e.attributes[r]);e.canvas.style.position=u,e.instance._appendElement(e.canvas,e.instance.getContainer()),e.instance.getId(e.canvas);var o="translate(-50%, -50%)";e.canvas.style.webkitTransform=o,e.canvas.style.mozTransform=o,e.canvas.style.msTransform=o,e.canvas.style.oTransform=o,e.canvas.style.transform=o,e.isVisible()||(e.canvas.style.display=l),e.canvas.jtk={overlay:e}}return e.canvas}},{key:"destroy",value:function destroy(e){e.canvas&&e.canvas.parentNode&&e.canvas.parentNode.removeChild(e.canvas),delete e.canvas,delete e.cachedDimensions}},{key:"_getDimensions",value:function _getDimensions(e,t){return(null==e.cachedDimensions||t)&&(e.cachedDimensions={w:1,h:1}),e.cachedDimensions}}]),HTMLElementOverlay}(),xi=function(){function EventGenerator(){_classCallCheck(this,EventGenerator),_defineProperty(this,"_listeners",{}),_defineProperty(this,"eventsSuspended",!1),_defineProperty(this,"tick",!1),_defineProperty(this,"eventsToDieOn",{ready:!0}),_defineProperty(this,"queue",[])}return _createClass(EventGenerator,[{key:"fire",value:function fire(e,t,n){var i=null;if(this.tick)this.queue.unshift(arguments);else{if(this.tick=!0,!this.eventsSuspended&&this._listeners[e]){var r=this._listeners[e].length,o=0,a=!1;if(!this.shouldFireEvent||this.shouldFireEvent(e,t,n))for(;!a&&o<r&&!1!==i;){if(this.eventsToDieOn[e])this._listeners[e][o](t,n);else try{i=this._listeners[e][o](t,n)}catch(t){log("jsPlumb: fire failed for event "+e+" : "+(t.message||t))}o++,null!=this._listeners&&null!=this._listeners[e]||(a=!0)}}this.tick=!1,this._drain()}return i}},{key:"_drain",value:function _drain(){var e=this.queue.pop();e&&this.fire.apply(this,e)}},{key:"unbind",value:function unbind(e,t){if(0===arguments.length)this._listeners={};else if(1===arguments.length){if("string"==typeof e)delete this._listeners[e];else if(e.__jsPlumb){var n;for(var i in e.__jsPlumb)n=e.__jsPlumb[i],remove(this._listeners[n]||[],e)}}else 2===arguments.length&&remove(this._listeners[e]||[],t);return this}},{key:"getListener",value:function getListener(e){return this._listeners[e]||[]}},{key:"isSuspendEvents",value:function isSuspendEvents(){return this.eventsSuspended}},{key:"setSuspendEvents",value:function setSuspendEvents(e){this.eventsSuspended=e}},{key:"bind",value:function bind(e,t,n){var i=this,r=function _one(e){addToDictionary(i._listeners,e,t,n),t.__jsPlumb=t.__jsPlumb||{},t.__jsPlumb[uuid()]=e};if("string"==typeof e)r(e);else if(null!=e.length)for(var o=0;o<e.length;o++)r(e[o]);return this}},{key:"silently",value:function silently(e){this.setSuspendEvents(!0);try{e()}catch(e){log("Cannot execute silent function "+e)}this.setSuspendEvents(!1)}}]),EventGenerator}(),Ti=function(e){_inherits(OptimisticEventGenerator,e);var t=_createSuper(OptimisticEventGenerator);function OptimisticEventGenerator(){return _classCallCheck(this,OptimisticEventGenerator),t.apply(this,arguments)}return _createClass(OptimisticEventGenerator,[{key:"shouldFireEvent",value:function shouldFireEvent(e,t,n){return!0}}]),OptimisticEventGenerator}(xi);function convertToFullOverlaySpec(e){var t=null;return(t=isString(e)?{type:e,options:{}}:e).options.id=t.options.id||uuid(),t}var bi=function(e){_inherits(Overlay,e);var t=_createSuper(Overlay);function Overlay(e,n,i){var r;for(var o in _classCallCheck(this,Overlay),(r=t.call(this)).instance=e,r.component=n,_defineProperty(_assertThisInitialized(r),"id",void 0),_defineProperty(_assertThisInitialized(r),"type",void 0),_defineProperty(_assertThisInitialized(r),"cssClass",void 0),_defineProperty(_assertThisInitialized(r),"visible",!0),_defineProperty(_assertThisInitialized(r),"location",void 0),_defineProperty(_assertThisInitialized(r),"events",void 0),_defineProperty(_assertThisInitialized(r),"attributes",void 0),i=i||{},r.id=i.id||uuid(),r.cssClass=i.cssClass||"",r.setLocation(i.location),r.events=i.events||{},r.attributes=i.attributes||{},r.events)r.bind(o,r.events[o]);return r}return _createClass(Overlay,[{key:"setLocation",value:function setLocation(e){var t=null==this.location?.5:this.location;if(null!=e)try{var n="string"==typeof e?parseFloat(e):e;isNaN(n)||(t=n)}catch(e){}this.location=t}},{key:"shouldFireEvent",value:function shouldFireEvent(e,t,n){return!0}},{key:"setVisible",value:function setVisible(e){this.visible=e,this.instance.setOverlayVisible(this,e)}},{key:"isVisible",value:function isVisible(){return this.visible}}]),Overlay}(xi),Si={},ki={get:function get(e,t,n,i){var r=Si[t];if(r)return new r(e,n,i);throw{message:"jsPlumb: unknown overlay type '"+t+"'"}},register:function register(e,t){Si[e]=t}},Ii=function(e){_inherits(LabelOverlay,e);var t=_createSuper(LabelOverlay);function LabelOverlay(e,n,i){var r;return _classCallCheck(this,LabelOverlay),(r=t.call(this,e,n,i)).instance=e,r.component=n,_defineProperty(_assertThisInitialized(r),"label",void 0),_defineProperty(_assertThisInitialized(r),"labelText",void 0),_defineProperty(_assertThisInitialized(r),"type",LabelOverlay.type),_defineProperty(_assertThisInitialized(r),"cachedDimensions",void 0),i=i||{label:""},r.setLabel(i.label),r}return _createClass(LabelOverlay,[{key:"getLabel",value:function getLabel(){return isFunction(this.label)?this.label(this):this.labelText}},{key:"setLabel",value:function setLabel(e){this.label=e,this.labelText=null,this.instance.updateLabel(this)}},{key:"getDimensions",value:function getDimensions(){return{w:1,h:1}}},{key:"updateFrom",value:function updateFrom(e){null!=e.label&&this.setLabel(e.label),null!=e.location&&(this.setLocation(e.location),this.instance.updateLabel(this))}}]),LabelOverlay}(bi);function isLabelOverlay(e){return e.type===Ii.type}function _splitType(e){return null==e?null:e.split(" ").filter((function(e){return null!=e&&e.length>0}))}function _mapType(e,t,n){for(var i in t)e[i]=n}_defineProperty(Ii,"type","Label"),ki.register(Ii.type,Ii);var Ai="__default",Oi="__label",Di="overlay",wi="remove";function _applyTypes(e,t){if(e.getDefaultType){var n=e.getTypeDescriptor(),i={},r=e.getDefaultType(),o=extend({},r);_mapType(i,r,Ai),e._types.forEach((function(t){if(t!==Ai){var r=e.instance.getType(t,n);if(null!=r){var a=new Set(["connector","anchor","anchors"]);if("override"===r.mergeStrategy)for(var l in r)a.add(l);o=merge(o,r,["cssClass"],setToArray(a)),_mapType(i,r,t)}}})),t&&(o=populate(o,t,"_")),e.applyType(o,i)}}function _removeTypeCssHelper(e,t){var n=e.instance.getType(t,e.getTypeDescriptor());null!=n&&n.cssClass&&e.removeClass(n.cssClass)}function _updateHoverStyle(e){if(e.paintStyle&&e.hoverPaintStyle){var t={};extend(t,e.paintStyle),extend(t,e.hoverPaintStyle),e.hoverPaintStyle=t}}var Mi=function(e){_inherits(Component,e);var t=_createSuper(Component);function Component(e,n){var i;if(_classCallCheck(this,Component),(i=t.call(this)).instance=e,_defineProperty(_assertThisInitialized(i),"defaultLabelLocation",.5),_defineProperty(_assertThisInitialized(i),"overlays",{}),_defineProperty(_assertThisInitialized(i),"overlayPositions",{}),_defineProperty(_assertThisInitialized(i),"overlayPlacements",{}),_defineProperty(_assertThisInitialized(i),"clone",void 0),_defineProperty(_assertThisInitialized(i),"deleted",void 0),_defineProperty(_assertThisInitialized(i),"segment",void 0),_defineProperty(_assertThisInitialized(i),"x",void 0),_defineProperty(_assertThisInitialized(i),"y",void 0),_defineProperty(_assertThisInitialized(i),"w",void 0),_defineProperty(_assertThisInitialized(i),"h",void 0),_defineProperty(_assertThisInitialized(i),"id",void 0),_defineProperty(_assertThisInitialized(i),"visible",!0),_defineProperty(_assertThisInitialized(i),"typeId",void 0),_defineProperty(_assertThisInitialized(i),"params",{}),_defineProperty(_assertThisInitialized(i),"paintStyle",void 0),_defineProperty(_assertThisInitialized(i),"hoverPaintStyle",void 0),_defineProperty(_assertThisInitialized(i),"paintStyleInUse",void 0),_defineProperty(_assertThisInitialized(i),"_hover",!1),_defineProperty(_assertThisInitialized(i),"lastPaintedAt",void 0),_defineProperty(_assertThisInitialized(i),"data",void 0),_defineProperty(_assertThisInitialized(i),"_defaultType",void 0),_defineProperty(_assertThisInitialized(i),"events",void 0),_defineProperty(_assertThisInitialized(i),"parameters",void 0),_defineProperty(_assertThisInitialized(i),"_types",void 0),_defineProperty(_assertThisInitialized(i),"_typeCache",void 0),_defineProperty(_assertThisInitialized(i),"cssClass",void 0),_defineProperty(_assertThisInitialized(i),"hoverClass",void 0),_defineProperty(_assertThisInitialized(i),"beforeDetach",void 0),_defineProperty(_assertThisInitialized(i),"beforeDrop",void 0),n=n||{},i.cssClass=n.cssClass||"",i.hoverClass=n.hoverClass||e.defaults.hoverClass,i.beforeDetach=n.beforeDetach,i.beforeDrop=n.beforeDrop,i._types=new Set,i._typeCache={},i.parameters=clone(n.parameters||{}),i.id=n.id||i.getIdPrefix()+(new Date).getTime(),i._defaultType={parameters:i.parameters,scope:n.scope||i.instance.defaultScope,overlays:{}},n.events)for(var r in n.events)i.bind(r,n.events[r]);i.clone=function(){var t=Object.create(i.constructor.prototype);return i.constructor.apply(t,[e,n]),t},i.overlays={},i.overlayPositions={};var o=n.overlays||[],a={},l=i.getDefaultOverlayKey();if(l){var u=i.instance.defaults[l];u&&o.push.apply(o,_toConsumableArray(u));for(var h=0;h<o.length;h++){var d=convertToFullOverlaySpec(o[h]);a[d.options.id]=d}}return i._defaultType.overlays=a,n.label&&(i.getDefaultType().overlays[Oi]={type:Ii.type,options:{label:n.label,location:n.labelLocation||i.defaultLabelLocation,id:Oi,cssClass:"jtk-default-label"}}),i}return _createClass(Component,[{key:"isDetachAllowed",value:function isDetachAllowed(e){var t=!0;if(this.beforeDetach)try{t=this.beforeDetach(e)}catch(e){log("jsPlumb: beforeDetach callback failed",e)}return t}},{key:"isDropAllowed",value:function isDropAllowed(e,t,n,i,r){var o,a={sourceId:e,targetId:t,scope:n,connection:i,dropEndpoint:r};if(this.beforeDrop)try{o=this.beforeDrop(a)}catch(e){log("jsPlumb: beforeDrop callback failed",e)}else o=this.instance.checkCondition(se,a);return o}},{key:"getDefaultType",value:function getDefaultType(){return this._defaultType}},{key:"appendToDefaultType",value:function appendToDefaultType(e){for(var t in e)this._defaultType[t]=e[t]}},{key:"getId",value:function getId(){return this.id}},{key:"cacheTypeItem",value:function cacheTypeItem(e,t,n){this._typeCache[n]=this._typeCache[n]||{},this._typeCache[n][e]=t}},{key:"getCachedTypeItem",value:function getCachedTypeItem(e,t){return this._typeCache[t]?this._typeCache[t][e]:null}},{key:"setType",value:function setType(e,t){this.clearTypes(),(_splitType(e)||[]).forEach(this._types.add,this._types),_applyTypes(this,t)}},{key:"getType",value:function getType(){return Array.from(this._types.keys())}},{key:"reapplyTypes",value:function reapplyTypes(e){_applyTypes(this,e)}},{key:"hasType",value:function hasType(e){return this._types.has(e)}},{key:"addType",value:function addType(e,t){var n=_splitType(e),i=!1;if(null!=n){for(var r=0,o=n.length;r<o;r++)this._types.has(n[r])||(this._types.add(n[r]),i=!0);i&&_applyTypes(this,t)}}},{key:"removeType",value:function removeType(e,t){var n=this,i=_splitType(e),r=!1,o=function _one(e){return!!n._types.has(e)&&(_removeTypeCssHelper(n,e),n._types.delete(e),!0)};if(null!=i){for(var a=0,l=i.length;a<l;a++)r=o(i[a])||r;r&&_applyTypes(this,t)}}},{key:"clearTypes",value:function clearTypes(e){var t=this;this._types.forEach((function(e){_removeTypeCssHelper(t,e)})),this._types.clear(),_applyTypes(this,e)}},{key:"toggleType",value:function toggleType(e,t){var n=_splitType(e);if(null!=n){for(var i=0,r=n.length;i<r;i++)this._types.has(n[i])?(_removeTypeCssHelper(this,n[i]),this._types.delete(n[i])):this._types.add(n[i]);_applyTypes(this,t)}}},{key:"applyType",value:function applyType(e,t){if(this.setPaintStyle(e.paintStyle),this.setHoverPaintStyle(e.hoverPaintStyle),this.mergeParameters(e.parameters),this.paintStyleInUse=this.getPaintStyle(),e.overlays){var n,i={};for(n in e.overlays){var r=this.overlays[e.overlays[n].options.id];if(r)r.updateFrom(e.overlays[n].options),i[e.overlays[n].options.id]=!0,this.instance.reattachOverlay(r,this);else{var o=this.getCachedTypeItem(Di,e.overlays[n].options.id);null!=o?(this.instance.reattachOverlay(o,this),o.setVisible(!0),o.updateFrom(e.overlays[n].options),this.overlays[o.id]=o):o=this.addOverlay(e.overlays[n]),i[o.id]=!0}}for(n in this.overlays)null==i[this.overlays[n].id]&&this.removeOverlay(this.overlays[n].id,!0)}}},{key:"setPaintStyle",value:function setPaintStyle(e){this.paintStyle=e,this.paintStyleInUse=this.paintStyle,_updateHoverStyle(this)}},{key:"getPaintStyle",value:function getPaintStyle(){return this.paintStyle}},{key:"setHoverPaintStyle",value:function setHoverPaintStyle(e){this.hoverPaintStyle=e,_updateHoverStyle(this)}},{key:"getHoverPaintStyle",value:function getHoverPaintStyle(){return this.hoverPaintStyle}},{key:"destroy",value:function destroy(){for(var e in this.overlays)this.instance.destroyOverlay(this.overlays[e]);this.overlays={},this.overlayPositions={},this.unbind(),this.clone=null}},{key:"isHover",value:function isHover(){return this._hover}},{key:"mergeParameters",value:function mergeParameters(e){null!=e&&extend(this.parameters,e)}},{key:"setVisible",value:function setVisible(e){this.visible=e,e?this.showOverlays():this.hideOverlays()}},{key:"isVisible",value:function isVisible(){return this.visible}},{key:"setAbsoluteOverlayPosition",value:function setAbsoluteOverlayPosition(e,t){this.overlayPositions[e.id]=t}},{key:"getAbsoluteOverlayPosition",value:function getAbsoluteOverlayPosition(e){return this.overlayPositions?this.overlayPositions[e.id]:null}},{key:"_clazzManip",value:function _clazzManip(e,t){for(var n in this.overlays)"add"===e?this.instance.addOverlayClass(this.overlays[n],t):e===wi&&this.instance.removeOverlayClass(this.overlays[n],t)}},{key:"addClass",value:function addClass(e,t){var n=(this.cssClass||"").split(" ");n.push(e),this.cssClass=n.join(" "),this._clazzManip("add",e)}},{key:"removeClass",value:function removeClass(e,t){var n=(this.cssClass||"").split(" ");this.cssClass=n.filter((function(t){return t!==e})).join(" "),this._clazzManip(wi,e)}},{key:"getClass",value:function getClass(){return this.cssClass}},{key:"shouldFireEvent",value:function shouldFireEvent(e,t,n){return!0}},{key:"getData",value:function getData(){return this.data}},{key:"setData",value:function setData(e){this.data=e||{}}},{key:"mergeData",value:function mergeData(e){this.data=extend(this.data,e)}},{key:"addOverlay",value:function addOverlay(e){var t=function _processOverlay(e,t){var n=null;if(isString(t))n=ki.get(e.instance,t,e,{});else if(null!=t.type&&null!=t.options){var i=t,r=extend({},i.options);n=ki.get(e.instance,i.type,e,r)}else n=t;return n.id=n.id||uuid(),e.cacheTypeItem(Di,n,n.id),e.overlays[n.id]=n,n}(this,e);if(this.getData&&t.type===Ii.type&&!isString(e)){var n=this.getData(),i=e.options;if(n){var r=n[i.labelLocationAttribute||"labelLocation"];r&&(t.location=r)}}return t}},{key:"getOverlay",value:function getOverlay(e){return this.overlays[e]}},{key:"getOverlays",value:function getOverlays(){return this.overlays}},{key:"hideOverlay",value:function hideOverlay(e){var t=this.getOverlay(e);t&&t.setVisible(!1)}},{key:"hideOverlays",value:function hideOverlays(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(var i in t=t||[],this.overlays)0!==t.length&&-1===t.indexOf(i)||this.overlays[i].setVisible(!1)}},{key:"showOverlay",value:function showOverlay(e){var t=this.getOverlay(e);t&&t.setVisible(!0)}},{key:"showOverlays",value:function showOverlays(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(var i in t=t||[],this.overlays)0!==t.length&&-1===t.indexOf(i)||this.overlays[i].setVisible(!0)}},{key:"removeAllOverlays",value:function removeAllOverlays(){for(var e in this.overlays)this.instance.destroyOverlay(this.overlays[e]);this.overlays={},this.overlayPositions=null,this.overlayPlacements={}}},{key:"removeOverlay",value:function removeOverlay(e,t){var n=this.overlays[e];n&&(n.setVisible(!1),t||this.instance.destroyOverlay(n),delete this.overlays[e],this.overlayPositions&&delete this.overlayPositions[e],this.overlayPlacements&&delete this.overlayPlacements[e])}},{key:"removeOverlays",value:function removeOverlays(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(var i=0,r=t.length;i<r;i++)this.removeOverlay(arguments[i])}},{key:"getLabel",value:function getLabel(){var e=this.getLabelOverlay();return null!=e?e.getLabel():null}},{key:"getLabelOverlay",value:function getLabelOverlay(){return this.getOverlay(Oi)}},{key:"setLabel",value:function setLabel(e){var t=this.getLabelOverlay();if(t)if(isString(e)||isFunction(e))t.setLabel(e);else{var n=e;n.label&&t.setLabel(n.label),n.location&&(t.location=n.location)}else t=function _makeLabelOverlay(e,t){var n=extend({cssClass:t.cssClass,id:Oi,component:e},t);return new Ii(e.instance,e,n)}(this,isString(e)||isFunction(e)?{label:e}:e),this.overlays[Oi]=t}}]),Component}(xi),Li=["connectorStyle","connectorHoverStyle","connectorOverlays","connector","connectionType","connectorClass","connectorHoverClass"],Gi=function(t){_inherits(Endpoint,t);var n=_createSuper(Endpoint);function Endpoint(t,i){var r;_classCallCheck(this,Endpoint),(r=n.call(this,t,i)).instance=t,_defineProperty(_assertThisInitialized(r),"connections",[]),_defineProperty(_assertThisInitialized(r),"endpoint",void 0),_defineProperty(_assertThisInitialized(r),"element",void 0),_defineProperty(_assertThisInitialized(r),"elementId",void 0),_defineProperty(_assertThisInitialized(r),"dragAllowedWhenFull",!0),_defineProperty(_assertThisInitialized(r),"timestamp",void 0),_defineProperty(_assertThisInitialized(r),"portId",void 0),_defineProperty(_assertThisInitialized(r),"maxConnections",void 0),_defineProperty(_assertThisInitialized(r),"proxiedBy",void 0),_defineProperty(_assertThisInitialized(r),"connectorClass",void 0),_defineProperty(_assertThisInitialized(r),"connectorHoverClass",void 0),_defineProperty(_assertThisInitialized(r),"finalEndpoint",void 0),_defineProperty(_assertThisInitialized(r),"enabled",!0),_defineProperty(_assertThisInitialized(r),"isSource",void 0),_defineProperty(_assertThisInitialized(r),"isTarget",void 0),_defineProperty(_assertThisInitialized(r),"isTemporarySource",void 0),_defineProperty(_assertThisInitialized(r),"connectionCost",1),_defineProperty(_assertThisInitialized(r),"connectionsDirected",void 0),_defineProperty(_assertThisInitialized(r),"connectionsDetachable",void 0),_defineProperty(_assertThisInitialized(r),"reattachConnections",void 0),_defineProperty(_assertThisInitialized(r),"currentAnchorClass",void 0),_defineProperty(_assertThisInitialized(r),"referenceEndpoint",void 0),_defineProperty(_assertThisInitialized(r),"edgeType",void 0),_defineProperty(_assertThisInitialized(r),"connector",void 0),_defineProperty(_assertThisInitialized(r),"connectorOverlays",void 0),_defineProperty(_assertThisInitialized(r),"connectorStyle",void 0),_defineProperty(_assertThisInitialized(r),"connectorHoverStyle",void 0),_defineProperty(_assertThisInitialized(r),"deleteOnEmpty",void 0),_defineProperty(_assertThisInitialized(r),"uuid",void 0),_defineProperty(_assertThisInitialized(r),"scope",void 0),_defineProperty(_assertThisInitialized(r),"_anchor",void 0),_defineProperty(_assertThisInitialized(r),"defaultLabelLocation",[.5,.5]),r.appendToDefaultType({edgeType:i.edgeType,maxConnections:null==i.maxConnections?r.instance.defaults.maxConnections:i.maxConnections,paintStyle:i.paintStyle||r.instance.defaults.endpointStyle,hoverPaintStyle:i.hoverPaintStyle||r.instance.defaults.endpointHoverStyle,connectorStyle:i.connectorStyle,connectorHoverStyle:i.connectorHoverStyle,connectorClass:i.connectorClass,connectorHoverClass:i.connectorHoverClass,connectorOverlays:i.connectorOverlays,connector:i.connector}),r.enabled=!(!1===i.enabled),r.visible=!0,r.element=i.element,r.uuid=i.uuid,r.portId=i.portId,r.elementId=i.elementId,r.connectionCost=null==i.connectionCost?1:i.connectionCost,r.connectionsDirected=i.connectionsDirected,r.currentAnchorClass="",r.events={},r.connectorOverlays=i.connectorOverlays,r.connectorStyle=i.connectorStyle,r.connectorHoverStyle=i.connectorHoverStyle,r.connector=i.connector,r.edgeType=i.edgeType,r.connectorClass=i.connectorClass,r.connectorHoverClass=i.connectorHoverClass,r.deleteOnEmpty=!0===i.deleteOnEmpty,r.isSource=i.source||!1,r.isTemporarySource=i.isTemporarySource||!1,r.isTarget=i.target||!1,r.connections=i.connections||[],r.scope=i.scope||t.defaultScope,r.timestamp=null,r.reattachConnections=i.reattachConnections||t.defaults.reattachConnections,r.connectionsDetachable=t.defaults.connectionsDetachable,!1===i.connectionsDetachable&&(r.connectionsDetachable=!1),r.dragAllowedWhenFull=!1!==i.dragAllowedWhenFull,i.onMaxConnections&&r.bind(Q,i.onMaxConnections);var o=i.endpoint||i.existingEndpoint||t.defaults.endpoint;if(r.setEndpoint(o),null!=i.preparedAnchor)r.setPreparedAnchor(i.preparedAnchor);else{var a=i.anchor?i.anchor:i.anchors?i.anchors:t.defaults.anchor||e.AnchorLocations.Top;r.setAnchor(a)}var l=[zt,i.type||""].join(" ");return r.addType(l,i.data),r}return _createClass(Endpoint,[{key:"getIdPrefix",value:function getIdPrefix(){return"_jsplumb_e"}},{key:"getTypeDescriptor",value:function getTypeDescriptor(){return"endpoint"}},{key:"getXY",value:function getXY(){return{x:this.endpoint.x,y:this.endpoint.y}}},{key:"getDefaultOverlayKey",value:function getDefaultOverlayKey(){return"endpointOverlays"}},{key:"_updateAnchorClass",value:function _updateAnchorClass(){var e=this._anchor&&this._anchor.cssClass;if(null!=e&&e.length>0){var t=this.instance.endpointAnchorClassPrefix+"-"+this.currentAnchorClass;this.currentAnchorClass=e;var n=this.instance.endpointAnchorClassPrefix+(this.currentAnchorClass?"-"+this.currentAnchorClass:"");t!==n&&(this.removeClass(t),this.addClass(n),this.instance.removeClass(this.element,t),this.instance.addClass(this.element,n))}}},{key:"setPreparedAnchor",value:function setPreparedAnchor(e){return this.instance.router.setAnchor(this,e),this._updateAnchorClass(),this}},{key:"_anchorLocationChanged",value:function _anchorLocationChanged(e){this.fire(N,{endpoint:this,anchor:e}),this._updateAnchorClass()}},{key:"setAnchor",value:function setAnchor(e){var t=this.instance.router.prepareAnchor(e);return this.setPreparedAnchor(t),this}},{key:"addConnection",value:function addConnection(e){this.connections.push(e),this.instance._refreshEndpoint(this)}},{key:"detachFromConnection",value:function detachFromConnection(e,t,n){(t=null==t?this.connections.indexOf(e):t)>=0&&(this.connections.splice(t,1),this.instance._refreshEndpoint(this)),!n&&this.deleteOnEmpty&&0===this.connections.length&&this.instance.deleteEndpoint(this)}},{key:"deleteEveryConnection",value:function deleteEveryConnection(e){for(var t=this.connections.length,n=0;n<t;n++)this.instance.deleteConnection(this.connections[0],e)}},{key:"detachFrom",value:function detachFrom(e){for(var t=[],n=0;n<this.connections.length;n++)this.connections[n].endpoints[1]!==e&&this.connections[n].endpoints[0]!==e||t.push(this.connections[n]);for(var i=0,r=t.length;i<r;i++)this.instance.deleteConnection(t[0]);return this}},{key:"setVisible",value:function setVisible(e,t,n){if(_get(_getPrototypeOf(Endpoint.prototype),"setVisible",this).call(this,e),this.endpoint.setVisible(e),e?this.showOverlays():this.hideOverlays(),!t)for(var i=0;i<this.connections.length;i++)if(this.connections[i].setVisible(e),!n){var r=this===this.connections[i].endpoints[0]?1:0;1===this.connections[i].endpoints[r].connections.length&&this.connections[i].endpoints[r].setVisible(e,!0,!0)}}},{key:"applyType",value:function applyType(e,t){_get(_getPrototypeOf(Endpoint.prototype),"applyType",this).call(this,e,t),this.setPaintStyle(e.endpointStyle||e.paintStyle),this.setHoverPaintStyle(e.endpointHoverStyle||e.hoverPaintStyle),this.connectorStyle=e.connectorStyle,this.connectorHoverStyle=e.connectorHoverStyle,this.connector=e.connector,this.connectorOverlays=e.connectorOverlays,this.edgeType=e.edgeType,null!=e.maxConnections&&(this.maxConnections=e.maxConnections),e.scope&&(this.scope=e.scope),extend(e,Li),this.instance.applyEndpointType(this,e)}},{key:"destroy",value:function destroy(){_get(_getPrototypeOf(Endpoint.prototype),"destroy",this).call(this),this.deleted=!0,null!=this.endpoint&&this.instance.destroyEndpoint(this)}},{key:"isFull",value:function isFull(){return 0===this.maxConnections||!(this.isFloating()||this.maxConnections<0||this.connections.length<this.maxConnections)}},{key:"isFloating",value:function isFloating(){return this.instance.router.isFloating(this)}},{key:"isConnectedTo",value:function isConnectedTo(e){var t=!1;if(e)for(var n=0;n<this.connections.length;n++)if(this.connections[n].endpoints[1]===e||this.connections[n].endpoints[0]===e){t=!0;break}return t}},{key:"setDragAllowedWhenFull",value:function setDragAllowedWhenFull(e){this.dragAllowedWhenFull=e}},{key:"getUuid",value:function getUuid(){return this.uuid}},{key:"connectorSelector",value:function connectorSelector(){return this.connections[0]}},{key:"prepareEndpoint",value:function prepareEndpoint(e,t){var n,i={cssClass:this.cssClass,endpoint:this};if(isAssignableFrom(e,qn)){var r=e;(n=Wn.clone(r)).classes=i.cssClass.split(" ")}else if(isString(e))n=Wn.get(this,e,i);else{var o=e;extend(i,o.options||{}),n=Wn.get(this,o.type,i)}return n.typeId=t,n}},{key:"setEndpoint",value:function setEndpoint(e){var t=this.prepareEndpoint(e);this.setPreparedEndpoint(t)}},{key:"setPreparedEndpoint",value:function setPreparedEndpoint(e){null!=this.endpoint&&this.instance.destroyEndpoint(this),this.endpoint=e}},{key:"addClass",value:function addClass(e,t){_get(_getPrototypeOf(Endpoint.prototype),"addClass",this).call(this,e,t),null!=this.endpoint&&this.endpoint.addClass(e)}},{key:"removeClass",value:function removeClass(e,t){_get(_getPrototypeOf(Endpoint.prototype),"removeClass",this).call(this,e,t),null!=this.endpoint&&this.endpoint.removeClass(e)}}]),Endpoint}(Mi),ji="anchors",Ni="connector";function prepareEndpoint(e,t,n,i,r,o,a){var l;if(t)e.endpoints[n]=t,t.addConnection(e);else{var u=a||e.endpointSpec||e.endpointsSpec[n]||e.instance.defaults.endpoints[n]||e.instance.defaults.endpoint,h=e.endpointStyles[n]||e.endpointStyle||e.instance.defaults.endpointStyles[n]||e.instance.defaults.endpointStyle;null==h.fill&&null!=e.paintStyle&&(h.fill=e.paintStyle.stroke),null==h.outlineStroke&&null!=e.paintStyle&&(h.outlineStroke=e.paintStyle.outlineStroke),null==h.outlineWidth&&null!=e.paintStyle&&(h.outlineWidth=e.paintStyle.outlineWidth);var d=e.endpointHoverStyles[n]||e.endpointHoverStyle||e.endpointHoverStyle||e.instance.defaults.endpointHoverStyles[n]||e.instance.defaults.endpointHoverStyle;null!=e.hoverPaintStyle&&(null==d&&(d={}),null==d.fill&&(d.fill=e.hoverPaintStyle.stroke));var p=e.uuids?e.uuids[n]:null;i=null!=i?i:null!=e.instance.defaults.anchors?e.instance.defaults.anchors[n]:e.instance.defaults.anchor,l=e.instance._internal_newEndpoint({paintStyle:h,hoverPaintStyle:d,endpoint:u,connections:[e],uuid:p,element:r,scope:e.scope,anchor:i,reattachConnections:e.reattach||e.instance.defaults.reattachConnections,connectionsDetachable:e.detachable||e.instance.defaults.connectionsDetachable}),e.instance._refreshEndpoint(l),null==t&&(l.deleteOnEmpty=!0),e.endpoints[n]=l}return l}var zi=function(e){_inherits(Connection,e);var t=_createSuper(Connection);function Connection(e,n){var i;_classCallCheck(this,Connection),(i=t.call(this,e,n)).instance=e,_defineProperty(_assertThisInitialized(i),"connector",void 0),_defineProperty(_assertThisInitialized(i),"defaultLabelLocation",.5),_defineProperty(_assertThisInitialized(i),"scope",void 0),_defineProperty(_assertThisInitialized(i),"typeId","_jsplumb_connection"),_defineProperty(_assertThisInitialized(i),"previousConnection",void 0),_defineProperty(_assertThisInitialized(i),"sourceId",void 0),_defineProperty(_assertThisInitialized(i),"targetId",void 0),_defineProperty(_assertThisInitialized(i),"source",void 0),_defineProperty(_assertThisInitialized(i),"target",void 0),_defineProperty(_assertThisInitialized(i),"detachable",!0),_defineProperty(_assertThisInitialized(i),"reattach",!1),_defineProperty(_assertThisInitialized(i),"uuids",void 0),_defineProperty(_assertThisInitialized(i),"cost",1),_defineProperty(_assertThisInitialized(i),"directed",void 0),_defineProperty(_assertThisInitialized(i),"endpoints",[null,null]),_defineProperty(_assertThisInitialized(i),"endpointStyles",void 0),_defineProperty(_assertThisInitialized(i),"endpointSpec",void 0),_defineProperty(_assertThisInitialized(i),"endpointsSpec",void 0),_defineProperty(_assertThisInitialized(i),"endpointStyle",{}),_defineProperty(_assertThisInitialized(i),"endpointHoverStyle",{}),_defineProperty(_assertThisInitialized(i),"endpointHoverStyles",void 0),_defineProperty(_assertThisInitialized(i),"suspendedEndpoint",void 0),_defineProperty(_assertThisInitialized(i),"suspendedIndex",void 0),_defineProperty(_assertThisInitialized(i),"suspendedElement",void 0),_defineProperty(_assertThisInitialized(i),"suspendedElementId",void 0),_defineProperty(_assertThisInitialized(i),"suspendedElementType",void 0),_defineProperty(_assertThisInitialized(i),"_forceReattach",void 0),_defineProperty(_assertThisInitialized(i),"_forceDetach",void 0),_defineProperty(_assertThisInitialized(i),"proxies",[]),_defineProperty(_assertThisInitialized(i),"pending",!1),i.id=n.id,i.previousConnection=n.previousConnection,i.source=n.source,i.target=n.target,n.sourceEndpoint?(i.source=n.sourceEndpoint.element,i.sourceId=n.sourceEndpoint.elementId):i.sourceId=e.getId(i.source),n.targetEndpoint?(i.target=n.targetEndpoint.element,i.targetId=n.targetEndpoint.elementId):i.targetId=e.getId(i.target),i.scope=n.scope;var r=n.anchors?n.anchors[0]:n.anchor,o=n.anchors?n.anchors[1]:n.anchor;e.manage(i.source),e.manage(i.target),i.visible=!0,i.params={cssClass:n.cssClass,hoverClass:n.hoverClass,"pointer-events":n["pointer-events"],overlays:n.overlays},i.lastPaintedAt=null,n.type&&(n.endpoints=n.endpoints||i.instance._deriveEndpointAndAnchorSpec(n.type).endpoints),i.endpointSpec=n.endpoint,i.endpointsSpec=n.endpoints||[null,null],i.endpointStyle=n.endpointStyle,i.endpointHoverStyle=n.endpointHoverStyle,i.endpointStyles=n.endpointStyles||[null,null],i.endpointHoverStyles=n.endpointHoverStyles||[null,null],i.paintStyle=n.paintStyle,i.hoverPaintStyle=n.hoverPaintStyle,i.uuids=n.uuids,i.makeEndpoint(!0,i.source,i.sourceId,r,n.sourceEndpoint),i.makeEndpoint(!1,i.target,i.targetId,o,n.targetEndpoint),i.scope||(i.scope=i.endpoints[0].scope),null!=n.deleteEndpointsOnEmpty&&(i.endpoints[0].deleteOnEmpty=n.deleteEndpointsOnEmpty,i.endpoints[1].deleteOnEmpty=n.deleteEndpointsOnEmpty);var a=i.instance.defaults.connectionsDetachable;!1===n.detachable&&(a=!1),!1===i.endpoints[0].connectionsDetachable&&(a=!1),!1===i.endpoints[1].connectionsDetachable&&(a=!1),i.endpointsSpec=n.endpoints||[null,null],i.endpointSpec=n.endpoint||null;var l=n.reattach||i.endpoints[0].reattachConnections||i.endpoints[1].reattachConnections||i.instance.defaults.reattachConnections,u=extend({},i.endpoints[0].connectorStyle||i.endpoints[1].connectorStyle||n.paintStyle||i.instance.defaults.paintStyle);if(i.appendToDefaultType({detachable:a,reattach:l,paintStyle:u,hoverPaintStyle:extend({},i.endpoints[0].connectorHoverStyle||i.endpoints[1].connectorHoverStyle||n.hoverPaintStyle||i.instance.defaults.hoverPaintStyle)}),n.outlineWidth&&(u.outlineWidth=n.outlineWidth),n.outlineColor&&(u.outlineStroke=n.outlineColor),n.lineWidth&&(u.strokeWidth=n.lineWidth),n.color&&(u.stroke=n.color),!i.instance._suspendDrawing){var h=i.instance._suspendedAt||uuid();i.instance._paintEndpoint(i.endpoints[0],{timestamp:h}),i.instance._paintEndpoint(i.endpoints[1],{timestamp:h})}i.cost=n.cost||i.endpoints[0].connectionCost,i.directed=n.directed,null==n.directed&&(i.directed=i.endpoints[0].connectionsDirected);var d=extend({},i.endpoints[1].parameters);extend(d,i.endpoints[0].parameters),extend(d,i.parameters),i.parameters=d,i.paintStyleInUse=i.getPaintStyle()||{},i._setConnector(i.endpoints[0].connector||i.endpoints[1].connector||n.connector||i.instance.defaults.connector,!0);var p=null!=n.data&&isObject(n.data)?n.data:{};i.setData(p);var v=[zt,i.endpoints[0].edgeType,i.endpoints[1].edgeType,n.type].join(" ");return/[^\s]/.test(v)&&i.addType(v,n.data),i}return _createClass(Connection,[{key:"getIdPrefix",value:function getIdPrefix(){return"_jsPlumb_c"}},{key:"getDefaultOverlayKey",value:function getDefaultOverlayKey(){return fe}},{key:"getXY",value:function getXY(){return{x:this.connector.x,y:this.connector.y}}},{key:"makeEndpoint",value:function makeEndpoint(e,t,n,i,r){return n=n||this.instance.getId(t),prepareEndpoint(this,r,e?0:1,i,t)}},{key:"getTypeDescriptor",value:function getTypeDescriptor(){return Connection.type}},{key:"isDetachable",value:function isDetachable(e){return!1!==this.detachable&&(null!=e?!0===e.connectionsDetachable:!0===this.detachable)}},{key:"setDetachable",value:function setDetachable(e){this.detachable=!0===e}},{key:"isReattach",value:function isReattach(){return!0===this.reattach||!0===this.endpoints[0].reattachConnections||!0===this.endpoints[1].reattachConnections}},{key:"setReattach",value:function setReattach(e){this.reattach=!0===e}},{key:"applyType",value:function applyType(e,t){var n=null;null!=e.connector&&(null==(n=this.getCachedTypeItem(Ni,t.connector))&&(n=this.prepareConnector(e.connector,t.connector),this.cacheTypeItem(Ni,n,t.connector)),this.setPreparedConnector(n)),_get(_getPrototypeOf(Connection.prototype),"applyType",this).call(this,e,t),null!=e.detachable&&this.setDetachable(e.detachable),null!=e.reattach&&this.setReattach(e.reattach),e.scope&&(this.scope=e.scope);var i=null;e.anchor?null==(i=this.getCachedTypeItem(ji,t.anchor))&&(i=[makeLightweightAnchorFromSpec(e.anchor),makeLightweightAnchorFromSpec(e.anchor)],this.cacheTypeItem(ji,i,t.anchor)):e.anchors&&null==(i=this.getCachedTypeItem(ji,t.anchors))&&(i=[makeLightweightAnchorFromSpec(e.anchors[0]),makeLightweightAnchorFromSpec(e.anchors[1])],this.cacheTypeItem(ji,i,t.anchors)),null!=i&&(this.instance.router.setConnectionAnchors(this,i),this.instance.router.isDynamicAnchor(this.endpoints[1])&&this.instance.repaint(this.endpoints[1].element)),this.instance.applyConnectorType(this.connector,e)}},{key:"addClass",value:function addClass(e,t){_get(_getPrototypeOf(Connection.prototype),"addClass",this).call(this,e),t&&(this.endpoints[0].addClass(e),this.endpoints[1].addClass(e),this.suspendedEndpoint&&this.suspendedEndpoint.addClass(e)),this.connector&&this.instance.addConnectorClass(this.connector,e)}},{key:"removeClass",value:function removeClass(e,t){_get(_getPrototypeOf(Connection.prototype),"removeClass",this).call(this,e),t&&(this.endpoints[0].removeClass(e),this.endpoints[1].removeClass(e),this.suspendedEndpoint&&this.suspendedEndpoint.removeClass(e)),this.connector&&this.instance.removeConnectorClass(this.connector,e)}},{key:"setVisible",value:function setVisible(e){_get(_getPrototypeOf(Connection.prototype),"setVisible",this).call(this,e),this.connector&&this.instance.setConnectorVisible(this.connector,e),this.instance._paintConnection(this)}},{key:"destroy",value:function destroy(){_get(_getPrototypeOf(Connection.prototype),"destroy",this).call(this),this.endpoints=null,this.endpointStyles=null,this.source=null,this.target=null,this.instance.destroyConnector(this),this.connector=null,this.deleted=!0}},{key:"getUuids",value:function getUuids(){return[this.endpoints[0].getUuid(),this.endpoints[1].getUuid()]}},{key:"prepareConnector",value:function prepareConnector(e,t){var n,i={cssClass:this.params.cssClass,hoverClass:this.params.hoverClass,"pointer-events":this.params["pointer-events"]};if(isString(e))n=this.instance._makeConnector(this,e,i);else{var r=e;n=this.instance._makeConnector(this,r.type,merge(r.options||{},i))}return null!=t&&(n.typeId=t),n}},{key:"setPreparedConnector",value:function setPreparedConnector(e,t,n,i){if(this.connector!==e){var r,o="";if(null!=this.connector&&(r=this.connector,o=this.instance.getConnectorClass(this.connector),this.instance.destroyConnector(this)),this.connector=e,i&&this.cacheTypeItem(Ni,e,i),this.addClass(o),null!=r){var a=this.getOverlays();for(var l in a)this.instance.reattachOverlay(a[l],this)}t||this.instance._paintConnection(this)}}},{key:"_setConnector",value:function _setConnector(e,t,n,i){var r=this.prepareConnector(e,i);this.setPreparedConnector(r,t,n,i)}},{key:"replaceEndpoint",value:function replaceEndpoint(e,t){var n=this.endpoints[e],i=(n.elementId,this.instance.getEndpoints(n.element)),r=i.indexOf(n),o=prepareEndpoint(this,null,e,null,n.element,0,t);this.endpoints[e]=o,i.splice(r,1,o),n.detachFromConnection(this),this.instance.deleteEndpoint(n),this.instance.fire(V,{previous:n,current:o})}}]),Connection}(Mi);function ensureSVGOverlayPath(e){if(null==e.path){var t=extend({"jtk-overlay-id":e.id},e.attributes);e.path=_node(me,t);var n=e.instance.overlayClass+" "+(e.cssClass?e.cssClass:"");e.instance.addClass(e.path,n),e.path.jtk={overlay:e}}var i=e.path.parentNode;if(null==i){if(e.component instanceof zi){var r=e.component.connector;i=null!=r?r.canvas:null}else if(e.component instanceof Gi){var o=e.component.endpoint;i=null!=o?o.canvas:o}null!=i&&_appendAtIndex(i,e.path,1)}return e.path}_defineProperty(zi,"type","connection"),function(e){_inherits(SVGElementOverlay,e);var t=_createSuper(SVGElementOverlay);function SVGElementOverlay(){var e;_classCallCheck(this,SVGElementOverlay);for(var n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return _defineProperty(_assertThisInitialized(e=t.call.apply(t,[this].concat(i))),"path",void 0),e}}(bi);var Fi=function(){function SvgComponent(){_classCallCheck(this,SvgComponent)}return _createClass(SvgComponent,null,[{key:"paint",value:function paint(t,n,i,r){if(null!=i){var o=[t.x,t.y],a=[t.w,t.h];if(null!=r&&(r.xmin<0&&(o[0]+=r.xmin),r.ymin<0&&(o[1]+=r.ymin),a[0]=r.xmax+(r.xmin<0?-r.xmin:0),a[1]=r.ymax+(r.ymin<0?-r.ymin:0)),isFinite(a[0])&&isFinite(a[1])){var l={width:""+(a[0]||0),height:""+(a[1]||0)};n.containerType===e.ElementTypes.HTML?_attr(t.canvas,extend(l,{style:_pos([o[0],o[1]])})):_attr(t.canvas,extend(l,{x:o[0],y:o[1]}))}}}}]),SvgComponent}();function paintSvgConnector(e,t,n,i){!function getConnectorElement(e,t){if(null!=t.canvas)return t.canvas;var n=_node(_e,{style:"",width:"0",height:"0","pointer-events":l,position:u});return t.canvas=n,e._appendElement(t.canvas,e.getContainer()),null!=t.cssClass&&e.addClass(n,t.cssClass),e.addClass(n,e.connectorClass),n.jtk=n.jtk||{},n.jtk.connector=t,n}(e,t),Fi.paint(t,e,n,i);var r=[0,0];if(i.xmin<0&&(r[0]=-i.xmin),i.ymin<0&&(r[1]=-i.ymin),t.segments.length>0){var o={d:e.getPathData(t),transform:"translate("+r[0]+","+r[1]+")","pointer-events":"visibleStroke"},a=null;if(n.outlineStroke){var h=n.outlineWidth||1,d=n.strokeWidth+2*h;(a=extend({},n)).stroke=n.outlineStroke,a.strokeWidth=d,null==t.bgPath?(t.bgPath=_node(me,o),e.addClass(t.bgPath,e.connectorOutlineClass),_appendAtIndex(t.canvas,t.bgPath,0)):_attr(t.bgPath,o),_applyStyles(t.canvas,t.bgPath,a)}var p=t;null==p.path?(p.path=_node(me,o),_appendAtIndex(p.canvas,p.path,n.outlineStroke?1:0)):(p.path.parentNode!==p.canvas&&_appendAtIndex(p.canvas,p.path,n.outlineStroke?1:0),_attr(t.path,o)),_applyStyles(t.canvas,t.path,n)}}var Ri=function(){function SvgEndpoint(){_classCallCheck(this,SvgEndpoint)}return _createClass(SvgEndpoint,null,[{key:"getEndpointElement",value:function getEndpointElement(e){if(null!=e.canvas)return e.canvas;var t=_node(_e,{style:"",width:"0",height:"0","pointer-events":"all",position:u});e.canvas=t;var n=e.classes.join(" ");e.instance.addClass(t,n);for(var i=e.endpoint.scope.split(/\s/),r=0;r<i.length;r++)e.instance.setAttribute(t,E+i[r],Ft);return e.instance._appendElementToContainer(t),null!=e.cssClass&&e.instance.addClass(t,e.cssClass),e.instance.addClass(t,e.instance.endpointClass),t.jtk=t.jtk||{},t.jtk.endpoint=e.endpoint,t.style.display=!1!==e.endpoint.visible?a:l,t}},{key:"paint",value:function paint(e,t,n){if(!0!==e.endpoint.deleted){this.getEndpointElement(e),Fi.paint(e,e.instance,n);var i=extend({},n);i.outlineStroke&&(i.stroke=i.outlineStroke),null==e.node?(e.node=t.makeNode(e,i),e.canvas.appendChild(e.node)):null!=t.updateNode&&t.updateNode(e,e.node),_applyStyles(e.canvas,e.node,i)}}}]),SvgEndpoint}(),Bi=function(){function AbstractConnector(e,t){_classCallCheck(this,AbstractConnector),this.connection=e,_defineProperty(this,"type",void 0),_defineProperty(this,"edited",!1),_defineProperty(this,"stub",void 0),_defineProperty(this,"sourceStub",void 0),_defineProperty(this,"targetStub",void 0),_defineProperty(this,"maxStub",void 0),_defineProperty(this,"typeId",void 0),_defineProperty(this,"gap",void 0),_defineProperty(this,"sourceGap",void 0),_defineProperty(this,"targetGap",void 0),_defineProperty(this,"segments",[]),_defineProperty(this,"totalLength",0),_defineProperty(this,"segmentProportions",[]),_defineProperty(this,"segmentProportionalLengths",[]),_defineProperty(this,"paintInfo",null),_defineProperty(this,"strokeWidth",void 0),_defineProperty(this,"x",void 0),_defineProperty(this,"y",void 0),_defineProperty(this,"w",void 0),_defineProperty(this,"h",void 0),_defineProperty(this,"segment",void 0),_defineProperty(this,"bounds",{xmin:1/0,xmax:-1/0,ymin:1/0,ymax:-1/0}),_defineProperty(this,"cssClass",void 0),_defineProperty(this,"hoverClass",void 0),_defineProperty(this,"geometry",void 0),this.stub=t.stub||this.getDefaultStubs(),this.sourceStub=Array.isArray(this.stub)?this.stub[0]:this.stub,this.targetStub=Array.isArray(this.stub)?this.stub[1]:this.stub,this.gap=t.gap||0,this.sourceGap=Array.isArray(this.gap)?this.gap[0]:this.gap,this.targetGap=Array.isArray(this.gap)?this.gap[1]:this.gap,this.maxStub=Math.max(this.sourceStub,this.targetStub),this.cssClass=t.cssClass||"",this.hoverClass=t.hoverClass||""}return _createClass(AbstractConnector,[{key:"getTypeDescriptor",value:function getTypeDescriptor(){return"connector"}},{key:"getIdPrefix",value:function getIdPrefix(){return"_jsplumb_connector"}},{key:"setGeometry",value:function setGeometry(e,t){this.geometry=e,this.edited=null!=e&&!t}},{key:"exportGeometry",value:function exportGeometry(){return this.geometry}},{key:"importGeometry",value:function importGeometry(e){return this.geometry=e,!0}},{key:"resetGeometry",value:function resetGeometry(){this.geometry=null,this.edited=!1}},{key:"transformAnchorPlacement",value:function transformAnchorPlacement(e,t,n){return{x:e.x,y:e.y,ox:e.ox,oy:e.oy,curX:e.curX+t,curY:e.curY+n}}},{key:"resetBounds",value:function resetBounds(){this.bounds={xmin:1/0,xmax:-1/0,ymin:1/0,ymax:-1/0}}},{key:"findSegmentForPoint",value:function findSegmentForPoint(e,t){for(var n={d:1/0,s:null,x:null,y:null,l:null,x1:null,y1:null,x2:null,y2:null,index:null,connectorLocation:null},i=0;i<this.segments.length;i++){var r=this.segments[i].findClosestPointOnPath(e,t);r.d<n.d&&(n.d=r.d,n.l=r.l,n.x=r.x,n.y=r.y,n.s=this.segments[i],n.x1=r.x1,n.x2=r.x2,n.y1=r.y1,n.y2=r.y2,n.index=i,n.connectorLocation=this.segmentProportions[i][0]+r.l*(this.segmentProportions[i][1]-this.segmentProportions[i][0]))}return n}},{key:"lineIntersection",value:function lineIntersection(e,t,n,i){for(var r=[],o=0;o<this.segments.length;o++)r.push.apply(r,this.segments[o].lineIntersection(e,t,n,i));return r}},{key:"boxIntersection",value:function boxIntersection(e,t,n,i){for(var r=[],o=0;o<this.segments.length;o++)r.push.apply(r,this.segments[o].boxIntersection(e,t,n,i));return r}},{key:"boundingBoxIntersection",value:function boundingBoxIntersection(e){for(var t=[],n=0;n<this.segments.length;n++)t.push.apply(t,this.segments[n].boundingBoxIntersection(e));return t}},{key:"_updateSegmentProportions",value:function _updateSegmentProportions(){for(var e=0,t=0;t<this.segments.length;t++){var n=this.segments[t].getLength();this.segmentProportionalLengths[t]=n/this.totalLength,this.segmentProportions[t]=[e,e+=n/this.totalLength]}}},{key:"_findSegmentForLocation",value:function _findSegmentForLocation(e,t){var n,i,r;if(t&&(e=e>0?e/this.totalLength:(this.totalLength+e)/this.totalLength),1===e)n=this.segments.length-1,r=1;else if(0===e)r=0,n=0;else if(e>=.5){for(n=0,r=0,i=this.segmentProportions.length-1;i>-1;i--)if(this.segmentProportions[i][1]>=e&&this.segmentProportions[i][0]<=e){n=i,r=(e-this.segmentProportions[i][0])/this.segmentProportionalLengths[i];break}}else for(n=this.segmentProportions.length-1,r=1,i=0;i<this.segmentProportions.length;i++)if(this.segmentProportions[i][1]>=e){n=i,r=(e-this.segmentProportions[i][0])/this.segmentProportionalLengths[i];break}return{segment:this.segments[n],proportion:r,index:n}}},{key:"_addSegment",value:function _addSegment(e,t){if(t.x1!==t.x2||t.y1!==t.y2){var n=new e(t);this.segments.push(n),this.totalLength+=n.getLength(),this.updateBounds(n)}}},{key:"_clearSegments",value:function _clearSegments(){this.totalLength=0,this.segments.length=0,this.segmentProportions.length=0,this.segmentProportionalLengths.length=0}},{key:"getLength",value:function getLength(){return this.totalLength}},{key:"_prepareCompute",value:function _prepareCompute(e){this.strokeWidth=e.strokeWidth;var t=e.sourcePos.curX,n=e.targetPos.curX,i=e.sourcePos.curY,r=e.targetPos.curY,o=quadrant({x:t,y:i},{x:n,y:r}),a=n<t,l=r<i,u=[e.sourcePos.ox,e.sourcePos.oy],h=[e.targetPos.ox,e.targetPos.oy],d=a?n:t,p=l?r:i,v=Math.abs(n-t),g=Math.abs(r-i),_=0===u[0]&&0===u[1],m=0===h[0]&&0===h[1];if(_||m){var E=v>g?0:1,P=[1,0][E],C=0===E?t:i,T=0===E?n:r;_&&(u[E]=C>T?-1:1,u[P]=0),m&&(h[E]=C>T?1:-1,h[P]=0)}var b=a?v+this.sourceGap*u[0]:this.sourceGap*u[0],S=l?g+this.sourceGap*u[1]:this.sourceGap*u[1],k=a?this.targetGap*h[0]:v+this.targetGap*h[0],I=l?this.targetGap*h[1]:g+this.targetGap*h[1],A=u[0]*h[0]+u[1]*h[1],O={sx:b,sy:S,tx:k,ty:I,xSpan:Math.abs(k-b),ySpan:Math.abs(I-S),mx:(b+k)/2,my:(S+I)/2,so:u,to:h,x:d,y:p,w:v,h:g,segment:o,startStubX:b+u[0]*this.sourceStub,startStubY:S+u[1]*this.sourceStub,endStubX:k+h[0]*this.targetStub,endStubY:I+h[1]*this.targetStub,isXGreaterThanStubTimes2:Math.abs(b-k)>this.sourceStub+this.targetStub,isYGreaterThanStubTimes2:Math.abs(S-I)>this.sourceStub+this.targetStub,opposite:-1===A,perpendicular:0===A,orthogonal:1===A,sourceAxis:0===u[0]?"y":"x",points:[d,p,v,g,b,S,k,I],stubs:[this.sourceStub,this.targetStub]};return O.anchorOrientation=O.opposite?"opposite":O.orthogonal?"orthogonal":"perpendicular",O}},{key:"updateBounds",value:function updateBounds(e){var t=e.extents;this.bounds.xmin=Math.min(this.bounds.xmin,t.xmin),this.bounds.xmax=Math.max(this.bounds.xmax,t.xmax),this.bounds.ymin=Math.min(this.bounds.ymin,t.ymin),this.bounds.ymax=Math.max(this.bounds.ymax,t.ymax)}},{key:"dumpSegmentsToConsole",value:function dumpSegmentsToConsole(){log("SEGMENTS:");for(var e=0;e<this.segments.length;e++)log(this.segments[e].type,""+this.segments[e].getLength(),""+this.segmentProportions[e])}},{key:"pointOnPath",value:function pointOnPath(e,t){var n=this._findSegmentForLocation(e,t);return n.segment&&n.segment.pointOnPath(n.proportion,!1)||{x:0,y:0}}},{key:"gradientAtPoint",value:function gradientAtPoint(e,t){var n=this._findSegmentForLocation(e,t);return n.segment&&n.segment.gradientAtPoint(n.proportion,!1)||0}},{key:"pointAlongPathFrom",value:function pointAlongPathFrom(e,t,n){var i=this._findSegmentForLocation(e,n);return i.segment&&i.segment.pointAlongPathFrom(i.proportion,t,!1)||{x:0,y:0}}},{key:"compute",value:function compute(e){this.paintInfo=this._prepareCompute(e),this._clearSegments(),this._compute(this.paintInfo,e),this.x=this.paintInfo.points[0],this.y=this.paintInfo.points[1],this.w=this.paintInfo.points[2],this.h=this.paintInfo.points[3],this.segment=this.paintInfo.segment,this._updateSegmentProportions()}},{key:"setAnchorOrientation",value:function setAnchorOrientation(e,t){}}]),AbstractConnector}(),Hi=function(e){_inherits(ArrowOverlay,e);var t=_createSuper(ArrowOverlay);function ArrowOverlay(e,n,i){var r;return _classCallCheck(this,ArrowOverlay),(r=t.call(this,e,n,i)).instance=e,r.component=n,_defineProperty(_assertThisInitialized(r),"width",void 0),_defineProperty(_assertThisInitialized(r),"length",void 0),_defineProperty(_assertThisInitialized(r),"foldback",void 0),_defineProperty(_assertThisInitialized(r),"direction",void 0),_defineProperty(_assertThisInitialized(r),"location",.5),_defineProperty(_assertThisInitialized(r),"paintStyle",void 0),_defineProperty(_assertThisInitialized(r),"type",ArrowOverlay.type),_defineProperty(_assertThisInitialized(r),"cachedDimensions",void 0),i=i||{},r.width=i.width||20,r.length=i.length||20,r.direction=(i.direction||1)<0?-1:1,r.foldback=i.foldback||.623,r.paintStyle=i.paintStyle||{strokeWidth:1},r.location=null==i.location?r.location:Array.isArray(i.location)?i.location[0]:i.location,r}return _createClass(ArrowOverlay,[{key:"draw",value:function draw(e,t,n){if(e instanceof Bi){var i,r,o,a=e;if(this.location>1||this.location<0){var l=this.location<0?1:0;r=pointOnLine(i=a.pointAlongPathFrom(l,this.location,!1),a.pointAlongPathFrom(l,this.location-this.direction*this.length/2,!1),this.length)}else if(1===this.location){if(r=pointOnLine(i=a.pointOnPath(this.location),a.pointAlongPathFrom(this.location,-this.length),this.length),-1===this.direction){var u=r;r=i,i=u}}else if(0===this.location){if(i=pointOnLine(r=a.pointOnPath(this.location),a.pointAlongPathFrom(this.location,this.length),this.length),-1===this.direction){var h=r;r=i,i=h}}else r=pointOnLine(i=a.pointAlongPathFrom(this.location,this.direction*this.length/2),a.pointOnPath(this.location),this.length);var d={hxy:i,tail:o=perpendicularLineTo(i,r,this.width),cxy:pointOnLine(i,r,this.foldback*this.length)},p=this.paintStyle.stroke||t.stroke,v=this.paintStyle.fill||t.stroke;return{component:e,d:d,"stroke-width":this.paintStyle.strokeWidth||t.strokeWidth,stroke:p,fill:v,xmin:Math.min(i.x,o[0].x,o[1].x),xmax:Math.max(i.x,o[0].x,o[1].x),ymin:Math.min(i.y,o[0].y,o[1].y),ymax:Math.max(i.y,o[0].y,o[1].y)}}}},{key:"updateFrom",value:function updateFrom(e){}}]),ArrowOverlay}(bi);function isArrowOverlay(e){return e.type===Hi.type}_defineProperty(Hi,"type","Arrow"),ki.register(Hi.type,Hi);var Vi=function(e){_inherits(DiamondOverlay,e);var t=_createSuper(DiamondOverlay);function DiamondOverlay(e,n,i){var r;return _classCallCheck(this,DiamondOverlay),(r=t.call(this,e,n,i)).instance=e,_defineProperty(_assertThisInitialized(r),"type",DiamondOverlay.type),r.length=r.length/2,r.foldback=2,r}return DiamondOverlay}(Hi);function isDiamondOverlay(e){return e.type===Vi.type}_defineProperty(Vi,"type","Diamond"),ki.register(Vi.type,Vi);var Ui=function(e){_inherits(PlainArrowOverlay,e);var t=_createSuper(PlainArrowOverlay);function PlainArrowOverlay(e,n,i){var r;return _classCallCheck(this,PlainArrowOverlay),(r=t.call(this,e,n,i)).instance=e,_defineProperty(_assertThisInitialized(r),"type",PlainArrowOverlay.type),r.foldback=1,r}return PlainArrowOverlay}(Hi);function isPlainArrowOverlay(e){return e.type===Ui.type}_defineProperty(Ui,"type","PlainArrow"),ki.register("PlainArrow",Ui);var Yi=function(e){_inherits(CustomOverlay,e);var t=_createSuper(CustomOverlay);function CustomOverlay(e,n,i){var r;return _classCallCheck(this,CustomOverlay),(r=t.call(this,e,n,i)).instance=e,r.component=n,_defineProperty(_assertThisInitialized(r),"create",void 0),_defineProperty(_assertThisInitialized(r),"type",CustomOverlay.type),r.create=i.create,r}return _createClass(CustomOverlay,[{key:"updateFrom",value:function updateFrom(e){}}]),CustomOverlay}(bi);function isCustomOverlay(e){return e.type===Yi.type}_defineProperty(Yi,"type","Custom"),ki.register(Yi.type,Yi);var Xi="allowNestedGroups",Wi="paintStyle",qi="scope",Ji=function(e){_inherits(DotEndpoint,e);var t=_createSuper(DotEndpoint);function DotEndpoint(e,n){var i;return _classCallCheck(this,DotEndpoint),_defineProperty(_assertThisInitialized(i=t.call(this,e,n)),"radius",void 0),_defineProperty(_assertThisInitialized(i),"defaultOffset",void 0),_defineProperty(_assertThisInitialized(i),"defaultInnerRadius",void 0),_defineProperty(_assertThisInitialized(i),"type",DotEndpoint.type),n=n||{},i.radius=n.radius||5,i.defaultOffset=.5*i.radius,i.defaultInnerRadius=i.radius/3,i}return DotEndpoint}(qn);_defineProperty(Ji,"type","Dot");var Ki={type:Ji.type,cls:Ji,compute:function compute(e,t,n,i){var r=t.curX-e.radius,o=t.curY-e.radius,a=2*e.radius,l=2*e.radius;if(i&&i.stroke){var u=i.strokeWidth||1;r-=u,o-=u,a+=2*u,l+=2*u}return e.x=r,e.y=o,e.w=a,e.h=l,[r,o,a,l,e.radius]},getParams:function getParams(e){return{radius:e.radius}}},$i=function UINode(e,t){_classCallCheck(this,UINode),this.instance=e,this.el=t,_defineProperty(this,"group",void 0)},Zi=function(e){_inherits(UIGroup,e);var t=_createSuper(UIGroup);function UIGroup(e,n,i){var r;_classCallCheck(this,UIGroup),(r=t.call(this,e,n)).instance=e,_defineProperty(_assertThisInitialized(r),"children",[]),_defineProperty(_assertThisInitialized(r),"collapsed",!1),_defineProperty(_assertThisInitialized(r),"droppable",void 0),_defineProperty(_assertThisInitialized(r),"enabled",void 0),_defineProperty(_assertThisInitialized(r),"orphan",void 0),_defineProperty(_assertThisInitialized(r),"constrain",void 0),_defineProperty(_assertThisInitialized(r),"proxied",void 0),_defineProperty(_assertThisInitialized(r),"ghost",void 0),_defineProperty(_assertThisInitialized(r),"revert",void 0),_defineProperty(_assertThisInitialized(r),"prune",void 0),_defineProperty(_assertThisInitialized(r),"dropOverride",void 0),_defineProperty(_assertThisInitialized(r),"anchor",void 0),_defineProperty(_assertThisInitialized(r),"endpoint",void 0),_defineProperty(_assertThisInitialized(r),"connections",{source:[],target:[],internal:[]}),_defineProperty(_assertThisInitialized(r),"manager",void 0),_defineProperty(_assertThisInitialized(r),"id",void 0),_defineProperty(_assertThisInitialized(r),"elId",void 0);var o=r.el;return o._isJsPlumbGroup=!0,o._jsPlumbGroup=_assertThisInitialized(r),r.elId=e.getId(n),r.orphan=!0===i.orphan,r.revert=!0!==r.orphan&&!1!==i.revert,r.droppable=!1!==i.droppable,r.ghost=!0===i.ghost,r.enabled=!1!==i.enabled,r.prune=!0!==r.orphan&&!0===i.prune,r.constrain=r.ghost||!0===i.constrain,r.proxied=!1!==i.proxied,r.id=i.id||uuid(),r.dropOverride=!0===i.dropOverride,r.anchor=i.anchor,r.endpoint=i.endpoint,r.anchor=i.anchor,e.setAttribute(n,p,""),r}return _createClass(UIGroup,[{key:"contentArea",get:function get(){return this.instance.getGroupContentArea(this)}},{key:"overrideDrop",value:function overrideDrop(e,t){return this.dropOverride&&(this.revert||this.prune||this.orphan)}},{key:"getAnchor",value:function getAnchor(e,t){return this.anchor||"Continuous"}},{key:"getEndpoint",value:function getEndpoint(e,t){return this.endpoint||{type:Ji.type,options:{radius:10}}}},{key:"add",value:function add(e,t){var n=this.instance.getGroupContentArea(this),i=e;if(null!=i._jsPlumbParentGroup){if(i._jsPlumbParentGroup===this)return;i._jsPlumbParentGroup.remove(e,!0,t,!1)}i._jsPlumbParentGroup=this,this.children.push(new $i(this.instance,e)),this.instance._appendElement(i,n),this.manager._updateConnectionsForGroup(this)}},{key:"resolveNode",value:function resolveNode(e){return null==e?null:getWithFunction(this.children,(function(t){return t.el===e}))}},{key:"remove",value:function remove(e,t,n,i,r){var o=this.resolveNode(e);null!=o&&this._doRemove(o,t,n,i,r)}},{key:"_doRemove",value:function _doRemove(e,t,n,i,r){var o=e.el;if(delete o._jsPlumbParentGroup,removeWithFunction(this.children,(function(t){return t===e})),t)try{this.instance.getGroupContentArea(this).removeChild(o)}catch(e){log("Could not remove element from Group "+e)}if(!n){var a={group:this,el:o};r&&(a.targetGroup=r),this.instance.fire($,a)}i||this.manager._updateConnectionsForGroup(this)}},{key:"removeAll",value:function removeAll(e,t){for(var n=0,i=this.children.length;n<i;n++){var r=this.children[0];this._doRemove(r,e,t,!0),this.instance.unmanage(r.el,!0)}this.children.length=0,this.manager._updateConnectionsForGroup(this)}},{key:"orphanAll",value:function orphanAll(){for(var e={},t=0;t<this.children.length;t++){var n=this.manager.orphan(this.children[t].el,!1);e[n.id]=n.pos}return this.children.length=0,e}},{key:"addGroup",value:function addGroup(e){if(this.instance.allowNestedGroups&&e!==this){if(this.instance.groupManager.isAncestor(this,e))return!1;null!=e.group&&e.group.removeGroup(e);var t=this.instance.getId(e.el);this.instance.getManagedElements()[t].group=this.elId;var n=this.instance.getOffsetRelativeToRoot(e.el),i=this.collapsed?this.instance.getOffsetRelativeToRoot(this.el):this.instance.getOffsetRelativeToRoot(this.instance.getGroupContentArea(this));e.el._jsPlumbParentGroup=this,this.children.push(e),this.instance._appendElementToGroup(this,e.el),e.group=this;var r={x:n.x-i.x,y:n.y-i.y};return this.instance.setPosition(e.el,r),this.instance.fire(ee,{parent:this,child:e}),!0}return!1}},{key:"removeGroup",value:function removeGroup(e){if(e.group===this){var t=e.el,n=this.instance.getGroupContentArea(this);n===t.parentNode&&n.removeChild(e.el);var i=this.instance.getId(e.el),r=this.instance.getManagedElements()[i];r&&delete r.group,this.children=this.children.filter((function(t){return t.id!==e.id})),delete e.group,delete t._jsPlumbParentGroup,this.instance.fire(te,{parent:this,child:e})}}},{key:"getGroups",value:function getGroups(){return this.children.filter((function(e){return e.constructor===UIGroup}))}},{key:"getNodes",value:function getNodes(){return this.children.filter((function(e){return e.constructor===$i}))}},{key:"collapseParent",get:function get(){var e=null;if(null==this.group)return null;for(var t=this.group;null!=t;)t.collapsed&&(e=t),t=t.group;return e}}]),UIGroup}($i),Qi=function(){function GroupManager(e){var t=this;_classCallCheck(this,GroupManager),this.instance=e,_defineProperty(this,"groupMap",{}),_defineProperty(this,"_connectionSourceMap",{}),_defineProperty(this,"_connectionTargetMap",{}),e.bind(F,(function(e){var n=t.getGroupFor(e.source),i=t.getGroupFor(e.target);null!=n&&null!=i&&n===i?(t._connectionSourceMap[e.connection.id]=n,t._connectionTargetMap[e.connection.id]=n,suggest(n.connections.internal,e.connection)):(null!=n&&(e.target._jsPlumbGroup===n?suggest(n.connections.internal,e.connection):suggest(n.connections.source,e.connection),t._connectionSourceMap[e.connection.id]=n),null!=i&&(e.source._jsPlumbGroup===i?suggest(i.connections.internal,e.connection):suggest(i.connections.target,e.connection),t._connectionTargetMap[e.connection.id]=i))})),e.bind(Y,(function(e){t._cleanupDetachedConnection(e.connection)})),e.bind(B,(function(e){var n=e.originalEndpoint.element,i=t.getGroupFor(n),r=e.connection.endpoints[e.index].element,o=t.getGroupFor(r),a=0===e.index?t._connectionSourceMap:t._connectionTargetMap,l=0===e.index?t._connectionTargetMap:t._connectionSourceMap;null!=o?(a[e.connection.id]=o,e.connection.source===e.connection.target&&(l[e.connection.id]=o)):(delete a[e.connection.id],e.connection.source===e.connection.target&&delete l[e.connection.id]),null!=i&&t._updateConnectionsForGroup(i),null!=o&&t._updateConnectionsForGroup(o)}))}return _createClass(GroupManager,[{key:"_cleanupDetachedConnection",value:function _cleanupDetachedConnection(e){e.proxies.length=0;var t,n=this._connectionSourceMap[e.id];null!=n&&(t=function f(t){return t.id===e.id},removeWithFunction(n.connections.source,t),removeWithFunction(n.connections.target,t),removeWithFunction(n.connections.internal,t),delete this._connectionSourceMap[e.id]),null!=(n=this._connectionTargetMap[e.id])&&(t=function f(t){return t.id===e.id},removeWithFunction(n.connections.source,t),removeWithFunction(n.connections.target,t),removeWithFunction(n.connections.internal,t),delete this._connectionTargetMap[e.id])}},{key:"addGroup",value:function addGroup(e){var t=e.el;if(null!=this.groupMap[e.id])throw new Error("cannot create Group ["+e.id+"]; a Group with that ID exists");if(null!=t._isJsPlumbGroup)throw new Error("cannot create Group ["+e.id+"]; the given element is already a Group");var n=new Zi(this.instance,e.el,e);return this.groupMap[n.id]=n,e.collapsed&&this.collapseGroup(n),this.instance.manage(n.el),this.instance.addClass(n.el,G),n.manager=this,this._updateConnectionsForGroup(n),this.instance.fire(W,{group:n}),n}},{key:"getGroup",value:function getGroup(e){var t=e;if(isString(e)&&null==(t=this.groupMap[e]))throw new Error("No such group ["+e+"]");return t}},{key:"getGroupFor",value:function getGroupFor(e){for(var t=e,n=this.instance.getContainer(),i=!1,r=null;!i;)null==t||t===n?i=!0:t._jsPlumbParentGroup?(r=t._jsPlumbParentGroup,i=!0):t=t.parentNode;return r}},{key:"getGroups",value:function getGroups(){var e=[];for(var t in this.groupMap)e.push(this.groupMap[t]);return e}},{key:"removeGroup",value:function removeGroup(e,t,n,i){var r=this,o=this.getGroup(e);this.expandGroup(o,!0);var a={};return forEach(o.children,(function(e){var t=r.instance.getManagedElements()[r.instance.getId(e.el)];t&&delete t.group})),t?(forEach(o.getGroups(),(function(e){return r.removeGroup(e,t,n)})),o.removeAll(n,i)):(o.group&&forEach(o.children,(function(e){return o.group.add(e.el)})),a=o.orphanAll()),o.group&&o.group.removeGroup(o),this.instance.unmanage(o.el,!0),delete this.groupMap[o.id],this.instance.fire(Z,{group:o}),a}},{key:"removeAllGroups",value:function removeAllGroups(e,t,n){for(var i in this.groupMap)this.removeGroup(this.groupMap[i],e,t,n)}},{key:"forEach",value:function forEach(e){for(var t in this.groupMap)e(this.groupMap[t])}},{key:"orphan",value:function orphan(e,t){var n=e;if(n._jsPlumbParentGroup){var i=n._jsPlumbParentGroup,r=this.instance.getId(n),o=this.instance.getOffset(e);return!0!==t&&i.group?this.instance._appendElementToGroup(i.group,e):this.instance._appendElementToContainer(e),this.instance.setPosition(e,o),delete n._jsPlumbParentGroup,{id:r,pos:o}}}},{key:"_updateConnectionsForGroup",value:function _updateConnectionsForGroup(e){var t=this;e.connections.source.length=0,e.connections.target.length=0,e.connections.internal.length=0;var n=e.children.slice().map((function(e){return e.el})),i=[];if(forEach(n,(function(e){Array.prototype.push.apply(i,t.instance.getSelector(e,ce))})),Array.prototype.push.apply(n,i),n.length>0){var r,o,a=this.instance.getConnections({source:n,scope:Bt},!0),l=this.instance.getConnections({target:n,scope:Bt},!0),u={},h=function oneSet(n){for(var i=0;i<n.length;i++)u[n[i].id]||(u[n[i].id]=!0,r=t.getGroupFor(n[i].source),o=t.getGroupFor(n[i].target),n[i].source===e.el&&o===e||n[i].target===e.el&&r===e?e.connections.internal.push(n[i]):r===e?(o!==e?e.connections.source.push(n[i]):e.connections.internal.push(n[i]),t._connectionSourceMap[n[i].id]=e):o===e&&(e.connections.target.push(n[i]),t._connectionTargetMap[n[i].id]=e))};h(a),h(l)}}},{key:"_collapseConnection",value:function _collapseConnection(e,t,n){var i=e.endpoints[0===t?1:0].element;if(i._jsPlumbParentGroup&&!i._jsPlumbParentGroup.proxied&&i._jsPlumbParentGroup.collapsed)return!1;var r=e.endpoints[0].element._jsPlumbParentGroup,o=null!=r?r.collapseParent||r:null,a=e.endpoints[1].element._jsPlumbParentGroup,l=null!=a?a.collapseParent||a:null;if(null==o||null==l||o.id!==l.id){var u=n.el;return this.instance.getId(u),this.instance.proxyConnection(e,t,u,(function(e,t){return n.getEndpoint(e,t)}),(function(e,t){return n.getAnchor(e,t)})),!0}return!1}},{key:"_expandConnection",value:function _expandConnection(e,t,n){this.instance.unproxyConnection(e,t)}},{key:"isElementDescendant",value:function isElementDescendant(e,t){for(var n=this.instance.getContainer();;){if(null==e||e===n)return!1;if(e===t)return!0;e=e.parentNode}}},{key:"collapseGroup",value:function collapseGroup(e){var t=this,n=this.getGroup(e);if(null!=n&&!n.collapsed){var i=n.el;if(null==n.collapseParent){if(this.instance.setGroupVisible(n,!1),n.collapsed=!0,this.instance.removeClass(i,G),this.instance.addClass(i,L),n.proxied){var r=new Set,o=function _collapseSet(e,i){for(var o=0;o<e.length;o++){var a=e[o];!0===t._collapseConnection(a,i,n)&&r.add(a.id)}};o(n.connections.source,0),o(n.connections.target,1),forEach(n.getGroups(),(function(e){t.cascadeCollapse(n,e,r)}))}this.instance.revalidate(i),this.repaintGroup(n),this.instance.fire(q,{group:n})}else n.collapsed=!0,this.instance.removeClass(i,G),this.instance.addClass(i,L)}}},{key:"cascadeCollapse",value:function cascadeCollapse(e,t,n){var i=this;if(e.proxied){var r=function _collapseSet(t,r){for(var o=0;o<t.length;o++){var a=t[o];n.has(a.id)||!0===i._collapseConnection(a,r,e)&&n.add(a.id)}};r(t.connections.source,0),r(t.connections.target,1)}forEach(t.getGroups(),(function(t){i.cascadeCollapse(e,t,n)}))}},{key:"expandGroup",value:function expandGroup(e,t){var n=this,i=this.getGroup(e);if(null!=i){var r=i.el;if(null==i.collapseParent){if(this.instance.setGroupVisible(i,!0),i.collapsed=!1,this.instance.addClass(r,G),this.instance.removeClass(r,L),i.proxied){var o=function _expandSet(e,t){for(var r=0;r<e.length;r++){var o=e[r];n._expandConnection(o,t,i)}};o(i.connections.source,0),o(i.connections.target,1);forEach(i.getGroups(),(function _expandNestedGroup(e,t){if(t||e.collapsed){var i=function _collapseSet(t,i){for(var r=0;r<t.length;r++){var o=t[r];n._collapseConnection(o,i,e.collapseParent||e)}};i(e.connections.source,0),i(e.connections.target,1),forEach(e.connections.internal,(function(e){return e.setVisible(!1)})),forEach(e.getGroups(),(function(e){return _expandNestedGroup(e,!0)}))}else n.expandGroup(e,!0)}))}this.instance.revalidate(r),this.repaintGroup(i),t||this.instance.fire(J,{group:i})}else i.collapsed=!1,this.instance.addClass(r,G),this.instance.removeClass(r,L)}}},{key:"toggleGroup",value:function toggleGroup(e){null!=(e=this.getGroup(e))&&(e.collapsed?this.expandGroup(e):this.collapseGroup(e))}},{key:"repaintGroup",value:function repaintGroup(e){for(var t=this.getGroup(e).children,n=0;n<t.length;n++)this.instance.revalidate(t[n].el)}},{key:"addToGroup",value:function addToGroup(e,t){var n=this,i=this.getGroup(e);if(i){for(var r=i.el,o=function _one(e){var o=e,a=null!=o._isJsPlumbGroup,l=o._jsPlumbGroup,u=o._jsPlumbParentGroup;if(u!==i){var h=n.instance.manage(e),d=n.instance.getOffset(e),p=i.collapsed?n.instance.getOffsetRelativeToRoot(r):n.instance.getOffset(n.instance.getGroupContentArea(i));h.group=i.elId,null!=u&&(u.remove(e,!1,t,!1,i),n._updateConnectionsForGroup(u)),a?i.addGroup(l):i.add(e,t);var v=function handleDroppedConnections(e,t){var r=0===t?1:0;e.each((function(e){e.setVisible(!1),e.endpoints[r].element._jsPlumbGroup===i?(e.endpoints[r].setVisible(!1),n._expandConnection(e,r,i)):(e.endpoints[t].setVisible(!1),n._collapseConnection(e,t,i))}))};i.collapsed&&(v(n.instance.select({source:e}),0),v(n.instance.select({target:e}),1)),n.instance.getId(e);var g={x:d.x-p.x,y:d.y-p.y};if(n.instance.setPosition(e,g),n._updateConnectionsForGroup(i),n.instance.revalidate(e),!t){var _={group:i,el:e,pos:g};u&&(_.sourceGroup=u),n.instance.fire(K,_)}}},a=arguments.length,l=new Array(a>2?a-2:0),u=2;u<a;u++)l[u-2]=arguments[u];forEach(l,o)}}},{key:"removeFromGroup",value:function removeFromGroup(e,t){var n=this,i=this.getGroup(e);if(i){for(var r=function _one(e){if(i.collapsed){var r=function _expandSet(t,r){for(var o=0;o<t.length;o++){var a=t[o];if(a.proxies)for(var l=0;l<a.proxies.length;l++)if(null!=a.proxies[l]){var u=a.proxies[l].originalEp.element;(u===e||n.isElementDescendant(u,e))&&n._expandConnection(a,r,i)}}};r(i.connections.source.slice(),0),r(i.connections.target.slice(),1)}i.remove(e,null,t);var o=n.instance.getManagedElements()[n.instance.getId(e)];o&&delete o.group},o=arguments.length,a=new Array(o>2?o-2:0),l=2;l<o;l++)a[l-2]=arguments[l];forEach(a,r)}}},{key:"getAncestors",value:function getAncestors(e){for(var t=[],n=e.group;null!=n;)t.push(n),n=n.group;return t}},{key:"isAncestor",value:function isAncestor(e,t){return null!=e&&null!=t&&-1!==this.getAncestors(e).indexOf(t)}},{key:"getDescendants",value:function getDescendants(e){var t=[];return function _one(e){var n=e.getGroups();t.push.apply(t,_toConsumableArray(n)),forEach(n,_one)}(e),t}},{key:"isDescendant",value:function isDescendant(e,t){return null!=e&&null!=t&&-1!==this.getDescendants(t).indexOf(e)}},{key:"reset",value:function reset(){this._connectionSourceMap={},this._connectionTargetMap={},this.groupMap={}}}]),GroupManager}(),er=function(){function SelectionBase(e,t){_classCallCheck(this,SelectionBase),this.instance=e,this.entries=t}return _createClass(SelectionBase,[{key:"length",get:function get(){return this.entries.length}},{key:"each",value:function each(e){return forEach(this.entries,(function(t){return e(t)})),this}},{key:"get",value:function get(e){return this.entries[e]}},{key:"addClass",value:function addClass(e,t){return this.each((function(n){return n.addClass(e,t)})),this}},{key:"removeClass",value:function removeClass(e,t){return this.each((function(n){return n.removeClass(e,t)})),this}},{key:"removeAllOverlays",value:function removeAllOverlays(){return this.each((function(e){return e.removeAllOverlays()})),this}},{key:"setLabel",value:function setLabel(e){return this.each((function(t){return t.setLabel(e)})),this}},{key:"clear",value:function clear(){return this.entries.length=0,this}},{key:"map",value:function map(e){var t=[];return this.each((function(n){return t.push(e(n))})),t}},{key:"addOverlay",value:function addOverlay(e){return this.each((function(t){return t.addOverlay(e)})),this}},{key:"removeOverlay",value:function removeOverlay(e){return this.each((function(t){return t.removeOverlay(e)})),this}},{key:"removeOverlays",value:function removeOverlays(){return this.each((function(e){return e.removeOverlays()})),this}},{key:"showOverlay",value:function showOverlay(e){return this.each((function(t){return t.showOverlay(e)})),this}},{key:"hideOverlay",value:function hideOverlay(e){return this.each((function(t){return t.hideOverlay(e)})),this}},{key:"setPaintStyle",value:function setPaintStyle(e){return this.each((function(t){return t.setPaintStyle(e)})),this}},{key:"setHoverPaintStyle",value:function setHoverPaintStyle(e){return this.each((function(t){return t.setHoverPaintStyle(e)})),this}},{key:"setSuspendEvents",value:function setSuspendEvents(e){return this.each((function(t){return t.setSuspendEvents(e)})),this}},{key:"setParameter",value:function setParameter(e,t){return this.each((function(n){return n.parameters[e]=t})),this}},{key:"setParameters",value:function setParameters(e){return this.each((function(t){return t.parameters=e})),this}},{key:"setVisible",value:function setVisible(e){return this.each((function(t){return t.setVisible(e)})),this}},{key:"addType",value:function addType(e){return this.each((function(t){return t.addType(e)})),this}},{key:"toggleType",value:function toggleType(e){return this.each((function(t){return t.toggleType(e)})),this}},{key:"removeType",value:function removeType(e){return this.each((function(t){return t.removeType(e)})),this}},{key:"bind",value:function bind(e,t){return this.each((function(n){return n.bind(e,t)})),this}},{key:"unbind",value:function unbind(e,t){return this.each((function(n){return n.unbind(e,t)})),this}},{key:"setHover",value:function setHover(e){var t=this;return this.each((function(n){return t.instance.setHover(n,e)})),this}}]),SelectionBase}(),tr=function(e){_inherits(EndpointSelection,e);var t=_createSuper(EndpointSelection);function EndpointSelection(){return _classCallCheck(this,EndpointSelection),t.apply(this,arguments)}return _createClass(EndpointSelection,[{key:"setEnabled",value:function setEnabled(e){return this.each((function(t){return t.enabled=e})),this}},{key:"setAnchor",value:function setAnchor(e){return this.each((function(t){return t.setAnchor(e)})),this}},{key:"deleteEveryConnection",value:function deleteEveryConnection(){return this.each((function(e){return e.deleteEveryConnection()})),this}},{key:"deleteAll",value:function deleteAll(){var e=this;return this.each((function(t){return e.instance.deleteEndpoint(t)})),this.clear(),this}}]),EndpointSelection}(er),nr=function(e){_inherits(ConnectionSelection,e);var t=_createSuper(ConnectionSelection);function ConnectionSelection(){return _classCallCheck(this,ConnectionSelection),t.apply(this,arguments)}return _createClass(ConnectionSelection,[{key:"setDetachable",value:function setDetachable(e){return this.each((function(t){return t.setDetachable(e)})),this}},{key:"setReattach",value:function setReattach(e){return this.each((function(t){return t.setReattach(e)})),this}},{key:"setConnector",value:function setConnector(e){return this.each((function(t){return t._setConnector(e)})),this}},{key:"deleteAll",value:function deleteAll(){var e=this;this.each((function(t){return e.instance.deleteConnection(t)})),this.clear()}},{key:"repaint",value:function repaint(){var e=this;return this.each((function(t){return e.instance._paintConnection(t)})),this}}]),ConnectionSelection}(er),ir=function Transaction(){_classCallCheck(this,Transaction),_defineProperty(this,"affectedElements",new Set)};function EMPTY_POSITION(){return{x:0,y:0,w:0,h:0,r:0,c:{x:0,y:0},x2:0,y2:0,t:{x:0,y:0,c:{x:0,y:0},w:0,h:0,r:0,x2:0,y2:0,cr:0,sr:0},dirty:!0}}var rr=function entryComparator(e,t){var n=0;return t[1]>e[1]?n=-1:t[1]<e[1]&&(n=1),n},or=function reverseEntryComparator(e,t){return-1*rr(e,t)};function _updateElementIndex(e,t,n,i){insertSorted([e,t],n,rr,i)}function _clearElementIndex(e,t){var n=findWithFunction(t,(function(t){return t[0]===e}));n>-1&&t.splice(n,1)}var sr,ar=function(e){_inherits(Viewport,e);var t=_createSuper(Viewport);function Viewport(e){var n;return _classCallCheck(this,Viewport),(n=t.call(this)).instance=e,_defineProperty(_assertThisInitialized(n),"_currentTransaction",null),_defineProperty(_assertThisInitialized(n),"_sortedElements",{xmin:[],xmax:[],ymin:[],ymax:[]}),_defineProperty(_assertThisInitialized(n),"_elementMap",new Map),_defineProperty(_assertThisInitialized(n),"_transformedElementMap",new Map),_defineProperty(_assertThisInitialized(n),"_bounds",{minx:0,maxx:0,miny:0,maxy:0}),n}return _createClass(Viewport,[{key:"_updateBounds",value:function _updateBounds(e,t,n){null!=t&&(_clearElementIndex(e,this._sortedElements.xmin),_clearElementIndex(e,this._sortedElements.xmax),_clearElementIndex(e,this._sortedElements.ymin),_clearElementIndex(e,this._sortedElements.ymax),_updateElementIndex(e,t.t.x,this._sortedElements.xmin,!1),_updateElementIndex(e,t.t.x+t.t.w,this._sortedElements.xmax,!0),_updateElementIndex(e,t.t.y,this._sortedElements.ymin,!1),_updateElementIndex(e,t.t.y+t.t.h,this._sortedElements.ymax,!0),!0!==n&&this._recalculateBounds())}},{key:"_recalculateBounds",value:function _recalculateBounds(){this._bounds.minx=this._sortedElements.xmin.length>0?this._sortedElements.xmin[0][1]:0,this._bounds.maxx=this._sortedElements.xmax.length>0?this._sortedElements.xmax[0][1]:0,this._bounds.miny=this._sortedElements.ymin.length>0?this._sortedElements.ymin[0][1]:0,this._bounds.maxy=this._sortedElements.ymax.length>0?this._sortedElements.ymax[0][1]:0}},{key:"recomputeBounds",value:function recomputeBounds(){var e=this;this._sortedElements.xmin.length=0,this._sortedElements.xmax.length=0,this._sortedElements.ymin.length=0,this._sortedElements.ymax.length=0,this._elementMap.forEach((function(t,n){e._sortedElements.xmin.push([n,t.t.x]),e._sortedElements.xmax.push([n,t.t.x+t.t.w]),e._sortedElements.ymin.push([n,t.t.y]),e._sortedElements.ymax.push([n,t.t.y+t.t.h])})),this._sortedElements.xmin.sort(rr),this._sortedElements.ymin.sort(rr),this._sortedElements.xmax.sort(or),this._sortedElements.ymax.sort(or),this._recalculateBounds()}},{key:"_finaliseUpdate",value:function _finaliseUpdate(e,t,n){t.t=function rotate(e,t,n,i,r){var o=e+n/2,a=t+i/2,l=Math.cos(r/360*Math.PI*2),u=Math.sin(r/360*Math.PI*2),h=function _point(e,t){return{x:o+Math.round((e-o)*l-(t-a)*u),y:a+Math.round((t-a)*l-(e-o)*u)}},d=h(e,t),p=h(e+n,t),v=h(e+n,t+i),g=h(e,t+i),_=h(e+n/2,t+i/2),m=Math.min(d.x,p.x,v.x,g.x),E=Math.max(d.x,p.x,v.x,g.x),P=Math.min(d.y,p.y,v.y,g.y),C=Math.max(d.y,p.y,v.y,g.y);return{x:m,y:P,w:E-m,h:C-P,c:_,r:r,x2:E,y2:C,cr:l,sr:u}}(t.x,t.y,t.w,t.h,t.r),this._transformedElementMap.set(e,t.t),!0!==n&&this._updateBounds(e,t,n)}},{key:"shouldFireEvent",value:function shouldFireEvent(e,t,n){return!0}},{key:"startTransaction",value:function startTransaction(){if(null!=this._currentTransaction)throw new Error("Viewport: cannot start transaction; a transaction is currently active.");this._currentTransaction=new ir}},{key:"endTransaction",value:function endTransaction(){var e=this;null!=this._currentTransaction&&(this._currentTransaction.affectedElements.forEach((function(t){var n=e.getPosition(t);e._finaliseUpdate(t,n,!0)})),this.recomputeBounds(),this._currentTransaction=null)}},{key:"updateElements",value:function updateElements(e){var t=this;forEach(e,(function(e){return t.updateElement(e.id,e.x,e.y,e.width,e.height,e.rotation)}))}},{key:"updateElement",value:function updateElement(e,t,n,i,r,o,a){var l=getsert(this._elementMap,e,EMPTY_POSITION);return l.dirty=null==t&&null==l.x||null==n&&null==l.y||null==i&&null==l.w||null==r&&null==l.h,null!=t&&(l.x=t),null!=n&&(l.y=n),null!=i&&(l.w=i),null!=r&&(l.h=r),null!=o&&(l.r=o||0),l.c.x=l.x+l.w/2,l.c.y=l.y+l.h/2,l.x2=l.x+l.w,l.y2=l.y+l.h,null==this._currentTransaction?this._finaliseUpdate(e,l,a):this._currentTransaction.affectedElements.add(e),l}},{key:"refreshElement",value:function refreshElement(e,t){var n=this.instance.getManagedElements(),i=n[e]?n[e].el:null;if(null!=i){var r=this.getSize(i),o=this.getOffset(i);return this.updateElement(e,o.x,o.y,r.w,r.h,null,t)}return null}},{key:"getSize",value:function getSize(e){return this.instance.getSize(e)}},{key:"getOffset",value:function getOffset(e){return this.instance.getOffset(e)}},{key:"registerElement",value:function registerElement(e,t){return this.updateElement(e,0,0,0,0,0,t)}},{key:"addElement",value:function addElement(e,t,n,i,r,o){return this.updateElement(e,t,n,i,r,o)}},{key:"rotateElement",value:function rotateElement(e,t){var n=getsert(this._elementMap,e,EMPTY_POSITION);return n.r=t||0,this._finaliseUpdate(e,n),n}},{key:"getBoundsWidth",value:function getBoundsWidth(){return this._bounds.maxx-this._bounds.minx}},{key:"getBoundsHeight",value:function getBoundsHeight(){return this._bounds.maxy-this._bounds.miny}},{key:"getX",value:function getX(){return this._bounds.minx}},{key:"getY",value:function getY(){return this._bounds.miny}},{key:"setSize",value:function setSize(e,t,n){if(this._elementMap.has(e))return this.updateElement(e,null,null,t,n,null)}},{key:"setPosition",value:function setPosition(e,t,n){if(this._elementMap.has(e))return this.updateElement(e,t,n,null,null,null)}},{key:"reset",value:function reset(){this._sortedElements.xmin.length=0,this._sortedElements.xmax.length=0,this._sortedElements.ymin.length=0,this._sortedElements.ymax.length=0,this._elementMap.clear(),this._transformedElementMap.clear(),this._recalculateBounds()}},{key:"remove",value:function remove(e){_clearElementIndex(e,this._sortedElements.xmin),_clearElementIndex(e,this._sortedElements.xmax),_clearElementIndex(e,this._sortedElements.ymin),_clearElementIndex(e,this._sortedElements.ymax),this._elementMap.delete(e),this._transformedElementMap.delete(e),this._recalculateBounds()}},{key:"getPosition",value:function getPosition(e){return this._elementMap.get(e)}},{key:"getElements",value:function getElements(){return this._elementMap}},{key:"isEmpty",value:function isEmpty(){return 0===this._elementMap.size}}]),Viewport}(xi);function _rightAndBottomSort(e,t){return t.theta-e.theta}function _leftAndTopSort(e,t){return(e.theta<0?-Math.PI-e.theta:Math.PI-e.theta)-(t.theta<0?-Math.PI-t.theta:Math.PI-t.theta)}var lr=(_defineProperty(sr={},Jn,_leftAndTopSort),_defineProperty(sr,$n,_rightAndBottomSort),_defineProperty(sr,Zn,_rightAndBottomSort),_defineProperty(sr,Kn,_leftAndTopSort),sr);function isContinuous(e){return!0===e.isContinuous}function _isFloating(e){return!0===e.isContinuous}function isDynamic(e){return e.locations.length>1}function getCurrentLocation(e){return[e.currentLocation,e.locations[e.currentLocation]]}var cr=function(){function LightweightRouter(e){var t=this;_classCallCheck(this,LightweightRouter),this.instance=e,_defineProperty(this,"anchorLists",new Map),_defineProperty(this,"anchorLocations",new Map),e.bind(Y,(function(e){e.sourceEndpoint._anchor.isContinuous&&t._removeEndpointFromAnchorLists(e.sourceEndpoint),e.targetEndpoint._anchor.isContinuous&&t._removeEndpointFromAnchorLists(e.targetEndpoint)})),e.bind(U,(function(e){t._removeEndpointFromAnchorLists(e)}))}return _createClass(LightweightRouter,[{key:"getAnchorOrientation",value:function getAnchorOrientation(e){var t=this.anchorLocations.get(e.id);return t?[t.ox,t.oy]:[0,0]}},{key:"_distance",value:function _distance(e,t,n,i,r,o,a){var l=i.x+e.x*r.w,u=i.y+e.y*r.h,h=i.x+r.w/2,d=i.y+r.h/2;if(null!=o&&o.length>0){var p=this.instance._applyRotations([l,u,0,0],o);l=p.x,u=p.y}return Math.sqrt(Math.pow(t-l,2)+Math.pow(n-u,2))+Math.sqrt(Math.pow(h-l,2)+Math.pow(d-u,2))}},{key:"_anchorSelector",value:function _anchorSelector(e,t,n,i,r,o,a){for(var l=n.x+i.w/2,u=n.y+i.h/2,h=-1,d=1/0,p=0;p<a.length;p++){var v=this._distance(a[p],l,u,e,t,r,o);v<d&&(h=p+0,d=v)}return[h,a[h]]}},{key:"_floatingAnchorCompute",value:function _floatingAnchorCompute(e,t){var n=t.xy,i={curX:n.x+e.size.w/2,curY:n.y+e.size.h/2,x:0,y:0,ox:0,oy:0};return this._setComputedPosition(e,i)}},{key:"_setComputedPosition",value:function _setComputedPosition(e,t,n){return this.anchorLocations.set(e.id,t),e.computedPosition=t,n&&(e.timestamp=n),t}},{key:"_computeSingleLocation",value:function _computeSingleLocation(e,t,n,i){var r,o=i.rotation,a={curX:t.x+e.x*n.w+e.offx,curY:t.y+e.y*n.h+e.offy,x:e.x,y:e.y,ox:0,oy:0};if(null!=o&&o.length>0){var l=[e.iox,e.ioy],u={x:a.curX,y:a.curY,cr:0,sr:0};forEach(o,(function(e){u=rotatePoint(u,e.c,e.r);var t=[Math.round(l[0]*u.cr-l[1]*u.sr),Math.round(l[1]*u.cr+l[0]*u.sr)];l=t.slice()})),e.ox=l[0],e.oy=l[1],r={curX:u.x,curY:u.y,x:e.x,y:e.y,ox:l[0],oy:l[1]}}else e.ox=e.iox,e.oy=e.ioy,r=extend({ox:e.iox,oy:e.ioy},a);return r}},{key:"_singleAnchorCompute",value:function _singleAnchorCompute(e,t){var n=t.xy,i=t.wh,r=t.timestamp,o=this.anchorLocations.get(e.id);if(null!=o&&r&&r===e.timestamp)return o;var a=_slicedToArray(getCurrentLocation(e),2);a[0];var l=a[1];return o=this._computeSingleLocation(l,n,i,t),this._setComputedPosition(e,o,r)}},{key:"_defaultAnchorCompute",value:function _defaultAnchorCompute(e,t){var n;if(1===e.locations.length)return this._singleAnchorCompute(e,t);var i=t.xy,r=t.wh,o=t.txy,a=t.twh,l=_slicedToArray(getCurrentLocation(e),2),u=l[0],h=l[1];if(e.locked||null==o||null==a)n=this._computeSingleLocation(h,i,r,t);else{var d=_slicedToArray(this._anchorSelector(i,r,o,a,t.rotation,t.tRotation,e.locations),2),p=d[0],v=d[1];e.currentLocation=p,p!==u&&(e.cssClass=v.cls||e.cssClass,t.element._anchorLocationChanged(e)),n=this._computeSingleLocation(v,i,r,t)}return this._setComputedPosition(e,n,t.timestamp)}},{key:"_placeAnchors",value:function _placeAnchors(e,t){var n=this,i=this.instance.viewport.getPosition(e),r=function placeSomeAnchors(t,r,o,a,l,u){if(o.length>0)for(var h=o.sort(lr[t]),d=function _placeAnchorsOnLine(e,t,n,i,r){for(var o=n?e.w:e.h,a=n?e.h:e.w,l=[],u=o/(t.length+1),h=0;h<t.length;h++){var d=(h+1)*u,p=i*a;r&&(d=o-d);var v=n?d:p,g=e.x+v,_=v/e.w,m=n?p:d,E=e.y+m,P=m/e.h;if(0!==e.r&&null!=e.r){var C=rotatePoint({x:g,y:E},e.c,e.r);g=C.x,E=C.y}l.push({x:g,y:E,xLoc:_,yLoc:P,c:t[h].c})}return l}(i,h,a,l,t===$n||t===Jn),p=0;p<d.length;p++){var v=d[p].c,g=v.endpoints[0].elementId===e?v.endpoints[0]:v.endpoints[1];n._setComputedPosition(g._anchor,{curX:d[p].x,curY:d[p].y,x:d[p].xLoc,y:d[p].yLoc,ox:u[0],oy:u[1]})}};r(Zn,0,t.bottom,!0,1,[0,1]),r(Jn,0,t.top,!0,0,[0,-1]),r(Kn,0,t.left,!1,0,[-1,0]),r($n,0,t.right,!1,1,[1,0])}},{key:"_updateAnchorList",value:function _updateAnchorList(e,t,n,i,r,o,a,l,u,h,d){var p,v=i.endpoints[a],g=v.id,_=[1,0][a],m={theta:t,order:n,c:i,b:r,elId:o,epId:g},E=e[u],P=v._continuousAnchorEdge?e[v._continuousAnchorEdge]:null;if(P){var C=findWithFunction(P,(function(e){return e.epId===g}));if(-1!==C){P.splice(C,1);for(var T=0;T<P.length;T++)!0!==(p=P[T].c).placeholder&&h.add(p),d.add(P[T].c.endpoints[a]),d.add(P[T].c.endpoints[_])}}for(var b=0;b<E.length;b++)!0!==(p=E[b].c).placeholder&&h.add(p),d.add(E[b].c.endpoints[a]),d.add(E[b].c.endpoints[_]);var S=l?0:E.length;E.splice(S,0,m),v._continuousAnchorEdge=u}},{key:"_removeEndpointFromAnchorLists",value:function _removeEndpointFromAnchorLists(e){var t=this.anchorLists.get(e.elementId),n=0;!function(e,t){if(e){var i=function f(e){return e.epId===t};removeWithFunction(e.top,i),removeWithFunction(e.left,i),removeWithFunction(e.bottom,i),removeWithFunction(e.right,i),n+=e.top.length,n+=e.left.length,n+=e.bottom.length,n+=e.right.length}}(t,e.id),0===n&&this.anchorLists.delete(e.elementId),this.anchorLocations.delete(e._anchor.id)}},{key:"computeAnchorLocation",value:function computeAnchorLocation(e,t){var n;return n=isContinuous(e)?this.anchorLocations.get(e.id)||{curX:0,curY:0,x:0,y:0,ox:0,oy:0}:_isFloating(e)?this._floatingAnchorCompute(e,t):this._defaultAnchorCompute(e,t),e.timestamp=t.timestamp,n}},{key:"computePath",value:function computePath(e,t){var n=this.instance.viewport.getPosition(e.sourceId),i=this.instance.viewport.getPosition(e.targetId),r=e.endpoints[0],o=e.endpoints[1],a=this.getEndpointLocation(r,{xy:n,wh:n,element:r,timestamp:t,rotation:this.instance._getRotations(e.sourceId)}),l=this.getEndpointLocation(o,{xy:i,wh:i,element:o,timestamp:t,rotation:this.instance._getRotations(e.targetId)});e.connector.resetBounds(),e.connector.compute({sourcePos:a,targetPos:l,sourceEndpoint:e.endpoints[0],targetEndpoint:e.endpoints[1],strokeWidth:e.paintStyleInUse.strokeWidth,sourceInfo:n,targetInfo:i})}},{key:"getEndpointLocation",value:function getEndpointLocation(e,t){t=t||{};var n=e._anchor,i=this.anchorLocations.get(n.id);return(null==i||null!=t.timestamp&&n.timestamp!==t.timestamp)&&(i=this.computeAnchorLocation(n,t),this._setComputedPosition(n,i,t.timestamp)),i}},{key:"getEndpointOrientation",value:function getEndpointOrientation(e){return e._anchor?this.getAnchorOrientation(e._anchor):[0,0]}},{key:"setAnchorOrientation",value:function setAnchorOrientation(e,t){var n=this.anchorLocations.get(e.id);null!=n&&(n.ox=t[0],n.oy=t[1])}},{key:"isDynamicAnchor",value:function isDynamicAnchor(e){return!!e._anchor&&(!isContinuous(e._anchor)&&e._anchor.locations.length>1)}},{key:"isFloating",value:function isFloating(e){return!!e._anchor&&_isFloating(e._anchor)}},{key:"prepareAnchor",value:function prepareAnchor(e){return makeLightweightAnchorFromSpec(e)}},{key:"redraw",value:function redraw(e,t,n){var i=this,r=new Set,o=new Set,a=new Set;if(!this.instance._suspendDrawing){var l=this.instance.endpointsByElement[e]||[];t=t||uuid();for(var u,h,d={},p=0;p<l.length;p++)if(!1!==(h=l[p]).visible)if(o.add(h),u=h._anchor,0===h.connections.length)isContinuous(u)&&(this.anchorLists.has(e)||this.anchorLists.set(e,{top:[],right:[],bottom:[],left:[]}),this._updateAnchorList(this.anchorLists.get(e),-Math.PI/2,0,{endpoints:[h,h],placeholder:!0},!1,e,0,!1,getDefaultFace(u),r,o),a.add(e));else for(var v=0;v<h.connections.length;v++){var g=h.connections[v],_=g.sourceId,m=g.targetId,E=isContinuous(g.endpoints[0]._anchor),P=isContinuous(g.endpoints[1]._anchor);if(E||P){var C=[_,(g.endpoints[0]._anchor.faces||[]).join("-"),m,(g.endpoints[1]._anchor.faces||[]).join("-")].join("-"),T=d[C],b=g.sourceId===e?1:0;E&&!this.anchorLists.has(_)&&this.anchorLists.set(_,{top:[],right:[],bottom:[],left:[]}),P&&!this.anchorLists.has(m)&&this.anchorLists.set(m,{top:[],right:[],bottom:[],left:[]});var S=this.instance.viewport.getPosition(m),k=this.instance.viewport.getPosition(_);if(m===_&&(E||P))this._updateAnchorList(this.anchorLists.get(_),-Math.PI/2,0,g,!1,m,0,!1,Jn,r,o),this._updateAnchorList(this.anchorLists.get(m),-Math.PI/2,0,g,!1,_,1,!1,Jn,r,o);else{var I=this.instance._getRotations(_),A=this.instance._getRotations(m);T||(T=this._calculateOrientation(_,m,k,S,g.endpoints[0]._anchor,g.endpoints[1]._anchor,I,A),d[C]=T),E&&this._updateAnchorList(this.anchorLists.get(_),T.theta,0,g,!1,m,0,!1,T.a[0],r,o),P&&this._updateAnchorList(this.anchorLists.get(m),T.theta2,-1,g,!0,_,1,!0,T.a[1],r,o)}E&&a.add(_),P&&a.add(m),r.add(g),(E&&0===b||P&&1===b)&&o.add(g.endpoints[b])}else{var O=h.connections[v].endpoints[g.sourceId===e?1:0];if(isDynamic(O._anchor)){this.instance._paintEndpoint(O,{elementWithPrecedence:e,timestamp:t}),r.add(h.connections[v]);for(var D=0;D<O.connections.length;D++)O.connections[D]!==h.connections[v]&&r.add(O.connections[D])}else r.add(h.connections[v])}}a.forEach((function(e){i._placeAnchors(e,i.anchorLists.get(e))})),o.forEach((function(e){var n=i.instance.viewport.getPosition(e.elementId);i.instance._paintEndpoint(e,{timestamp:t,offset:n})})),r.forEach((function(e){i.instance._paintConnection(e,{timestamp:t})}))}return{c:r,e:o}}},{key:"reset",value:function reset(){this.anchorLocations.clear(),this.anchorLists.clear()}},{key:"setAnchor",value:function setAnchor(e,t){null!=t&&(e._anchor=t)}},{key:"setConnectionAnchors",value:function setConnectionAnchors(e,t){e.endpoints[0]._anchor=t[0],e.endpoints[1]._anchor=t[1]}},{key:"_calculateOrientation",value:function _calculateOrientation(e,t,n,i,a,l,u,h){var d=this;if(e===t)return{orientation:"identity",a:[Jn,Jn]};var p=Math.atan2(i.c.y-n.c.y,i.c.x-n.c.x),v=Math.atan2(n.c.y-i.c.y,n.c.x-i.c.x),g=[],_={};!function(e,t){for(var n=0;n<e.length;n++){var i;if(_[e[n]]=(_defineProperty(i={},Kn,{x:t[n][0].x,y:t[n][0].c.y}),_defineProperty(i,$n,{x:t[n][0].x+t[n][0].w,y:t[n][0].c.y}),_defineProperty(i,Jn,{x:t[n][0].c.x,y:t[n][0].y}),_defineProperty(i,Zn,{x:t[n][0].c.x,y:t[n][0].y+t[n][0].h}),i),null!=t[n][1]&&t[n][1].length>0)for(var r in _[e[n]])_[e[n]][r]=d.instance._applyRotationsXY(_[e[n]][r],t[n][1])}}([r,o],[[n,u],[i,h]]);for(var m=[Jn,Kn,$n,Zn],E=0;E<m.length;E++)for(var P=0;P<m.length;P++)g.push({source:m[E],target:m[P],dist:lineLength(_.source[m[E]],_.target[m[P]])});g.sort((function(e,t){if(e.dist<t.dist)return-1;if(t.dist<e.dist)return 1;var n,i=(_defineProperty(n={},Kn,0),_defineProperty(n,Jn,1),_defineProperty(n,$n,2),_defineProperty(n,Zn,3),n),r=i[e.source],o=i[t.source],a=i[e.target],l=i[t.target];return r<o?-1:o<r?1:a<l?-1:l<a?1:0}));for(var C=g[0].source,T=g[0].target,b=0;b<g.length&&(C=isContinuous(a)&&a.locked?a.currentFace:!a.isContinuous||isEdgeSupported(a,g[b].source)?g[b].source:null,T=l.isContinuous&&l.locked?l.currentFace:!l.isContinuous||isEdgeSupported(l,g[b].target)?g[b].target:null,null==C||null==T);b++);return a.isContinuous&&this.setCurrentFace(a,C),l.isContinuous&&this.setCurrentFace(l,T),{a:[C,T],theta:p,theta2:v}}},{key:"setCurrentFace",value:function setCurrentFace(e,t,n){e.currentFace=t,n&&null!=e.lockedFace&&(e.lockedFace=e.currentFace)}},{key:"lock",value:function lock(e){e.locked=!0,isContinuous(e)&&(e.lockedFace=e.currentFace)}},{key:"unlock",value:function unlock(e){e.locked=!1,isContinuous(e)&&(e.lockedFace=null)}},{key:"selectAnchorLocation",value:function selectAnchorLocation(e,t){var n=findWithFunction(e.locations,(function(e){return e.x===t.x&&e.y===t.y}));return-1!==n&&(e.currentLocation=n,!0)}},{key:"lockCurrentAxis",value:function lockCurrentAxis(e){null!=e.currentFace&&(e.lockedAxis=e.currentFace===Kn||e.currentFace===$n?Qn:ei)}},{key:"unlockCurrentAxis",value:function unlockCurrentAxis(e){e.lockedAxis=null}},{key:"anchorsEqual",value:function anchorsEqual(e,t){if(!e||!t)return!1;var n=e.locations[e.currentLocation],i=t.locations[t.currentLocation];return n.x===i.x&&n.y===i.y&&n.offx===i.offx&&n.offy===i.offy&&n.ox===i.ox&&n.oy===i.oy}}]),LightweightRouter}(),ur={},hr={get:function get(e,t,n){var i=ur[t];if(i)return new i(e,n);throw{message:"jsPlumb: unknown connector type '"+t+"'"}},register:function register(e,t){ur[e]=t}},dr=function(e){_inherits(StraightSegment,e);var t=_createSuper(StraightSegment);function StraightSegment(e){var n;return _classCallCheck(this,StraightSegment),_defineProperty(_assertThisInitialized(n=t.call(this,e)),"length",void 0),_defineProperty(_assertThisInitialized(n),"m",void 0),_defineProperty(_assertThisInitialized(n),"m2",void 0),_defineProperty(_assertThisInitialized(n),"type",StraightSegment.segmentType),n._setCoordinates({x1:e.x1,y1:e.y1,x2:e.x2,y2:e.y2}),n}return _createClass(StraightSegment,[{key:"getPath",value:function getPath(e){return(e?"M "+this.x1+" "+this.y1+" ":"")+"L "+this.x2+" "+this.y2}},{key:"_recalc",value:function _recalc(){this.length=Math.sqrt(Math.pow(this.x2-this.x1,2)+Math.pow(this.y2-this.y1,2)),this.m=gradient({x:this.x1,y:this.y1},{x:this.x2,y:this.y2}),this.m2=-1/this.m,this.extents={xmin:Math.min(this.x1,this.x2),ymin:Math.min(this.y1,this.y2),xmax:Math.max(this.x1,this.x2),ymax:Math.max(this.y1,this.y2)}}},{key:"getLength",value:function getLength(){return this.length}},{key:"getGradient",value:function getGradient(){return this.m}},{key:"_setCoordinates",value:function _setCoordinates(e){this.x1=e.x1,this.y1=e.y1,this.x2=e.x2,this.y2=e.y2,this._recalc()}},{key:"pointOnPath",value:function pointOnPath(e,t){if(0!==e||t){if(1!==e||t){var n=t?e>0?e:this.length+e:e*this.length;return pointOnLine({x:this.x1,y:this.y1},{x:this.x2,y:this.y2},n)}return{x:this.x2,y:this.y2}}return{x:this.x1,y:this.y1}}},{key:"gradientAtPoint",value:function gradientAtPoint(e,t){return this.m}},{key:"pointAlongPathFrom",value:function pointAlongPathFrom(e,t,n){var i=this.pointOnPath(e,n),r=t<=0?{x:this.x1,y:this.y1}:{x:this.x2,y:this.y2};return t<=0&&Math.abs(t)>1&&(t*=-1),pointOnLine(i,r,t)}},{key:"within",value:function within(e,t,n){return n>=Math.min(e,t)&&n<=Math.max(e,t)}},{key:"closest",value:function closest(e,t,n){return Math.abs(n-e)<Math.abs(n-t)?e:t}},{key:"findClosestPointOnPath",value:function findClosestPointOnPath(e,t){var n={d:1/0,x:null,y:null,l:null,x1:this.x1,x2:this.x2,y1:this.y1,y2:this.y2};if(0===this.m)n.y=this.y1,n.x=this.within(this.x1,this.x2,e)?e:this.closest(this.x1,this.x2,e);else if(this.m===1/0||this.m===-1/0)n.x=this.x1,n.y=this.within(this.y1,this.y2,t)?t:this.closest(this.y1,this.y2,t);else{var i=this.y1-this.m*this.x1,r=(t-this.m2*e-i)/(this.m-this.m2),o=this.m*r+i;n.x=this.within(this.x1,this.x2,r)?r:this.closest(this.x1,this.x2,r),n.y=this.within(this.y1,this.y2,o)?o:this.closest(this.y1,this.y2,o)}var a=lineLength({x:n.x,y:n.y},{x:this.x1,y:this.y1});return n.d=lineLength({x:e,y:t},n),n.l=a/length,n}},{key:"_pointLiesBetween",value:function _pointLiesBetween(e,t,n){return n>t?t<=e&&e<=n:t>=e&&e>=n}},{key:"lineIntersection",value:function lineIntersection(e,t,n,i){var r=Math.abs(gradient({x:e,y:t},{x:n,y:i})),o=Math.abs(this.m),a=o===1/0?this.x1:this.y1-o*this.x1,l=[],u=r===1/0?e:t-r*e;if(r!==o)if(r===1/0&&0===o)this._pointLiesBetween(e,this.x1,this.x2)&&this._pointLiesBetween(this.y1,t,i)&&l.push({x:e,y:this.y1});else if(0===r&&o===1/0)this._pointLiesBetween(t,this.y1,this.y2)&&this._pointLiesBetween(this.x1,e,n)&&l.push({x:this.x1,y:t});else{var h,d;r===1/0?(h=e,this._pointLiesBetween(h,this.x1,this.x2)&&(d=o*e+a,this._pointLiesBetween(d,t,i)&&l.push({x:h,y:d}))):0===r?(d=t,this._pointLiesBetween(d,this.y1,this.y2)&&(h=(t-a)/o,this._pointLiesBetween(h,e,n)&&l.push({x:h,y:d}))):(d=o*(h=(u-a)/(o-r))+a,this._pointLiesBetween(h,this.x1,this.x2)&&this._pointLiesBetween(d,this.y1,this.y2)&&l.push({x:h,y:d}))}return l}},{key:"boxIntersection",value:function boxIntersection(e,t,n,i){var r=[];return r.push.apply(r,this.lineIntersection(e,t,e+n,t)),r.push.apply(r,this.lineIntersection(e+n,t,e+n,t+i)),r.push.apply(r,this.lineIntersection(e+n,t+i,e,t+i)),r.push.apply(r,this.lineIntersection(e,t+i,e,t)),r}}]),StraightSegment}(jt);_defineProperty(dr,"segmentType","Straight");var pr=function(e){_inherits(StraightConnector,e);var t=_createSuper(StraightConnector);function StraightConnector(){var e;_classCallCheck(this,StraightConnector);for(var n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return _defineProperty(_assertThisInitialized(e=t.call.apply(t,[this].concat(i))),"type",StraightConnector.type),e}return _createClass(StraightConnector,[{key:"getDefaultStubs",value:function getDefaultStubs(){return[0,0]}},{key:"_compute",value:function _compute(e,t){this._addSegment(dr,{x1:e.sx,y1:e.sy,x2:e.startStubX,y2:e.startStubY}),this._addSegment(dr,{x1:e.startStubX,y1:e.startStubY,x2:e.endStubX,y2:e.endStubY}),this._addSegment(dr,{x1:e.endStubX,y1:e.endStubY,x2:e.tx,y2:e.ty}),this.geometry={source:t.sourcePos,target:t.targetPos}}},{key:"transformGeometry",value:function transformGeometry(e,t,n){return{source:this.transformAnchorPlacement(e.source,t,n),target:this.transformAnchorPlacement(e.target,t,n)}}}]),StraightConnector}(Bi);function prepareList(e,t,n){var i=[],r=function _resolveId(t){return isString(t)?t:e.getId(t)};if(t)if("string"==typeof t){if("*"===t)return t;i.push(t)}else{var o;if(n)i=t;else if(null!=t.length)(o=i).push.apply(o,_toConsumableArray(_toConsumableArray(t).map(r)));else i.push(r(t))}return i}function addManagedConnection(e,t,n){null!=t&&(t.connections.push(e),1===t.connections.length&&e.instance.addClass(e.source,e.instance.connectedClass)),null!=n&&(null!=t&&e.sourceId===e.targetId||(n.connections.push(e),1===n.connections.length&&e.instance.addClass(e.target,e.instance.connectedClass)))}function removeManagedConnection(e,t,n){if(null!=t){var i=t.connections.length;removeWithFunction(t.connections,(function(t){return e.id===t.id})),i>0&&0===t.connections.length&&e.instance.removeClass(e.source,e.instance.connectedClass)}if(null!=n){var r=n.connections.length;null!=t&&e.sourceId===e.targetId||removeWithFunction(n.connections,(function(t){return e.id===t.id})),r>0&&0===n.connections.length&&e.instance.removeClass(e.target,e.instance.connectedClass)}}_defineProperty(pr,"type","Straight");var fr=function(t){_inherits(JsPlumbInstance,t);var n=_createSuper(JsPlumbInstance);function JsPlumbInstance(t,i){var r;return _classCallCheck(this,JsPlumbInstance),(r=n.call(this))._instanceIndex=t,_defineProperty(_assertThisInitialized(r),"defaults",void 0),_defineProperty(_assertThisInitialized(r),"_initialDefaults",{}),_defineProperty(_assertThisInitialized(r),"isConnectionBeingDragged",!1),_defineProperty(_assertThisInitialized(r),"currentlyDragging",!1),_defineProperty(_assertThisInitialized(r),"hoverSuspended",!1),_defineProperty(_assertThisInitialized(r),"_suspendDrawing",!1),_defineProperty(_assertThisInitialized(r),"_suspendedAt",null),_defineProperty(_assertThisInitialized(r),"connectorClass",T),_defineProperty(_assertThisInitialized(r),"connectorOutlineClass",b),_defineProperty(_assertThisInitialized(r),"connectedClass",S),_defineProperty(_assertThisInitialized(r),"endpointClass",k),_defineProperty(_assertThisInitialized(r),"endpointConnectedClass",I),_defineProperty(_assertThisInitialized(r),"endpointFullClass",A),_defineProperty(_assertThisInitialized(r),"endpointFloatingClass",O),_defineProperty(_assertThisInitialized(r),"endpointDropAllowedClass",D),_defineProperty(_assertThisInitialized(r),"endpointDropForbiddenClass",w),_defineProperty(_assertThisInitialized(r),"endpointAnchorClassPrefix",M),_defineProperty(_assertThisInitialized(r),"overlayClass",j),_defineProperty(_assertThisInitialized(r),"connections",[]),_defineProperty(_assertThisInitialized(r),"endpointsByElement",{}),_defineProperty(_assertThisInitialized(r),"endpointsByUUID",new Map),_defineProperty(_assertThisInitialized(r),"sourceSelectors",[]),_defineProperty(_assertThisInitialized(r),"targetSelectors",[]),_defineProperty(_assertThisInitialized(r),"allowNestedGroups",void 0),_defineProperty(_assertThisInitialized(r),"_curIdStamp",1),_defineProperty(_assertThisInitialized(r),"viewport",new ar(_assertThisInitialized(r))),_defineProperty(_assertThisInitialized(r),"router",void 0),_defineProperty(_assertThisInitialized(r),"groupManager",void 0),_defineProperty(_assertThisInitialized(r),"_connectionTypes",new Map),_defineProperty(_assertThisInitialized(r),"_endpointTypes",new Map),_defineProperty(_assertThisInitialized(r),"_container",void 0),_defineProperty(_assertThisInitialized(r),"_managedElements",{}),_defineProperty(_assertThisInitialized(r),"DEFAULT_SCOPE",void 0),_defineProperty(_assertThisInitialized(r),"_zoom",1),r.defaults={anchor:e.AnchorLocations.Bottom,anchors:[null,null],connectionsDetachable:!0,connectionOverlays:[],connector:pr.type,container:null,endpoint:Ji.type,endpointOverlays:[],endpoints:[null,null],endpointStyle:{fill:"#456"},endpointStyles:[null,null],endpointHoverStyle:null,endpointHoverStyles:[null,null],hoverPaintStyle:null,listStyle:{},maxConnections:1,paintStyle:{strokeWidth:2,stroke:"#456"},reattachConnections:!1,scope:"jsplumb_defaultscope",allowNestedGroups:!0},i&&extend(r.defaults,i),extend(r._initialDefaults,r.defaults),null!=r._initialDefaults[Wi]&&(r._initialDefaults[Wi].strokeWidth=r._initialDefaults[Wi].strokeWidth||2),r.DEFAULT_SCOPE=r.defaults[qi],r.allowNestedGroups=!1!==r._initialDefaults[Xi],r.router=new cr(_assertThisInitialized(r)),r.groupManager=new Qi(_assertThisInitialized(r)),r.setContainer(r._initialDefaults.container),r}return _createClass(JsPlumbInstance,[{key:"defaultScope",get:function get(){return this.DEFAULT_SCOPE}},{key:"currentZoom",get:function get(){return this._zoom}},{key:"areDefaultAnchorsSet",value:function areDefaultAnchorsSet(){return this.validAnchorsSpec(this.defaults.anchors)}},{key:"validAnchorsSpec",value:function validAnchorsSpec(e){return null!=e&&null!=e[0]&&null!=e[1]}},{key:"getContainer",value:function getContainer(){return this._container}},{key:"setZoom",value:function setZoom(e,t){return this._zoom=e,this.fire(ie,this._zoom),t&&this.repaintEverything(),!0}},{key:"_idstamp",value:function _idstamp(){return""+this._curIdStamp++}},{key:"checkCondition",value:function checkCondition(e,t){var n=this.getListener(e),i=!0;if(n&&n.length>0){var r=Array.prototype.slice.call(arguments,1);try{for(var o=0,a=n.length;o<a;o++)i=i&&n[o].apply(n[o],r)}catch(t){log("cannot check condition ["+e+"]"+t)}}return i}},{key:"getId",value:function getId(e,t){if(null==e)return null;var n=this.getAttribute(e,v);return n&&"undefined"!==n||(2===arguments.length&&void 0!==arguments[1]?n=t:(1===arguments.length||3===arguments.length&&!arguments[2])&&(n="jsplumb-"+this._instanceIndex+"-"+this._idstamp()),this.setAttribute(e,v,n)),n}},{key:"getConnections",value:function getConnections(e,t){e?e.constructor===String&&(e={scope:e}):e={};for(var n=prepareList(this,e.scope||this.defaultScope,!0),i=prepareList(this,e.source),r=prepareList(this,e.target),o=!t&&n.length>1?{}:[],a=function _addOne(e,i){if(!t&&n.length>1){var r=o[e];null==r&&(r=o[e]=[]),r.push(i)}else o.push(i)},l=0,u=this.connections.length;l<u;l++){var h=this.connections[l],d=h.proxies&&h.proxies[0]?h.proxies[0].originalEp.elementId:h.sourceId,p=h.proxies&&h.proxies[1]?h.proxies[1].originalEp.elementId:h.targetId;filterList(n,h.scope)&&filterList(i,d)&&filterList(r,p)&&a(h.scope,h)}return o}},{key:"select",value:function select(e){return(e=e||{}).scope=e.scope||"*",new nr(this,e.connections||this.getConnections(e,!0))}},{key:"selectEndpoints",value:function selectEndpoints(e){(e=e||{}).scope=e.scope||Bt;var t=!e.element&&!e.source&&!e.target,n=t?Bt:prepareList(this,e.element),i=t?Bt:prepareList(this,e.source),r=t?Bt:prepareList(this,e.target),o=prepareList(this,e.scope,!0),a=[];for(var l in this.endpointsByElement){var u=filterList(n,l,!0),h=filterList(i,l,!0),d="*"!==i,p=filterList(r,l,!0),v="*"!==r;if(u||h||p)e:for(var g=0,_=this.endpointsByElement[l].length;g<_;g++){var m=this.endpointsByElement[l][g];if(filterList(o,m.scope,!0)){var E=d&&i.length>0&&!m.isSource,P=v&&r.length>0&&!m.isTarget;if(E||P)continue e;a.push(m)}}}return new tr(this,a)}},{key:"setContainer",value:function setContainer(e){this._container=e,this.fire(H,this._container)}},{key:"_set",value:function _set(e,t,n){var i,r,o=[{el:"source",elId:"sourceId"},{el:"target",elId:"targetId"}][n],a=e[o.elId],l=e.endpoints[n],u={index:n,originalEndpoint:l,originalSourceId:0===n?a:e.sourceId,newSourceId:e.sourceId,originalTargetId:1===n?a:e.targetId,newTargetId:e.targetId,connection:e,newEndpoint:l};return t instanceof Gi?(i=t).addConnection(e):i=(r=this.getId(t))===e[o.elId]?null:e.makeEndpoint(0===n,t,r),null!=i&&(u.newEndpoint=i,l.detachFromConnection(e),e.endpoints[n]=i,e[o.el]=i.element,e[o.elId]=i.elementId,u[0===n?"newSourceId":"newTargetId"]=i.elementId,this.fireMoveEvent(u),this._paintConnection(e)),u}},{key:"setSource",value:function setSource(e,t){removeManagedConnection(e,this._managedElements[e.sourceId]);var n=this._set(e,t,0);addManagedConnection(e,this._managedElements[n.newSourceId])}},{key:"setTarget",value:function setTarget(e,t){removeManagedConnection(e,this._managedElements[e.targetId]);var n=this._set(e,t,1);addManagedConnection(e,this._managedElements[n.newTargetId])}},{key:"setConnectionType",value:function setConnectionType(e,t,n){e.setType(t,n),this._paintConnection(e)}},{key:"isHoverSuspended",value:function isHoverSuspended(){return this.hoverSuspended}},{key:"setSuspendDrawing",value:function setSuspendDrawing(e,t){var n=this._suspendDrawing;return this._suspendDrawing=e,e?this._suspendedAt=""+(new Date).getTime():(this._suspendedAt=null,this.viewport.recomputeBounds()),t&&this.repaintEverything(),n}},{key:"getSuspendedAt",value:function getSuspendedAt(){return this._suspendedAt}},{key:"batch",value:function batch(e,t){var n=!0===this._suspendDrawing;n||this.setSuspendDrawing(!0),e(),n||this.setSuspendDrawing(!1,!t)}},{key:"each",value:function each(e,t){if(null!=e){if(null!=e.length)for(var n=0;n<e.length;n++)t(e[n]);else t(e);return this}}},{key:"updateOffset",value:function updateOffset(e){var t=e.elId;return e.recalc?this.viewport.refreshElement(t):this.viewport.getPosition(t)}},{key:"deleteConnection",value:function deleteConnection(e,t){if(null!=e&&!0!==e.deleted&&((t=t||{}).force||functionChain(!0,!1,[[e.endpoints[0],re,[e]],[e.endpoints[1],re,[e]],[e,re,[e]],[this,P,[ae,e]]]))){removeManagedConnection(e,this._managedElements[e.sourceId],this._managedElements[e.targetId]),this.fireDetachEvent(e,!e.pending&&!1!==t.fireEvent,t.originalEvent);var n=e.endpoints[0],i=e.endpoints[1];return n!==t.endpointToIgnore&&n.detachFromConnection(e,null,!0),i!==t.endpointToIgnore&&i.detachFromConnection(e,null,!0),removeWithFunction(this.connections,(function(t){return e.id===t.id})),e.destroy(),n!==t.endpointToIgnore&&n.deleteOnEmpty&&0===n.connections.length&&this.deleteEndpoint(n),i!==t.endpointToIgnore&&i.deleteOnEmpty&&0===i.connections.length&&this.deleteEndpoint(i),!0}return!1}},{key:"deleteEveryConnection",value:function deleteEveryConnection(e){var t=this;e=e||{};var n=this.connections.length,i=0;return this.batch((function(){for(var r=0;r<n;r++)i+=t.deleteConnection(t.connections[0],e)?1:0})),i}},{key:"deleteConnectionsForElement",value:function deleteConnectionsForElement(e,t){var n=this.getId(e),i=this._managedElements[n];if(i)for(var r=i.connections.length,o=0;o<r;o++)this.deleteConnection(i.connections[0],t);return this}},{key:"fireDetachEvent",value:function fireDetachEvent(e,t,n){var i=null!=e.id?{connection:e,source:e.source,target:e.target,sourceId:e.sourceId,targetId:e.targetId,sourceEndpoint:e.endpoints[0],targetEndpoint:e.endpoints[1]}:e;t&&this.fire(R,i,n),this.fire(Y,i,n)}},{key:"fireMoveEvent",value:function fireMoveEvent(e,t){this.fire(B,e,t)}},{key:"manageAll",value:function manageAll(e,t){for(var n=isString(e)?this.getSelector(this.getContainer(),e):e,i=0;i<n.length;i++)this.manage(n[i],null,t)}},{key:"manage",value:function manage(e,t,n){null==this.getAttribute(e,v)&&(t=t||this.getAttribute(e,"id")||uuid(),this.setAttribute(e,v,t));var i=this.getId(e);if(this._managedElements[i])n&&(this._managedElements[i].viewportElement=this.updateOffset({elId:i,timestamp:null,recalc:!0}));else{var r={el:e,endpoints:[],connections:[],rotation:0,data:{}};this._managedElements[i]=r,this._suspendDrawing?r.viewportElement=this.viewport.registerElement(i,!0):r.viewportElement=this.updateOffset({elId:i,recalc:!0}),this.fire(X,{el:e})}return this._managedElements[i]}},{key:"getManagedData",value:function getManagedData(e,t,n){if(this._managedElements[e]){var i=this._managedElements[e].data[t];return null!=i?i[n]:null}}},{key:"setManagedData",value:function setManagedData(e,t,n,i){this._managedElements[e]&&(this._managedElements[e].data[t]=this._managedElements[e].data[t]||{},this._managedElements[e].data[t][n]=i)}},{key:"getManagedElement",value:function getManagedElement(e){return this._managedElements[e]?this._managedElements[e].el:null}},{key:"unmanage",value:function unmanage(e,t){var n=this;this.removeAllEndpoints(e,!0);var i=function _one(e){var i=n.getId(e);n.removeAttribute(e,v),delete n._managedElements[i],n.viewport.remove(i),n.fire(ne,{el:e,id:i}),e&&t&&n._removeElement(e)};this._getAssociatedElements(e).map(i),i(e)}},{key:"rotate",value:function rotate(e,t,n){var i=this.getId(e);return this._managedElements[i]&&(this._managedElements[i].rotation=t,this.viewport.rotateElement(i,t),!0!==n)?this.revalidate(e):{c:new Set,e:new Set}}},{key:"_getRotation",value:function _getRotation(e){var t=this._managedElements[e];return null!=t&&t.rotation||0}},{key:"_getRotations",value:function _getRotations(e){var t=this,n=[],i=this._managedElements[e];return null!=i&&(n.push({r:i.viewportElement.r||0,c:i.viewportElement.c}),function _oneLevel(e){if(null!=e.group){var i=t._managedElements[e.group];null!=i&&(n.push({r:i.viewportElement.r,c:i.viewportElement.c}),_oneLevel(i))}}(i)),n}},{key:"_applyRotations",value:function _applyRotations(e,t){var n=e.slice(),i={x:n[0],y:n[1],cr:0,sr:0};return forEach(t,(function(e){i=rotatePoint(i,e.c,e.r)})),i}},{key:"_applyRotationsXY",value:function _applyRotationsXY(e,t){return forEach(t,(function(t){e=rotatePoint(e,t.c,t.r)})),e}},{key:"_internal_newEndpoint",value:function _internal_newEndpoint(e){var t=extend({},e),n=this.manage(t.element);t.elementId=this.getId(t.element),t.id="ep_"+this._idstamp();var i=new Gi(this,t);return function addManagedEndpoint(e,t){null!=e&&e.endpoints.push(t)}(n,i),e.uuid&&this.endpointsByUUID.set(e.uuid,i),addToDictionary(this.endpointsByElement,i.elementId,i),this._suspendDrawing||this._paintEndpoint(i,{timestamp:this._suspendedAt}),i}},{key:"_deriveEndpointAndAnchorSpec",value:function _deriveEndpointAndAnchorSpec(e,t){for(var n=((t?"":"default ")+e).split(/[\s]/),i=null,r=null,o=null,a=null,l=0;l<n.length;l++){var u=this.getConnectionType(n[l]);u&&(u.endpoints&&(i=u.endpoints),u.endpoint&&(r=u.endpoint),u.anchors&&(a=u.anchors),u.anchor&&(o=u.anchor))}return{endpoints:i||[r,r],anchors:a||[o,o]}}},{key:"revalidate",value:function revalidate(e,t){var n=this.getId(e);return this.updateOffset({elId:n,recalc:!0,timestamp:t}),this.repaint(e)}},{key:"repaintEverything",value:function repaintEverything(){var e,t=uuid();for(e in this._managedElements)this.viewport.refreshElement(e,!0);for(e in this.viewport.recomputeBounds(),this._managedElements)this.repaint(this._managedElements[e].el,t,!0);return this}},{key:"setElementPosition",value:function setElementPosition(e,t,n){var i=this.getId(e);return this.viewport.setPosition(i,t,n),this.repaint(e)}},{key:"repaint",value:function repaint(e,t,n){var i={c:new Set,e:new Set},r=function _mergeRedraw(e){e.c.forEach((function(e){return i.c.add(e)})),e.e.forEach((function(e){return i.e.add(e)}))};if(!this._suspendDrawing){var o=this.getId(e);if(null!=e){var a=this._getAssociatedElements(e);if(null==t&&(t=uuid()),!n)for(var l=0;l<a.length;l++)this.updateOffset({elId:this.getId(a[l]),recalc:!0,timestamp:t});if(r(this.router.redraw(o,t,null)),a.length>0)for(var u=0;u<a.length;u++)r(this.router.redraw(this.getId(a[u]),t,null))}}return i}},{key:"unregisterEndpoint",value:function unregisterEndpoint(e){var t=e.getUuid();t&&this.endpointsByUUID.delete(t),function removeManagedEndpoint(e,t){null!=e&&removeWithFunction(e.endpoints,(function(e){return e===t}))}(this._managedElements[e.elementId],e);var n=this.endpointsByElement[e.elementId];null!=n&&(this.endpointsByElement[e.elementId]=n.filter((function(t){return t!==e}))),this.fire(U,e)}},{key:"_maybePruneEndpoint",value:function _maybePruneEndpoint(e){return!(!e.deleteOnEmpty||0!==e.connections.length)&&(this.deleteEndpoint(e),!0)}},{key:"deleteEndpoint",value:function deleteEndpoint(e){var t=this,n="string"==typeof e?this.endpointsByUUID.get(e):e;if(n){var i=n.proxiedBy,r=n.connections.slice();forEach(r,(function(e){n.detachFromConnection(e,null,!0)})),this.unregisterEndpoint(n),n.destroy(),forEach(r,(function(e){t.deleteConnection(e,{force:!0,endpointToIgnore:n})})),null!=i&&this.deleteEndpoint(i)}return this}},{key:"addEndpoint",value:function addEndpoint(e,t,n){var i=extend({},n=n||{});extend(i,t||{});var r=extend({element:e},i);return this._internal_newEndpoint(r)}},{key:"addEndpoints",value:function addEndpoints(e,t,n){for(var i=[],r=0,o=t.length;r<o;r++)i.push(this.addEndpoint(e,t[r],n));return i}},{key:"reset",value:function reset(){var e=this;this.silently((function(){e.endpointsByElement={},e._managedElements={},e.endpointsByUUID.clear(),e.viewport.reset(),e.router.reset(),e.groupManager.reset(),e.connections.length=0}))}},{key:"destroy",value:function destroy(){this.reset(),this.unbind(),this.sourceSelectors.length=0,this.targetSelectors.length=0,this._connectionTypes.clear(),this._endpointTypes.clear()}},{key:"getEndpoints",value:function getEndpoints(e){return this.endpointsByElement[this.getId(e)]||[]}},{key:"getEndpoint",value:function getEndpoint(e){return this.endpointsByUUID.get(e)}},{key:"setEndpointUuid",value:function setEndpointUuid(e,t){e.uuid&&this.endpointsByUUID.delete(e.uuid),e.uuid=t,this.endpointsByUUID.set(t,e)}},{key:"connect",value:function connect(e,t){try{var n=this._prepareConnectionParams(e,t),i=this._newConnection(n);return this._finaliseConnection(i,n),i}catch(e){return void log(e)}}},{key:"_prepareConnectionParams",value:function _prepareConnectionParams(e,t){var n=extend({},e);t&&extend(n,t);var i=n;if(i.source&&i.source.endpoint&&(i.sourceEndpoint=i.source),i.target&&i.target.endpoint&&(i.targetEndpoint=i.target),e.uuids&&(i.sourceEndpoint=this.getEndpoint(e.uuids[0]),i.targetEndpoint=this.getEndpoint(e.uuids[1])),null!=i.sourceEndpoint){if(i.sourceEndpoint.isFull())throw ue;if(i.type||(i.type=i.sourceEndpoint.edgeType),i.sourceEndpoint.connectorOverlays){i.overlays=i.overlays||[];for(var r=0,o=i.sourceEndpoint.connectorOverlays.length;r<o;r++)i.overlays.push(i.sourceEndpoint.connectorOverlays[r])}i.sourceEndpoint.scope&&(i.scope=i.sourceEndpoint.scope)}else if(null==i.source)throw de;if(null!=i.targetEndpoint){if(i.targetEndpoint.isFull())throw he}else if(null==i.target)throw pe;if(i.sourceEndpoint&&i.targetEndpoint&&!function _scopeMatch(e,t){for(var n=e.scope.split(/\s/),i=t.scope.split(/\s/),r=0;r<n.length;r++)for(var o=0;o<i.length;o++)if(i[o]===n[r])return!0;return!1}(i.sourceEndpoint,i.targetEndpoint))throw"Cannot establish connection: scopes do not match";return i}},{key:"_newConnection",value:function _newConnection(e){e.id="con_"+this._idstamp();var t=new zi(this,e);return addManagedConnection(t,this._managedElements[t.sourceId],this._managedElements[t.targetId]),this._paintConnection(t),t}},{key:"_finaliseConnection",value:function _finaliseConnection(e,t,n){t=t||{},e.suspendedEndpoint||this.connections.push(e),e.pending=null,e.endpoints[0].isTemporarySource=!1,this.repaint(e.source);var i={connection:e,source:e.source,target:e.target,sourceId:e.sourceId,targetId:e.targetId,sourceEndpoint:e.endpoints[0],targetEndpoint:e.endpoints[1]};this.fire(F,i,n),t.doNotFireConnectionEvent||!1===t.fireEvent||this.fire(z,i,n)}},{key:"removeAllEndpoints",value:function removeAllEndpoints(e,t){var n=this,i=function _one(e){var t,i,r=n.getId(e),o=n.endpointsByElement[r];if(o)for(t=0,i=o.length;t<i;t++)n.deleteEndpoint(o[t]);delete n.endpointsByElement[r]};return t&&this._getAssociatedElements(e).map(i),i(e),this}},{key:"_createSourceDefinition",value:function _createSourceDefinition(e,t){var n=extend({},t);extend(n,e),n.edgeType=n.edgeType||zt;var i=this._deriveEndpointAndAnchorSpec(n.edgeType);n.endpoint=n.endpoint||i.endpoints[0],n.anchor=n.anchor||i.anchors[0];var r=n.maxConnections||-1;return{def:extend({},n),uniqueEndpoint:n.uniqueEndpoint,maxConnections:r,enabled:!0,endpoint:null}}},{key:"addSourceSelector",value:function addSourceSelector(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=this._createSourceDefinition(t),r=new pi(e,i,n);return this.sourceSelectors.push(r),r}},{key:"removeSourceSelector",value:function removeSourceSelector(e){removeWithFunction(this.sourceSelectors,(function(t){return t===e}))}},{key:"removeTargetSelector",value:function removeTargetSelector(e){removeWithFunction(this.targetSelectors,(function(t){return t===e}))}},{key:"addTargetSelector",value:function addTargetSelector(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=this._createTargetDefinition(t),r=new pi(e,i,n);return this.targetSelectors.push(r),r}},{key:"_createTargetDefinition",value:function _createTargetDefinition(e,t){var n=extend({},t);extend(n,e),n.edgeType=n.edgeType||zt;var i=n.maxConnections||-1;return{def:extend({},n),uniqueEndpoint:n.uniqueEndpoint,maxConnections:i,enabled:!0,endpoint:null}}},{key:"show",value:function show(e,t){return this._setVisible(e,a,t)}},{key:"hide",value:function hide(e,t){return this._setVisible(e,l,t)}},{key:"_setVisible",value:function _setVisible(e,t,n){var i=t===a,r=null;n&&(r=function endpointFunc(e){e.setVisible(i,!0,!0)});var o=this.getId(e);return this._operation(e,(function(e){if(i&&n){var t=e.sourceId===o?1:0;e.endpoints[t].isVisible()&&e.setVisible(!0)}else e.setVisible(i)}),r),this}},{key:"toggleVisible",value:function toggleVisible(e,t){var n=null;t&&(n=function endpointFunc(e){var t=e.isVisible();e.setVisible(!t)}),this._operation(e,(function(e){var t=e.isVisible();e.setVisible(!t)}),n)}},{key:"_operation",value:function _operation(e,t,n){var i=this.getId(e),r=this.endpointsByElement[i];if(r&&r.length)for(var o=0,a=r.length;o<a;o++){for(var l=0,u=r[o].connections.length;l<u;l++){if(t(r[o].connections[l]))return}n&&n(r[o])}}},{key:"registerConnectionType",value:function registerConnectionType(e,t){if(this._connectionTypes.set(e,extend({},t)),t.overlays){for(var n={},i=0;i<t.overlays.length;i++){var r=convertToFullOverlaySpec(t.overlays[i]);n[r.options.id]=r}this._connectionTypes.get(e).overlays=n}}},{key:"registerConnectionTypes",value:function registerConnectionTypes(e){for(var t in e)this.registerConnectionType(t,e[t])}},{key:"registerEndpointType",value:function registerEndpointType(e,t){if(this._endpointTypes.set(e,extend({},t)),t.overlays){for(var n={},i=0;i<t.overlays.length;i++){var r=convertToFullOverlaySpec(t.overlays[i]);n[r.options.id]=r}this._endpointTypes.get(e).overlays=n}}},{key:"registerEndpointTypes",value:function registerEndpointTypes(e){for(var t in e)this.registerEndpointType(t,e[t])}},{key:"getType",value:function getType(e,t){return"connection"===t?this.getConnectionType(e):this.getEndpointType(e)}},{key:"getConnectionType",value:function getConnectionType(e){return this._connectionTypes.get(e)}},{key:"getEndpointType",value:function getEndpointType(e){return this._endpointTypes.get(e)}},{key:"importDefaults",value:function importDefaults(e){for(var t in e)this.defaults[t]=e[t];return null!=this.defaults[Wi]&&(this.defaults[Wi].strokeWidth=this.defaults[Wi].strokeWidth||2),e.container&&this.setContainer(e.container),this}},{key:"restoreDefaults",value:function restoreDefaults(){return this.defaults=extend({},this._initialDefaults),this}},{key:"getManagedElements",value:function getManagedElements(){return this._managedElements}},{key:"proxyConnection",value:function proxyConnection(e,t,n,i,r){var o,a=null!=e.proxies[t],l=a?e.proxies[t].originalEp.elementId:e.endpoints[t].elementId,u=a?e.proxies[t].originalEp:e.endpoints[t],h=this.getId(n);e.proxies[t]?e.proxies[t].ep.elementId===h?o=e.proxies[t].ep:(e.proxies[t].ep.detachFromConnection(e,t),o=this._internal_newEndpoint({element:n,endpoint:i(e,t),anchor:r(e,t),parameters:{isProxyEndpoint:!0}})):o=this._internal_newEndpoint({element:n,endpoint:i(e,t),anchor:r(e,t),parameters:{isProxyEndpoint:!0}}),o.deleteOnEmpty=!0,e.proxies[t]={ep:o,originalEp:u},this.sourceOrTargetChanged(l,h,e,n,t),u.detachFromConnection(e,null,!0),o.connections=[e],e.endpoints[t]=o,u.proxiedBy=o,u.setVisible(!1),e.setVisible(!0),this.revalidate(n)}},{key:"unproxyConnection",value:function unproxyConnection(e,t){if(null!=e.proxies&&null!=e.proxies[t]){var n=e.proxies[t].originalEp.element,i=e.proxies[t].originalEp.elementId,r=e.proxies[t].ep.elementId;e.endpoints[t]=e.proxies[t].originalEp,delete e.proxies[t].originalEp.proxiedBy,this.sourceOrTargetChanged(r,i,e,n,t),e.proxies[t].ep.detachFromConnection(e,null),e.proxies[t].originalEp.addConnection(e),e.isVisible()&&e.proxies[t].originalEp.setVisible(!0),e.proxies[t]=null,-1===findWithFunction(e.proxies,(function(e){return null!=e}))&&(e.proxies.length=0)}}},{key:"sourceOrTargetChanged",value:function sourceOrTargetChanged(e,t,n,i,r){e!==t&&(0===r?(n.sourceId=t,n.source=i):1===r&&(n.targetId=t,n.target=i),removeManagedConnection(n,this._managedElements[e]),addManagedConnection(n,this._managedElements[t]))}},{key:"getGroup",value:function getGroup(e){return this.groupManager.getGroup(e)}},{key:"getGroupFor",value:function getGroupFor(e){return this.groupManager.getGroupFor(e)}},{key:"addGroup",value:function addGroup(e){return this.groupManager.addGroup(e)}},{key:"addToGroup",value:function addToGroup(e){for(var t,n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];return(t=this.groupManager).addToGroup.apply(t,[e,!1].concat(i))}},{key:"collapseGroup",value:function collapseGroup(e){this.groupManager.collapseGroup(e)}},{key:"expandGroup",value:function expandGroup(e){this.groupManager.expandGroup(e)}},{key:"toggleGroup",value:function toggleGroup(e){this.groupManager.toggleGroup(e)}},{key:"removeGroup",value:function removeGroup(e,t,n,i){return this.groupManager.removeGroup(e,t,n,i)}},{key:"removeAllGroups",value:function removeAllGroups(e,t){this.groupManager.removeAllGroups(e,t,!1)}},{key:"removeFromGroup",value:function removeFromGroup(e,t,n){this.groupManager.removeFromGroup(e,n,t),this._appendElement(t,this.getContainer()),this.updateOffset({recalc:!0,elId:this.getId(t)})}},{key:"_paintEndpoint",value:function _paintEndpoint(e,t){var n=(t=t||{}).timestamp,i=!(!1===t.recalc);if(!n||e.timestamp!==n){var r=this.viewport.getPosition(e.elementId),o=t.offset?{x:t.offset.x,y:t.offset.y}:{x:r.x,y:r.y};if(null!=o){var a=t.anchorLoc;if(null==a){var l={xy:o,wh:r,element:e,timestamp:n};if(i&&this.router.isDynamicAnchor(e)&&e.connections.length>0){var u=function findConnectionToUseForDynamicAnchor(e){var n=0;if(null!=t.elementWithPrecedence)for(var i=0;i<e.connections.length;i++)if(e.connections[i].sourceId===t.elementWithPrecedence||e.connections[i].targetId===t.elementWithPrecedence){n=i;break}return e.connections[n]}(e),h=u.endpoints[0]===e?1:0,d=0===h?u.sourceId:u.targetId,p=this.viewport.getPosition(d);l.index=0===h?1:0,l.connection=u,l.txy=p,l.twh=p,l.tElement=u.endpoints[h],l.tRotation=this._getRotations(d)}else e.connections.length>0&&(l.connection=e.connections[0]);l.rotation=this._getRotations(e.elementId),a=this.router.computeAnchorLocation(e._anchor,l)}for(var v in e.endpoint.compute(a,this.router.getEndpointOrientation(e),e.paintStyleInUse),this.renderEndpoint(e,e.paintStyleInUse),e.timestamp=n,e.overlays)if(e.overlays.hasOwnProperty(v)){var g=e.overlays[v];g.isVisible()&&(e.overlayPlacements[v]=this.drawOverlay(g,e.endpoint,e.paintStyleInUse,e.getAbsoluteOverlayPosition(g)),this._paintOverlay(g,e.overlayPlacements[v],{xmin:0,ymin:0}))}}}}},{key:"_paintConnection",value:function _paintConnection(e,t){if(!this._suspendDrawing&&!1!==e.visible){var n=(t=t||{}).timestamp;if(null!=n&&n===e.lastPaintedAt)return;if(null==n||n!==e.lastPaintedAt){this.router.computePath(e,n);var i={xmin:1/0,ymin:1/0,xmax:-1/0,ymax:-1/0};for(var r in e.overlays)if(e.overlays.hasOwnProperty(r)){var o=e.overlays[r];o.isVisible()&&(e.overlayPlacements[r]=this.drawOverlay(o,e.connector,e.paintStyleInUse,e.getAbsoluteOverlayPosition(o)),i.xmin=Math.min(i.xmin,e.overlayPlacements[r].xmin),i.xmax=Math.max(i.xmax,e.overlayPlacements[r].xmax),i.ymin=Math.min(i.ymin,e.overlayPlacements[r].ymin),i.ymax=Math.max(i.ymax,e.overlayPlacements[r].ymax))}var a=parseFloat(""+e.paintStyleInUse.strokeWidth||"1")/2,l=parseFloat(""+e.paintStyleInUse.strokeWidth||"0"),u={xmin:Math.min(e.connector.bounds.xmin-(a+l),i.xmin),ymin:Math.min(e.connector.bounds.ymin-(a+l),i.ymin),xmax:Math.max(e.connector.bounds.xmax+(a+l),i.xmax),ymax:Math.max(e.connector.bounds.ymax+(a+l),i.ymax)};for(var h in this.paintConnector(e.connector,e.paintStyleInUse,u),e.overlays)if(e.overlays.hasOwnProperty(h)){var d=e.overlays[h];d.isVisible()&&this._paintOverlay(d,e.overlayPlacements[h],u)}}e.lastPaintedAt=n}}},{key:"_refreshEndpoint",value:function _refreshEndpoint(e){e._anchor.isFloating||(e.connections.length>0?this.addEndpointClass(e,this.endpointConnectedClass):this.removeEndpointClass(e,this.endpointConnectedClass),e.isFull()?this.addEndpointClass(e,this.endpointFullClass):this.removeEndpointClass(e,this.endpointFullClass))}},{key:"_makeConnector",value:function _makeConnector(e,t,n){return hr.get(e,t,n)}},{key:"addOverlay",value:function addOverlay(e,t,n){if(e.addOverlay(t),!n){var i=e instanceof Gi?e.element:e.source;this.revalidate(i)}}},{key:"removeOverlay",value:function removeOverlay(e,t){e.removeOverlay(t);var n=e instanceof Gi?e.element:e.source;this.revalidate(n)}},{key:"setOutlineColor",value:function setOutlineColor(e,t){e.paintStyleInUse.outlineStroke=t,this._paintConnection(e)}},{key:"setOutlineWidth",value:function setOutlineWidth(e,t){e.paintStyleInUse.outlineWidth=t,this._paintConnection(e)}},{key:"setColor",value:function setColor(e,t){e.paintStyleInUse.stroke=t,this._paintConnection(e)}},{key:"setLineWidth",value:function setLineWidth(e,t){e.paintStyleInUse.strokeWidth=t,this._paintConnection(e)}},{key:"setLineStyle",value:function setLineStyle(e,t){null!=t.lineWidth&&(e.paintStyleInUse.strokeWidth=t.lineWidth),null!=t.outlineWidth&&(e.paintStyleInUse.outlineWidth=t.outlineWidth),null!=t.color&&(e.paintStyleInUse.stroke=t.color),null!=t.outlineColor&&(e.paintStyleInUse.outlineStroke=t.outlineColor),this._paintConnection(e)}},{key:"getPathData",value:function getPathData(e){for(var t="",n=0;n<e.segments.length;n++)t+=e.segments[n].getPath(0===n),t+=" ";return t}}]),JsPlumbInstance}(xi),yr={};function registerEndpointRenderer(e,t){yr[e]=t}function getPositionOnElement(e,t,n){var i=t,r=_typeof(t.getBoundingClientRect)!==Nt?t.getBoundingClientRect():{left:0,top:0,width:0,height:0},o=document.body,a=document.documentElement,l=window.pageYOffset||a.scrollTop||o.scrollTop,u=window.pageXOffset||a.scrollLeft||o.scrollLeft,h=a.clientTop||o.clientTop||0,d=a.clientLeft||o.clientLeft||0,p=r.top+l-h+0*n,v=r.left+u-d+0*n,g=pageLocation(e),_=r.width||i.offsetWidth*n,m=r.height||i.offsetHeight*n;return{x:(g.x-v)/_,y:(g.y-p)/m}}function isSVGElementOverlay(e){return isArrowOverlay(e)||isDiamondOverlay(e)||isPlainArrowOverlay(e)}function setVisible(e,t){e.canvas&&(e.canvas.style.display=t?"block":"none")}function cleanup(e){e.canvas&&e.canvas.parentNode.removeChild(e.canvas),delete e.canvas}function getEndpointCanvas(e){return e.canvas}function getLabelElement(e){return Ci.getElement(e)}function getCustomElement(e){return Ci.getElement(e,e.component,(function(t){var n=e.create(t);return e.instance.addClass(n,e.instance.overlayClass),n}))}function groupDragConstrain(e,t,n,i){var r=e.x,o=e.y;return t._jsPlumbParentGroup&&t._jsPlumbParentGroup.constrain&&(r=Math.max(e.x,0),o=Math.max(e.y,0),r=Math.min(r,n.w-i.w),o=Math.min(o,n.h-i.h)),{x:r,y:o}}var vr=function(t){_inherits(BrowserJsPlumbInstance,t);var n=_createSuper(BrowserJsPlumbInstance);function BrowserJsPlumbInstance(e,t){var i;if(_classCallCheck(this,BrowserJsPlumbInstance),(i=n.call(this,e,t))._instanceIndex=e,_defineProperty(_assertThisInitialized(i),"containerType",null),_defineProperty(_assertThisInitialized(i),"dragSelection",void 0),_defineProperty(_assertThisInitialized(i),"dragManager",void 0),_defineProperty(_assertThisInitialized(i),"_connectorClick",void 0),_defineProperty(_assertThisInitialized(i),"_connectorDblClick",void 0),_defineProperty(_assertThisInitialized(i),"_connectorTap",void 0),_defineProperty(_assertThisInitialized(i),"_connectorDblTap",void 0),_defineProperty(_assertThisInitialized(i),"_endpointClick",void 0),_defineProperty(_assertThisInitialized(i),"_endpointDblClick",void 0),_defineProperty(_assertThisInitialized(i),"_overlayClick",void 0),_defineProperty(_assertThisInitialized(i),"_overlayDblClick",void 0),_defineProperty(_assertThisInitialized(i),"_overlayTap",void 0),_defineProperty(_assertThisInitialized(i),"_overlayDblTap",void 0),_defineProperty(_assertThisInitialized(i),"_connectorMouseover",void 0),_defineProperty(_assertThisInitialized(i),"_connectorMouseout",void 0),_defineProperty(_assertThisInitialized(i),"_endpointMouseover",void 0),_defineProperty(_assertThisInitialized(i),"_endpointMouseout",void 0),_defineProperty(_assertThisInitialized(i),"_connectorContextmenu",void 0),_defineProperty(_assertThisInitialized(i),"_connectorMousedown",void 0),_defineProperty(_assertThisInitialized(i),"_connectorMouseup",void 0),_defineProperty(_assertThisInitialized(i),"_endpointMousedown",void 0),_defineProperty(_assertThisInitialized(i),"_endpointMouseup",void 0),_defineProperty(_assertThisInitialized(i),"_overlayMouseover",void 0),_defineProperty(_assertThisInitialized(i),"_overlayMouseout",void 0),_defineProperty(_assertThisInitialized(i),"_elementClick",void 0),_defineProperty(_assertThisInitialized(i),"_elementTap",void 0),_defineProperty(_assertThisInitialized(i),"_elementDblTap",void 0),_defineProperty(_assertThisInitialized(i),"_elementMouseenter",void 0),_defineProperty(_assertThisInitialized(i),"_elementMouseexit",void 0),_defineProperty(_assertThisInitialized(i),"_elementMousemove",void 0),_defineProperty(_assertThisInitialized(i),"_elementMouseup",void 0),_defineProperty(_assertThisInitialized(i),"_elementMousedown",void 0),_defineProperty(_assertThisInitialized(i),"_elementContextmenu",void 0),_defineProperty(_assertThisInitialized(i),"_resizeObserver",void 0),_defineProperty(_assertThisInitialized(i),"eventManager",void 0),_defineProperty(_assertThisInitialized(i),"draggingClass","jtk-dragging"),_defineProperty(_assertThisInitialized(i),"elementDraggingClass","jtk-element-dragging"),_defineProperty(_assertThisInitialized(i),"hoverClass","jtk-hover"),_defineProperty(_assertThisInitialized(i),"sourceElementDraggingClass","jtk-source-element-dragging"),_defineProperty(_assertThisInitialized(i),"targetElementDraggingClass","jtk-target-element-dragging"),_defineProperty(_assertThisInitialized(i),"hoverSourceClass","jtk-source-hover"),_defineProperty(_assertThisInitialized(i),"hoverTargetClass","jtk-target-hover"),_defineProperty(_assertThisInitialized(i),"dragSelectClass","jtk-drag-select"),_defineProperty(_assertThisInitialized(i),"managedElementsSelector",void 0),_defineProperty(_assertThisInitialized(i),"elementsDraggable",void 0),_defineProperty(_assertThisInitialized(i),"elementDragHandler",void 0),_defineProperty(_assertThisInitialized(i),"groupDragOptions",void 0),_defineProperty(_assertThisInitialized(i),"elementDragOptions",void 0),_defineProperty(_assertThisInitialized(i),"svg",{node:function node(e,t){return _node(e,t)},attr:function attr(e,t){return _attr(e,t)},pos:function pos(e){return _pos(e)}}),t=t||{},i.containerType=getElementType(i.getContainer()),i.elementsDraggable=t&&!1!==t.elementsDraggable,i.managedElementsSelector=t&&t.managedElementsSelector||ce,i.eventManager=new $t,i.dragSelection=new On(_assertThisInitialized(i)),i.dragManager=new zn(_assertThisInitialized(i),i.dragSelection),i.dragManager.addHandler(new Ei(_assertThisInitialized(i))),i.groupDragOptions={constrainFunction:groupDragConstrain},i.dragManager.addHandler(new Pi(_assertThisInitialized(i),i.dragSelection),i.groupDragOptions),i.elementDragHandler=new Vn(_assertThisInitialized(i),i.dragSelection),i.elementDragOptions=t&&t.dragOptions||{},i.dragManager.addHandler(i.elementDragHandler,i.elementDragOptions),t&&t.dragOptions&&t.dragOptions.filter&&i.dragManager.addFilter(t.dragOptions.filter),i._createEventListeners(),i._attachEventDelegates(),!1!==t.resizeObserver)try{i._resizeObserver=new ResizeObserver((function(e){e.filter((function(e){var t=i.getAttribute(e.target,v);if(null!=t){var n=i.viewport._elementMap.get(t);return!!n&&(n.w!==e.contentRect.width||n.h!==e.contentRect.height)}return!1})).forEach((function(e){return i.revalidate(e.target)}))}))}catch(e){log("WARN: ResizeObserver could not be attached.")}return i}return _createClass(BrowserJsPlumbInstance,[{key:"fireOverlayMethod",value:function fireOverlayMethod(e,t,n){var i=compoundEvent(e.component instanceof zi?Oe:Ie,t);n._jsPlumbOverlay=e,e.fire(t,{e:n,overlay:e}),this.fire(i,e.component,n)}},{key:"addDragFilter",value:function addDragFilter(e,t){this.dragManager.addFilter(e,t)}},{key:"removeDragFilter",value:function removeDragFilter(e){this.dragManager.removeFilter(e)}},{key:"setDragGrid",value:function setDragGrid(e){this.dragManager.setOption(this.elementDragHandler,{grid:e})}},{key:"setDragConstrainFunction",value:function setDragConstrainFunction(e){this.dragManager.setOption(this.elementDragHandler,{constrainFunction:e})}},{key:"_removeElement",value:function _removeElement(e){e.parentNode&&e.parentNode.removeChild(e)}},{key:"_appendElement",value:function _appendElement(e,t){t&&t.appendChild(e)}},{key:"_appendElementToGroup",value:function _appendElementToGroup(e,t){this.getGroupContentArea(e).appendChild(t)}},{key:"_appendElementToContainer",value:function _appendElementToContainer(e){this._appendElement(e,this.getContainer())}},{key:"_getAssociatedElements",value:function _getAssociatedElements(e){var t=[];if(3!==e.nodeType&&8!==e.nodeType){var n=e.querySelectorAll(ce);Array.prototype.push.apply(t,n)}return t.filter((function(e){return 3!==e.nodeType&&8!==e.nodeType}))}},{key:"shouldFireEvent",value:function shouldFireEvent(e,t,n){return!0}},{key:"getClass",value:function getClass$1(e){return getClass(e)}},{key:"addClass",value:function addClass$1(e,t){addClass(e,t)}},{key:"hasClass",value:function hasClass$1(e,t){return hasClass(e,t)}},{key:"removeClass",value:function removeClass$1(e,t){removeClass(e,t)}},{key:"toggleClass",value:function toggleClass$1(e,t){toggleClass(e,t)}},{key:"setAttribute",value:function setAttribute(e,t,n){e.setAttribute(t,n)}},{key:"getAttribute",value:function getAttribute(e,t){return e.getAttribute(t)}},{key:"setAttributes",value:function setAttributes(e,t){for(var n in t)e.setAttribute(n,t[n])}},{key:"removeAttribute",value:function removeAttribute(e,t){e.removeAttribute&&e.removeAttribute(t)}},{key:"on",value:function on(e,t,n,i){var r=this,o=function _one(e){null==i?r.eventManager.on(e,t,n):r.eventManager.on(e,t,n,i)};return isNodeList(e)?forEach(e,(function(e){return o(e)})):o(e),this}},{key:"off",value:function off(e,t,n){var i=this;return isNodeList(e)?forEach(e,(function(e){return i.eventManager.off(e,t,n)})):this.eventManager.off(e,t,n),this}},{key:"trigger",value:function trigger(e,t,n,i,r){this.eventManager.trigger(e,t,n,i,r)}},{key:"getOffsetRelativeToRoot",value:function getOffsetRelativeToRoot(e){return offsetRelativeToRoot(e)}},{key:"getOffset",value:function getOffset(e){for(var t=e,n=this.getContainer(),i=this.getPosition(t),r=e!==n&&t.offsetParent!==n?t.offsetParent:null,o=function _maybeAdjustScroll(e){null!=e&&e!==document.body&&(e.scrollTop>0||e.scrollLeft>0)&&(i.x-=e.scrollLeft,i.y-=e.scrollTop)};null!=r;)i.x+=r.offsetLeft,i.y+=r.offsetTop,o(r),r=r.offsetParent===n?null:r.offsetParent;if(null!=n&&(n.scrollTop>0||n.scrollLeft>0)){var a=null!=t.offsetParent?this.getStyle(t.offsetParent,It):d,l=this.getStyle(t,It);l!==u&&l!==h&&a!==u&&a!==h&&(i.x-=n.scrollLeft,i.y-=n.scrollTop)}return i}},{key:"getSize",value:function getSize(e){var t=e;return null!=t.offsetWidth?offsetSize(e):t.width&&t.width.baseVal?svgWidthHeightSize(t):void 0}},{key:"getPosition",value:function getPosition(e){var t=e;return null!=t.offsetLeft?{x:parseFloat(t.offsetLeft),y:parseFloat(t.offsetTop)}:t.x&&t.x.baseVal?svgXYPosition(t):void 0}},{key:"getStyle",value:function getStyle(e,t){return _typeof(window.getComputedStyle)!==Nt?getComputedStyle(e,null).getPropertyValue(t):e.currentStyle[t]}},{key:"getGroupContentArea",value:function getGroupContentArea(e){var t=this.getSelector(e.el,wt);return t&&t.length>0?t[0]:e.el}},{key:"getSelector",value:function getSelector(e,t){var n=null;if(1===arguments.length){if(!isString(e)){var i=document.createDocumentFragment();return i.appendChild(e),fromArray(i.childNodes)}n=fromArray(document.querySelectorAll(e))}else n=fromArray(e.querySelectorAll(t));return n}},{key:"setPosition",value:function setPosition(e,t){var n=e;n.style.left=t.x+"px",n.style.top=t.y+"px"}},{key:"setDraggable",value:function setDraggable(e,t){t?this.removeAttribute(e,g):this.setAttribute(e,g,Ft)}},{key:"isDraggable",value:function isDraggable(e){var t=this.getAttribute(e,g);return null==t||t===Rt}},{key:"toggleDraggable",value:function toggleDraggable(e){var t=this.isDraggable(e);return this.setDraggable(e,!t),!t}},{key:"_createEventListeners",value:function _createEventListeners(){var e=function _connClick(e,t){if(!t.defaultPrevented&&null==t._jsPlumbOverlay){var n=findParent(getEventSource(t),At,this.getContainer(),!0);this.fire(e,n.jtk.connector.connection,t)}};this._connectorClick=e.bind(this,mt),this._connectorDblClick=e.bind(this,Et),this._connectorTap=e.bind(this,kt),this._connectorDblTap=e.bind(this,Pt);var t=function _connectorHover(e,t){var n=getEventSource(t).parentNode;if(n.jtk&&n.jtk.connector){var i=n.jtk.connector,r=i.connection;this.setConnectorHover(i,e),e?(this.addClass(r.source,this.hoverSourceClass),this.addClass(r.target,this.hoverTargetClass)):(this.removeClass(r.source,this.hoverSourceClass),this.removeClass(r.target,this.hoverTargetClass)),this.fire(e?xt:Ct,n.jtk.connector.connection,t)}};this._connectorMouseover=t.bind(this,!0),this._connectorMouseout=t.bind(this,!1);var n=function _connectorMouseupdown(e,t){var n=getEventSource(t).parentNode;n.jtk&&n.jtk.connector&&this.fire(e?Tt:bt,n.jtk.connector.connection,t)};this._connectorMouseup=n.bind(this,!0),this._connectorMousedown=n.bind(this,!1),this._connectorContextmenu=function(e){var t=getEventSource(e).parentNode;t.jtk&&t.jtk.connector&&this.fire(St,t.jtk.connector.connection,e)}.bind(this);var i=function _epClick(e,t,n){t.defaultPrevented||null!=t._jsPlumbOverlay||this.fire(e,n.jtk.endpoint,t)};this._endpointClick=i.bind(this,ut),this._endpointDblClick=i.bind(this,ht);var r=function _endpointHover(e,t){var n=getEventSource(t);n.jtk&&n.jtk.endpoint&&(this.setEndpointHover(n.jtk.endpoint,e),this.fire(e?ft:pt,n.jtk.endpoint,t))};this._endpointMouseover=r.bind(this,!0),this._endpointMouseout=r.bind(this,!1);var o=function _endpointMouseupdown(e,t){var n=getEventSource(t);n.jtk&&n.jtk.endpoint&&this.fire(e?yt:vt,n.jtk.endpoint,t)};this._endpointMouseup=o.bind(this,!0),this._endpointMousedown=o.bind(this,!1);var a=function(e,t){var n=findParent(getEventSource(t),Mt,this.getContainer(),!0).jtk.overlay;n&&this.fireOverlayMethod(n,e,t)}.bind(this);this._overlayClick=a.bind(this,we),this._overlayDblClick=a.bind(this,Le),this._overlayTap=a.bind(this,Ue),this._overlayDblTap=a.bind(this,Ge);var l=function _overlayHover(e,t){var n=findParent(getEventSource(t),Mt,this.getContainer(),!0).jtk.overlay;n&&this.setOverlayHover(n,e)};this._overlayMouseover=l.bind(this,!0),this._overlayMouseout=l.bind(this,!1);this._elementClick=function _elementClick(e,t,n){t.defaultPrevented||this.fire(1===t.detail?et:tt,n,t)}.bind(this,et);this._elementTap=function _elementTap(e,t,n){t.defaultPrevented||this.fire(ct,n,t)}.bind(this,ct);this._elementDblTap=function _elementDblTap(e,t,n){t.defaultPrevented||this.fire(nt,n,t)}.bind(this,nt);var u=function _elementHover(e,t){this.fire(e?rt:it,getEventSource(t),t)};this._elementMouseenter=u.bind(this,!0),this._elementMouseexit=u.bind(this,!1),this._elementMousemove=function(e){this.fire(ot,getEventSource(e),e)}.bind(this),this._elementMouseup=function(e){this.fire(st,getEventSource(e),e)}.bind(this),this._elementMousedown=function(e){this.fire(at,getEventSource(e),e)}.bind(this),this._elementContextmenu=function(e){this.fire(lt,getEventSource(e),e)}.bind(this)}},{key:"_attachEventDelegates",value:function _attachEventDelegates(){var e=this.getContainer();this.eventManager.on(e,we,Mt,this._overlayClick),this.eventManager.on(e,Le,Mt,this._overlayDblClick),this.eventManager.on(e,Ue,Mt,this._overlayTap),this.eventManager.on(e,Ge,Mt,this._overlayDblTap),this.eventManager.on(e,we,At,this._connectorClick),this.eventManager.on(e,Le,At,this._connectorDblClick),this.eventManager.on(e,Ue,At,this._connectorTap),this.eventManager.on(e,Ge,At,this._connectorDblTap),this.eventManager.on(e,we,Ot,this._endpointClick),this.eventManager.on(e,Le,Ot,this._endpointDblClick),this.eventManager.on(e,we,this.managedElementsSelector,this._elementClick),this.eventManager.on(e,Ue,this.managedElementsSelector,this._elementTap),this.eventManager.on(e,Ge,this.managedElementsSelector,this._elementDblTap),this.eventManager.on(e,Ve,At,this._connectorMouseover),this.eventManager.on(e,He,At,this._connectorMouseout),this.eventManager.on(e,Me,At,this._connectorContextmenu),this.eventManager.on(e,Be,At,this._connectorMouseup),this.eventManager.on(e,Ne,At,this._connectorMousedown),this.eventManager.on(e,Ve,Ot,this._endpointMouseover),this.eventManager.on(e,He,Ot,this._endpointMouseout),this.eventManager.on(e,Be,Ot,this._endpointMouseup),this.eventManager.on(e,Ne,Ot,this._endpointMousedown),this.eventManager.on(e,Ve,Mt,this._overlayMouseover),this.eventManager.on(e,He,Mt,this._overlayMouseout),this.eventManager.on(e,Ve,ce,this._elementMouseenter),this.eventManager.on(e,He,ce,this._elementMouseexit),this.eventManager.on(e,Re,ce,this._elementMousemove),this.eventManager.on(e,Be,ce,this._elementMouseup),this.eventManager.on(e,Ne,ce,this._elementMousedown),this.eventManager.on(e,Me,ce,this._elementContextmenu)}},{key:"_detachEventDelegates",value:function _detachEventDelegates(){var e=this.getContainer();e&&(this.eventManager.off(e,we,this._connectorClick),this.eventManager.off(e,Le,this._connectorDblClick),this.eventManager.off(e,Ue,this._connectorTap),this.eventManager.off(e,Ge,this._connectorDblTap),this.eventManager.off(e,we,this._endpointClick),this.eventManager.off(e,Le,this._endpointDblClick),this.eventManager.off(e,we,this._overlayClick),this.eventManager.off(e,Le,this._overlayDblClick),this.eventManager.off(e,Ue,this._overlayTap),this.eventManager.off(e,Ge,this._overlayDblTap),this.eventManager.off(e,we,this._elementClick),this.eventManager.off(e,Ue,this._elementTap),this.eventManager.off(e,Ge,this._elementDblTap),this.eventManager.off(e,Ve,this._connectorMouseover),this.eventManager.off(e,He,this._connectorMouseout),this.eventManager.off(e,Me,this._connectorContextmenu),this.eventManager.off(e,Be,this._connectorMouseup),this.eventManager.off(e,Ne,this._connectorMousedown),this.eventManager.off(e,Ve,this._endpointMouseover),this.eventManager.off(e,He,this._endpointMouseout),this.eventManager.off(e,Be,this._endpointMouseup),this.eventManager.off(e,Ne,this._endpointMousedown),this.eventManager.off(e,Ve,this._overlayMouseover),this.eventManager.off(e,He,this._overlayMouseout),this.eventManager.off(e,ze,this._elementMouseenter),this.eventManager.off(e,Fe,this._elementMouseexit),this.eventManager.off(e,Re,this._elementMousemove),this.eventManager.off(e,Be,this._elementMouseup),this.eventManager.off(e,Ne,this._elementMousedown),this.eventManager.off(e,Me,this._elementContextmenu))}},{key:"setContainer",value:function setContainer(e){var t,n=this;if(e===document||e===document.body)throw new Error("Cannot set document or document.body as container element");this._detachEventDelegates(),null!=this.dragManager&&(t=this.dragManager.reset()),this.setAttribute(e,Te,uuid().replace("-",""));var i=this.getContainer();null!=i&&(i.removeAttribute(Te),forEach(fromArray(i.childNodes).filter((function(e){return null!=e&&(n.hasClass(e,T)||n.hasClass(e,k)||n.hasClass(e,j)||e.getAttribute&&null!=e.getAttribute(v))})),(function(t){e.appendChild(t)})));_get(_getPrototypeOf(BrowserJsPlumbInstance.prototype),"setContainer",this).call(this,e),this.containerType=getElementType(e),null!=this.eventManager&&this._attachEventDelegates(),null!=this.dragManager&&(this.dragManager.addHandler(new Ei(this)),this.dragManager.addHandler(new Pi(this,this.dragSelection),this.groupDragOptions),this.elementDragHandler=new Vn(this,this.dragSelection),this.dragManager.addHandler(this.elementDragHandler,this.elementDragOptions),null!=t&&this.dragManager.setFilters(t))}},{key:"reset",value:function reset(){_get(_getPrototypeOf(BrowserJsPlumbInstance.prototype),"reset",this).call(this),this._resizeObserver&&this._resizeObserver.disconnect(),forEach(this.getContainer().querySelectorAll([ce,Ot,At,Mt].join(",")),(function(e){return e.parentNode&&e.parentNode.removeChild(e)}))}},{key:"destroy",value:function destroy(){this._detachEventDelegates(),null!=this.dragManager&&this.dragManager.reset(),this.clearDragSelection(),_get(_getPrototypeOf(BrowserJsPlumbInstance.prototype),"destroy",this).call(this)}},{key:"unmanage",value:function unmanage(e,t){null!=this._resizeObserver&&this._resizeObserver.unobserve(e),this.removeFromDragSelection(e),_get(_getPrototypeOf(BrowserJsPlumbInstance.prototype),"unmanage",this).call(this,e,t)}},{key:"addToDragSelection",value:function addToDragSelection(){for(var e=this,t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];forEach(n,(function(t){return e.dragSelection.add(t)}))}},{key:"clearDragSelection",value:function clearDragSelection(){this.dragSelection.clear()}},{key:"removeFromDragSelection",value:function removeFromDragSelection(){for(var e=this,t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];forEach(n,(function(t){return e.dragSelection.remove(t)}))}},{key:"toggleDragSelection",value:function toggleDragSelection(){for(var e=this,t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];forEach(n,(function(t){return e.dragSelection.toggle(t)}))}},{key:"addToDragGroup",value:function addToDragGroup(e){for(var t,n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];(t=this.elementDragHandler).addToDragGroup.apply(t,[e].concat(i))}},{key:"removeFromDragGroup",value:function removeFromDragGroup(){var e;(e=this.elementDragHandler).removeFromDragGroup.apply(e,arguments)}},{key:"setDragGroupState",value:function setDragGroupState(e){for(var t,n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];(t=this.elementDragHandler).setDragGroupState.apply(t,[e].concat(i))}},{key:"clearDragGroup",value:function clearDragGroup(e){this.elementDragHandler.clearDragGroup(e)}},{key:"consume",value:function consume$1(e,t){consume(e,t)}},{key:"rotate",value:function rotate(e,t,n){var i=this.getId(e);return this._managedElements[i]?(this._managedElements[i].el.style.transform="rotate("+t+"deg)",this._managedElements[i].el.style.transformOrigin="center center",_get(_getPrototypeOf(BrowserJsPlumbInstance.prototype),"rotate",this).call(this,e,t,n)):{c:new Set,e:new Set}}},{key:"addOverlayClass",value:function addOverlayClass(e,t){if(isLabelOverlay(e))e.instance.addClass(getLabelElement(e),t);else if(isSVGElementOverlay(e))e.instance.addClass(ensureSVGOverlayPath(e),t);else{if(!isCustomOverlay(e))throw"Could not add class to overlay of type ["+e.type+"]";e.instance.addClass(getCustomElement(e),t)}}},{key:"removeOverlayClass",value:function removeOverlayClass(e,t){if(isLabelOverlay(e))e.instance.removeClass(getLabelElement(e),t);else if(isSVGElementOverlay(e))e.instance.removeClass(ensureSVGOverlayPath(e),t);else{if(!isCustomOverlay(e))throw"Could not remove class from overlay of type ["+e.type+"]";e.instance.removeClass(getCustomElement(e),t)}}},{key:"_paintOverlay",value:function _paintOverlay(e,t,n){if(isLabelOverlay(e)){getLabelElement(e);var i=e.component.getXY();e.canvas.style.left=i.x+t.d.minx+"px",e.canvas.style.top=i.y+t.d.miny+"px"}else if(isSVGElementOverlay(e)){!function paintSVGOverlay(e,t,n,i){ensureSVGOverlayPath(e);var r=[0,0];i.xmin<0&&(r[0]=-i.xmin),i.ymin<0&&(r[1]=-i.ymin);var o={d:t,stroke:n.stroke?n.stroke:null,fill:n.fill?n.fill:null,transform:"translate("+r[0]+","+r[1]+")","pointer-events":"visibleStroke"};_attr(e.path,o)}(e,isNaN(t.d.cxy.x)||isNaN(t.d.cxy.y)?"M 0 0":"M"+t.d.hxy.x+","+t.d.hxy.y+" L"+t.d.tail[0].x+","+t.d.tail[0].y+" L"+t.d.cxy.x+","+t.d.cxy.y+" L"+t.d.tail[1].x+","+t.d.tail[1].y+" Z",t,n)}else{if(!isCustomOverlay(e))throw"Could not paint overlay of type ["+e.type+"]";getCustomElement(e);var r=e.component.getXY();e.canvas.style.left=r.x+t.d.minx+"px",e.canvas.style.top=r.y+t.d.miny+"px"}}},{key:"setOverlayVisible",value:function setOverlayVisible(e,t){var n=t?"block":"none";function s(e){null!=e&&(e.style.display=n)}isLabelOverlay(e)?s(getLabelElement(e)):isCustomOverlay(e)?s(getCustomElement(e)):isSVGElementOverlay(e)&&s(e.path)}},{key:"reattachOverlay",value:function reattachOverlay(e,t){isLabelOverlay(e)?e.instance._appendElement(getLabelElement(e),this.getContainer()):isCustomOverlay(e)?e.instance._appendElement(getCustomElement(e),this.getContainer()):isSVGElementOverlay(e)&&this._appendElement(ensureSVGOverlayPath(e),t.connector.canvas)}},{key:"setOverlayHover",value:function setOverlayHover(e,t){var n;isLabelOverlay(e)?n=getLabelElement(e):isCustomOverlay(e)?n=getCustomElement(e):isSVGElementOverlay(e)&&(n=ensureSVGOverlayPath(e)),null!=n&&(null!=this.hoverClass&&(t?this.addClass(n,this.hoverClass):this.removeClass(n,this.hoverClass)),this.setHover(e.component,t))}},{key:"destroyOverlay",value:function destroyOverlay(e){if(isLabelOverlay(e)){var t=getLabelElement(e);t.parentNode.removeChild(t),delete e.canvas,delete e.cachedDimensions}else if(isArrowOverlay(e)||isDiamondOverlay(e)||isPlainArrowOverlay(e))!function destroySVGOverlay(e,t){var n=e;null!=n.path&&null!=n.path.parentNode&&n.path.parentNode.removeChild(n.path),null!=n.bgPath&&null!=n.bgPath.parentNode&&n.bgPath.parentNode.removeChild(n.bgPath),delete n.path,delete n.bgPath}(e);else if(isCustomOverlay(e)){var n=getCustomElement(e);n.parentNode.removeChild(n),delete e.canvas,delete e.cachedDimensions}}},{key:"drawOverlay",value:function drawOverlay(e,t,n,i){if(isLabelOverlay(e)||isCustomOverlay(e)){var r=Ci._getDimensions(e);if(null!=r&&null!=r.w&&null!=r.h){var o={x:0,y:0};if(i)o={x:i.x,y:i.y};else if(t instanceof qn){var a=Array.isArray(e.location)?e.location:[e.location,e.location];o={x:a[0]*t.w,y:a[1]*t.h}}else{var l=e.location,u=!1;(isString(e.location)||e.location<0||e.location>1)&&(l=parseInt(""+e.location,10),u=!0),o=t.pointOnPath(l,u)}var h=o.x-r.w/2,d=o.y-r.h/2;return{component:e,d:{minx:h,miny:d,td:r,cxy:o},xmin:h,xmax:h+r.w,ymin:d,ymax:d+r.h}}return{xmin:0,xmax:0,ymin:0,ymax:0}}if(isArrowOverlay(e)||isDiamondOverlay(e)||isPlainArrowOverlay(e))return e.draw(t,n,i);throw"Could not draw overlay of type ["+e.type+"]"}},{key:"updateLabel",value:function updateLabel(e){if(isFunction(e.label)){var t=e.label(this);getLabelElement(e).innerText=null!=t?t:""}else null==e.labelText&&(e.labelText=e.label,null!=e.labelText?getLabelElement(e).innerText=e.labelText:getLabelElement(e).innerText="")}},{key:"setHover",value:function setHover(e,t){e._hover=t,e instanceof Gi&&null!=e.endpoint?this.setEndpointHover(e,t,-1):e instanceof zi&&null!=e.connector&&this.setConnectorHover(e.connector,t)}},{key:"paintConnector",value:function paintConnector(e,t,n){paintSvgConnector(this,e,t,n)}},{key:"setConnectorHover",value:function setConnectorHover(e,t,n){if(!1===t||!this.currentlyDragging&&!this.isHoverSuspended()){var i=e.canvas;null!=i&&(null!=e.hoverClass&&(t?this.addClass(i,e.hoverClass):this.removeClass(i,e.hoverClass)),t?this.addClass(i,this.hoverClass):this.removeClass(i,this.hoverClass)),null!=e.connection.hoverPaintStyle&&(e.connection.paintStyleInUse=t?e.connection.hoverPaintStyle:e.connection.paintStyle,this._suspendDrawing||this._paintConnection(e.connection)),e.connection.endpoints[0]!==n&&this.setEndpointHover(e.connection.endpoints[0],t,0,!0),e.connection.endpoints[1]!==n&&this.setEndpointHover(e.connection.endpoints[1],t,1,!0)}}},{key:"destroyConnector",value:function destroyConnector(e){null!=e.connector&&cleanup(e.connector)}},{key:"addConnectorClass",value:function addConnectorClass(e,t){e.canvas&&this.addClass(e.canvas,t)}},{key:"removeConnectorClass",value:function removeConnectorClass(e,t){e.canvas&&this.removeClass(e.canvas,t)}},{key:"getConnectorClass",value:function getConnectorClass(e){return e.canvas?e.canvas.className.baseVal:""}},{key:"setConnectorVisible",value:function setConnectorVisible(e,t){setVisible(e,t)}},{key:"applyConnectorType",value:function applyConnectorType(e,t){if(e.canvas&&t.cssClass){var n=Array.isArray(t.cssClass)?t.cssClass:[t.cssClass];this.addClass(e.canvas,n.join(" "))}}},{key:"addEndpointClass",value:function addEndpointClass(e,t){var n=getEndpointCanvas(e.endpoint);null!=n&&this.addClass(n,t)}},{key:"applyEndpointType",value:function applyEndpointType(e,t){if(t.cssClass){var n=getEndpointCanvas(e.endpoint);if(n){var i=Array.isArray(t.cssClass)?t.cssClass:[t.cssClass];this.addClass(n,i.join(" "))}}}},{key:"destroyEndpoint",value:function destroyEndpoint(e){var t=this.endpointAnchorClassPrefix+(e.currentAnchorClass?"-"+e.currentAnchorClass:"");this.removeClass(e.element,t),cleanup(e.endpoint)}},{key:"renderEndpoint",value:function renderEndpoint(e,t){var n=yr[e.endpoint.type];null!=n?Ri.paint(e.endpoint,n,t):log("jsPlumb: no endpoint renderer found for type ["+e.endpoint.type+"]")}},{key:"removeEndpointClass",value:function removeEndpointClass(e,t){var n=getEndpointCanvas(e.endpoint);null!=n&&this.removeClass(n,t)}},{key:"getEndpointClass",value:function getEndpointClass(e){var t=getEndpointCanvas(e.endpoint);return null!=t?t.className:""}},{key:"setEndpointHover",value:function setEndpointHover(e,t,n,i){if(null!=e&&(!1===t||!this.currentlyDragging&&!this.isHoverSuspended())){var r=getEndpointCanvas(e.endpoint);if(null!=r&&(null!=e.hoverClass&&(t?this.addClass(r,e.hoverClass):this.removeClass(r,e.hoverClass)),0===n||1===n)){var o=0===n?this.hoverSourceClass:this.hoverTargetClass;t?this.addClass(r,o):this.removeClass(r,o)}if(null!=e.hoverPaintStyle&&(e.paintStyleInUse=t?e.hoverPaintStyle:e.paintStyle,this._suspendDrawing||this.renderEndpoint(e,e.paintStyleInUse)),!i)for(var a=0;a<e.connections.length;a++)this.setConnectorHover(e.connections[a].connector,t,e)}}},{key:"setEndpointVisible",value:function setEndpointVisible(e,t){setVisible(e.endpoint,t)}},{key:"setGroupVisible",value:function setGroupVisible(e,t){for(var n=e.el.querySelectorAll(ce),i=0;i<n.length;i++)t?this.show(n[i],!0):this.hide(n[i],!0)}},{key:"deleteConnection",value:function deleteConnection(e,t){return null!=e&&!0!==e.deleted&&(!0!==e.endpoints[0].deleted&&this.setEndpointHover(e.endpoints[0],!1,0,!0),!0!==e.endpoints[1].deleted&&this.setEndpointHover(e.endpoints[1],!1,1,!0),_get(_getPrototypeOf(BrowserJsPlumbInstance.prototype),"deleteConnection",this).call(this,e,t))}},{key:"addSourceSelector",value:function addSourceSelector(e,t,n){return this.addDragFilter(e),_get(_getPrototypeOf(BrowserJsPlumbInstance.prototype),"addSourceSelector",this).call(this,e,t,n)}},{key:"removeSourceSelector",value:function removeSourceSelector(e){this.removeDragFilter(e.selector),_get(_getPrototypeOf(BrowserJsPlumbInstance.prototype),"removeSourceSelector",this).call(this,e)}},{key:"manage",value:function manage(t,n,i){if(this.containerType===e.ElementTypes.SVG&&!isSVGElement(t))throw new Error("ERROR: cannot manage non-svg element when container is an SVG element.");var r=_get(_getPrototypeOf(BrowserJsPlumbInstance.prototype),"manage",this).call(this,t,n,i);return null!=r&&null!=this._resizeObserver&&this._resizeObserver.observe(r.el),r}}]),BrowserJsPlumbInstance}(fr),gr=function(e){_inherits(RectangleEndpoint,e);var t=_createSuper(RectangleEndpoint);function RectangleEndpoint(e,n){var i;return _classCallCheck(this,RectangleEndpoint),_defineProperty(_assertThisInitialized(i=t.call(this,e,n)),"width",void 0),_defineProperty(_assertThisInitialized(i),"height",void 0),_defineProperty(_assertThisInitialized(i),"type",RectangleEndpoint.type),n=n||{},i.width=n.width||10,i.height=n.height||10,i}return _createClass(RectangleEndpoint,null,[{key:"_getParams",value:function _getParams(e){return{width:e.width,height:e.height}}}]),RectangleEndpoint}(qn);_defineProperty(gr,"type","Rectangle");var _r={type:gr.type,cls:gr,compute:function compute(e,t,n,i){var r=i.width||e.width,o=i.height||e.height,a=t.curX-r/2,l=t.curY-o/2;return e.x=a,e.y=l,e.w=r,e.h=o,[a,l,r,o]},getParams:function getParams(e){return{width:e.width,height:e.height}}},mr=function(e){_inherits(BlankEndpoint,e);var t=_createSuper(BlankEndpoint);function BlankEndpoint(e,n){var i;return _classCallCheck(this,BlankEndpoint),_defineProperty(_assertThisInitialized(i=t.call(this,e,n)),"type",BlankEndpoint.type),i}return BlankEndpoint}(qn);_defineProperty(mr,"type","Blank");var Er,Pr={type:mr.type,cls:mr,compute:function compute(e,t,n,i){return e.x=t.curX,e.y=t.curY,e.w=10,e.h=0,[t.curX,t.curY,10,0]},getParams:function getParams(e){return{}}},Cr={width:10,height:0,fill:"transparent",stroke:"transparent"};!function register(){registerEndpointRenderer(Ji.type,{makeNode:function makeNode(e,t){return _node("circle",{cx:e.w/2,cy:e.h/2,r:e.radius})},updateNode:function updateNode(e,t){_attr(t,{cx:""+e.w/2,cy:""+e.h/2,r:""+e.radius})}})}(),function register(){registerEndpointRenderer(mr.type,{makeNode:function makeNode(e,t){return _node("rect",Cr)},updateNode:function updateNode(e,t){_attr(t,Cr)}})}(),function register(){registerEndpointRenderer(gr.type,{makeNode:function makeNode(e,t){return _node("rect",{width:e.w,height:e.h})},updateNode:function updateNode(e,t){_attr(t,{width:e.w,height:e.h})}})}(),e.SupportedEdge=void 0,(Er=e.SupportedEdge||(e.SupportedEdge={}))[Er.top=0]="top",Er[Er.bottom=1]="bottom";var xr=new Map;xr.set(e.SupportedEdge.top,[e.AnchorLocations.TopRight,e.AnchorLocations.TopLeft]),xr.set(e.SupportedEdge.bottom,[e.AnchorLocations.BottomRight,e.AnchorLocations.BottomLeft]);var Tr={deriveAnchor:function deriveAnchor(e,t,n,i){return xr.get(e)[t]}},br="jtk-scrollable-list",Sr=att(br),kr="scroll",Ir=function(){function JsPlumbListManager(e,t){var n=this;_classCallCheck(this,JsPlumbListManager),this.instance=e,_defineProperty(this,"options",void 0),_defineProperty(this,"count",void 0),_defineProperty(this,"lists",void 0),this.count=0,this.lists={},this.options=t||{},this.instance.bind(X,(function(e){for(var t=n.instance.getSelector(e.el,Sr),i=0;i<t.length;i++)n.addList(t[i])})),this.instance.bind(ne,(function(e){n.removeList(e.el)})),this.instance.bind(z,(function(e,t){if(null==t){var i=n.findParentList(e.target);null!=i&&i.newConnection(e.connection,e.target,1);var r=n.findParentList(e.source);null!=r&&r.newConnection(e.connection,e.source,0)}})),this.instance.bind(se,(function(e){var t=e.dropEndpoint.element,i=n.findParentList(t);return null==i||t.offsetTop>=i.domElement.scrollTop&&t.offsetTop+t.offsetHeight<=i.domElement.scrollTop+i.domElement.offsetHeight}))}return _createClass(JsPlumbListManager,[{key:"addList",value:function addList(e,t){var n=extend({},Tr);extend(n,this.options),t=extend(n,t||{});var i=[this.instance._instanceIndex,this.count++].join("_");return this.lists[i]=new Ar(this.instance,e,t,i),this.lists[i]}},{key:"getList",value:function getList(e){var t=this.instance.getAttribute(e,br);if(null!=t)return this.lists[t]}},{key:"removeList",value:function removeList(e){var t=this.getList(e);t&&(t.destroy(),delete this.lists[t.id])}},{key:"findParentList",value:function findParentList(e){for(var t,n=e.parentNode,i=this.instance.getContainer();null!=n&&n!==i&&n!==document;){if(null!=(t=this.getList(n)))return t;n=n.parentNode}}}]),JsPlumbListManager}(),Ar=function(){function JsPlumbList(e,t,n,i){_classCallCheck(this,JsPlumbList),this.instance=e,this.el=t,this.options=n,this.id=i,_defineProperty(this,"_scrollHandler",void 0),_defineProperty(this,"domElement",void 0),_defineProperty(this,"elId",void 0),this.domElement=t,this.elId=this.instance.getId(t),e.setAttribute(t,br,i),this._scrollHandler=this.scrollHandler.bind(this),this.domElement._jsPlumbScrollHandler=this._scrollHandler,e.on(t,kr,this._scrollHandler),this._scrollHandler()}return _createClass(JsPlumbList,[{key:"deriveAnchor",value:function deriveAnchor(e,t,n,i){return this.options.anchor?this.options.anchor:this.options.deriveAnchor(e,t,n,i)}},{key:"deriveEndpoint",value:function deriveEndpoint(e,t,n,i){return this.options.deriveEndpoint?this.options.deriveEndpoint(e,t,n,i):this.options.endpoint?this.options.endpoint:n.endpoint.type}},{key:"newConnection",value:function newConnection(t,n,i){n.offsetTop<this.el.scrollTop?this._proxyConnection(n,t,i,e.SupportedEdge.top):n.offsetTop+n.offsetHeight>this.el.scrollTop+this.domElement.offsetHeight&&this._proxyConnection(n,t,i,e.SupportedEdge.bottom)}},{key:"scrollHandler",value:function scrollHandler(){for(var t=this,n=this.instance.getSelector(this.el,ce),i=function _loop(i){if(n[i].offsetTop<t.el.scrollTop)n[i]._jsPlumbProxies=n[i]._jsPlumbProxies||[],t.instance.select({source:n[i]}).each((function(r){t._proxyConnection(n[i],r,0,e.SupportedEdge.top)})),t.instance.select({target:n[i]}).each((function(r){t._proxyConnection(n[i],r,1,e.SupportedEdge.top)}));else if(n[i].offsetTop+n[i].offsetHeight>t.el.scrollTop+t.domElement.offsetHeight)n[i]._jsPlumbProxies=n[i]._jsPlumbProxies||[],t.instance.select({source:n[i]}).each((function(r){t._proxyConnection(n[i],r,0,e.SupportedEdge.bottom)})),t.instance.select({target:n[i]}).each((function(r){t._proxyConnection(n[i],r,1,e.SupportedEdge.bottom)}));else if(n[i]._jsPlumbProxies){for(var r=0;r<n[i]._jsPlumbProxies.length;r++)t.instance.unproxyConnection(n[i]._jsPlumbProxies[r][0],n[i]._jsPlumbProxies[r][1]);delete n[i]._jsPlumbProxies}t.instance.revalidate(n[i])},r=0;r<n.length;r++)i(r)}},{key:"_proxyConnection",value:function _proxyConnection(e,t,n,i){var r=this;this.instance.proxyConnection(t,n,this.domElement,(function(e,n){return r.deriveEndpoint(i,n,t.endpoints[n],t)}),(function(e,n){return r.deriveAnchor(i,n,t.endpoints[n],t)})),e._jsPlumbProxies=e._jsPlumbProxies||[],e._jsPlumbProxies.push([t,n])}},{key:"destroy",value:function destroy(){this.instance.off(this.el,kr,this._scrollHandler),delete this.domElement._jsPlumbScrollHandler;for(var e=this.instance.getSelector(this.el,ce),t=0;t<e.length;t++)if(e[t]._jsPlumbProxies){for(var n=0;n<e[t]._jsPlumbProxies.length;n++)this.instance.unproxyConnection(e[t]._jsPlumbProxies[n][0],e[t]._jsPlumbProxies[n][1]);delete e[t]._jsPlumbProxies}}}]),JsPlumbList}();function gentleRound(e){var t=Math.floor(e),n=Math.ceil(e);return e-t<1e-10?t:n-e<1e-10?n:e}var Or=function(e){_inherits(ArcSegment,e);var t=_createSuper(ArcSegment);function ArcSegment(e){var n;_classCallCheck(this,ArcSegment),_defineProperty(_assertThisInitialized(n=t.call(this,e)),"type",ArcSegment.segmentType),_defineProperty(_assertThisInitialized(n),"cx",void 0),_defineProperty(_assertThisInitialized(n),"cy",void 0),_defineProperty(_assertThisInitialized(n),"radius",void 0),_defineProperty(_assertThisInitialized(n),"anticlockwise",void 0),_defineProperty(_assertThisInitialized(n),"startAngle",void 0),_defineProperty(_assertThisInitialized(n),"endAngle",void 0),_defineProperty(_assertThisInitialized(n),"sweep",void 0),_defineProperty(_assertThisInitialized(n),"length",void 0),_defineProperty(_assertThisInitialized(n),"circumference",void 0),_defineProperty(_assertThisInitialized(n),"frac",void 0),n.cx=e.cx,n.cy=e.cy,n.radius=e.r,n.anticlockwise=e.ac,e.startAngle&&e.endAngle?(n.startAngle=e.startAngle,n.endAngle=e.endAngle,n.x1=n.cx+n.radius*Math.cos(n.startAngle),n.y1=n.cy+n.radius*Math.sin(n.startAngle),n.x2=n.cx+n.radius*Math.cos(n.endAngle),n.y2=n.cy+n.radius*Math.sin(n.endAngle)):(n.startAngle=n._calcAngle(n.x1,n.y1),n.endAngle=n._calcAngle(n.x2,n.y2)),n.endAngle<0&&(n.endAngle+=en),n.startAngle<0&&(n.startAngle+=en);var i=n.endAngle<n.startAngle?n.endAngle+en:n.endAngle;return n.sweep=Math.abs(i-n.startAngle),n.anticlockwise&&(n.sweep=en-n.sweep),n.circumference=2*Math.PI*n.radius,n.frac=n.sweep/en,n.length=n.circumference*n.frac,n.extents={xmin:n.cx-n.radius,xmax:n.cx+n.radius,ymin:n.cy-n.radius,ymax:n.cy+n.radius},n}return _createClass(ArcSegment,[{key:"_calcAngle",value:function _calcAngle(e,t){return theta({x:this.cx,y:this.cy},{x:e,y:t})}},{key:"_calcAngleForLocation",value:function _calcAngleForLocation(e,t){if(e.anticlockwise){var n=e.startAngle<e.endAngle?e.startAngle+en:e.startAngle;return n-Math.abs(n-e.endAngle)*t}var i=e.endAngle<e.startAngle?e.endAngle+en:e.endAngle,r=Math.abs(i-e.startAngle);return e.startAngle+r*t}},{key:"getPath",value:function getPath(e){var t=this.sweep>Math.PI?1:0,n=this.anticlockwise?0:1;return(e?"M"+this.x1+" "+this.y1+" ":"")+"A "+this.radius+" "+this.radius+" 0 "+t+","+n+" "+this.x2+" "+this.y2}},{key:"getLength",value:function getLength(){return this.length}},{key:"pointOnPath",value:function pointOnPath(e,t){if(0===e)return{x:this.x1,y:this.y1,theta:this.startAngle};if(1===e)return{x:this.x2,y:this.y2,theta:this.endAngle};t&&(e/=length);var n=this._calcAngleForLocation(this,e),i=this.cx+this.radius*Math.cos(n),r=this.cy+this.radius*Math.sin(n);return{x:gentleRound(i),y:gentleRound(r),theta:n}}},{key:"gradientAtPoint",value:function gradientAtPoint(e,t){var n=this.pointOnPath(e,t),i=normal({x:this.cx,y:this.cy},n);return this.anticlockwise||i!==1/0&&i!==-1/0||(i*=-1),i}},{key:"pointAlongPathFrom",value:function pointAlongPathFrom(e,t,n){var i=this.pointOnPath(e,n),r=t/this.circumference*2*Math.PI,o=this.anticlockwise?-1:1,a=i.theta+o*r;return{x:this.cx+this.radius*Math.cos(a),y:this.cy+this.radius*Math.sin(a)}}}]),ArcSegment}(jt);_defineProperty(Or,"segmentType","Arc");var Dr=function(e){_inherits(AbstractBezierConnector,e);var t=_createSuper(AbstractBezierConnector);function AbstractBezierConnector(e,n){var i;return _classCallCheck(this,AbstractBezierConnector),(i=t.call(this,e,n)).connection=e,_defineProperty(_assertThisInitialized(i),"showLoopback",void 0),_defineProperty(_assertThisInitialized(i),"curviness",void 0),_defineProperty(_assertThisInitialized(i),"margin",void 0),_defineProperty(_assertThisInitialized(i),"proximityLimit",void 0),_defineProperty(_assertThisInitialized(i),"orientation",void 0),_defineProperty(_assertThisInitialized(i),"loopbackRadius",void 0),_defineProperty(_assertThisInitialized(i),"clockwise",void 0),_defineProperty(_assertThisInitialized(i),"isLoopbackCurrently",void 0),_defineProperty(_assertThisInitialized(i),"geometry",null),n=n||{},i.showLoopback=!1!==n.showLoopback,i.curviness=n.curviness||10,i.margin=n.margin||5,i.proximityLimit=n.proximityLimit||80,i.clockwise=n.orientation&&"clockwise"===n.orientation,i.loopbackRadius=n.loopbackRadius||25,i.isLoopbackCurrently=!1,i}return _createClass(AbstractBezierConnector,[{key:"getDefaultStubs",value:function getDefaultStubs(){return[0,0]}},{key:"_compute",value:function _compute(e,t){var n=t.sourcePos,i=t.targetPos,r=Math.abs(n.curX-i.curX),o=Math.abs(n.curY-i.curY);if(this.showLoopback&&t.sourceEndpoint.elementId===t.targetEndpoint.elementId){this.isLoopbackCurrently=!0;var a=t.sourcePos.curX,l=t.sourcePos.curY-this.margin,u=a,h=l-this.loopbackRadius,d=u-this.loopbackRadius,p=h-this.loopbackRadius;r=2*this.loopbackRadius,o=2*this.loopbackRadius,e.points[0]=d,e.points[1]=p,e.points[2]=r,e.points[3]=o,this._addSegment(Or,{loopback:!0,x1:a-d+4,y1:l-p,startAngle:0,endAngle:2*Math.PI,r:this.loopbackRadius,ac:!this.clockwise,x2:a-d-4,y2:l-p,cx:u-d,cy:h-p})}else this.isLoopbackCurrently=!1,this._computeBezier(e,t,n,i,r,o)}},{key:"exportGeometry",value:function exportGeometry(){return null==this.geometry?null:{controlPoints:[extend({},this.geometry.controlPoints[0]),extend({},this.geometry.controlPoints[1])],source:extend({},this.geometry.source),target:extend({},this.geometry.target)}}},{key:"transformGeometry",value:function transformGeometry(e,t,n){return{controlPoints:[{x:e.controlPoints[0].x+t,y:e.controlPoints[0].y+n},{x:e.controlPoints[1].x+t,y:e.controlPoints[1].y+n}],source:this.transformAnchorPlacement(e.source,t,n),target:this.transformAnchorPlacement(e.target,t,n)}}},{key:"importGeometry",value:function importGeometry(e){return null!=e&&(null==e.controlPoints||2!=e.controlPoints.length?(log("jsPlumb Bezier: cannot import geometry; controlPoints missing or does not have length 2"),this.setGeometry(null,!0),!1):null==e.controlPoints[0].x||null==e.controlPoints[0].y||null==e.controlPoints[1].x||null==e.controlPoints[1].y?(log("jsPlumb Bezier: cannot import geometry; controlPoints malformed"),this.setGeometry(null,!0),!1):null==e.source||null==e.source.curX||null==e.source.curY?(log("jsPlumb Bezier: cannot import geometry; source missing or malformed"),this.setGeometry(null,!0),!1):null==e.target||null==e.target.curX||null==e.target.curY?(log("jsPlumb Bezier: cannot import geometry; target missing or malformed"),this.setGeometry(null,!0),!1):(this.setGeometry(e,!1),!0))}}]),AbstractBezierConnector}(Bi),wr=function subtract(e,t){return{x:e.x-t.x,y:e.y-t.y}},Mr=function dotProduct(e,t){return e.x*t.x+e.y*t.y},Lr=function square(e){return Math.sqrt(e.x*e.x+e.y*e.y)},Gr=function scale(e,t){return{x:e.x*t,y:e.y*t}},jr=Math.pow(2,-65);function distanceFromCurve(e,t){for(var n,i=[],r=function _convertToBezier(e,t){for(var n=t.length-1,i=2*n-1,r=[],o=[],a=[],l=[],u=[[1,.6,.3,.1],[.4,.6,.6,.4],[.1,.3,.6,1]],h=0;h<=n;h++)r[h]=wr(t[h],e);for(var d=0;d<=n-1;d++)o[d]=wr(t[d+1],t[d]),o[d]=Gr(o[d],3);for(var p=0;p<=n-1;p++)for(var v=0;v<=n;v++)a[p]||(a[p]=[]),a[p][v]=Mr(o[p],r[v]);for(var g=0;g<=i;g++)l[g]||(l[g]=[]),l[g].y=0,l[g].x=parseFloat(""+g)/i;for(var _=n,m=n-1,E=0;E<=_+m;E++)for(var P=Math.max(0,E-m),C=Math.min(E,_),T=P;T<=C;T++){var b=E-T;l[T+b].y+=a[b][T]*u[b][T]}return l}(e,t),o=t.length-1,a=_findRoots(r,2*o-1,i,0),l=wr(e,t[0]),u=Lr(l),h=0,d=0;d<a;d++)l=wr(e,_bezier(t,o,i[d],null,null)),(n=Lr(l))<u&&(u=n,h=i[d]);return l=wr(e,t[o]),(n=Lr(l))<u&&(u=n,h=1),{location:h,distance:u}}function nearestPointOnCurve(e,t){var n=distanceFromCurve(e,t);return{point:_bezier(t,t.length-1,n.location,null,null),location:n.location}}function _findRoots(e,t,n,i){var r,o,a=[],l=[],u=[],h=[];switch(function _getCrossingCount(e,t){var n,i,r=0;n=i=sgn$1(e[0].y);for(var o=1;o<=t;o++)(n=sgn$1(e[o].y))!=i&&r++,i=n;return r}(e,t)){case 0:return 0;case 1:if(i>=64)return n[0]=(e[0].x+e[t].x)/2,1;if(function _isFlatEnough(e,t){var n,i,r,o,a,l,u,h,d,p,v,g,_;a=e[0].y-e[t].y,l=e[t].x-e[0].x,u=e[0].x*e[t].y-e[t].x*e[0].y,g=_=0;for(var m=1;m<t;m++){var E=a*e[m].x+l*e[m].y+u;E>g?g=E:E<_&&(_=E)}return n=((d=1)*(u-g)-(v=l)*(p=0))*(1/((h=0)*v-a*d)),i=(d*(u-_)-(v=l)*p)*(1/(h*v-a*d)),r=Math.min(n,i),o=Math.max(n,i),o-r<jr?1:0}(e,t))return n[0]=function _computeXIntercept(e,t){var n=1,i=0,r=e[t].x-e[0].x,o=e[t].y-e[0].y,a=e[0].x-0,l=e[0].y-0;return 0+n*(1/(r*i-o*n)*(r*l-o*a))}(e,t),1}_bezier(e,t,.5,a,l),r=_findRoots(a,t,u,i+1),o=_findRoots(l,t,h,i+1);for(var d=0;d<r;d++)n[d]=u[d];for(var p=0;p<o;p++)n[p+r]=h[p];return r+o}function _bezier(e,t,n,i,r){for(var o=[[]],a=0;a<=t;a++)o[0][a]=e[a];for(var l=1;l<=t;l++)for(var u=0;u<=t-l;u++)o[l]||(o[l]=[]),o[l][u]||(o[l][u]={}),o[l][u].x=(1-n)*o[l-1][u].x+n*o[l-1][u+1].x,o[l][u].y=(1-n)*o[l-1][u].y+n*o[l-1][u+1].y;if(null!=i)for(var h=0;h<=t;h++)i[h]=o[h][0];if(null!=r)for(var d=0;d<=t;d++)r[d]=o[t-d][d];return o[t][0]}function _computeLookup(e,t){var n={x:0,y:0};if(0===e)return t[0];var i=t.length-1;if(1===e)return t[i];var r=t,o=1-e;if(0===i)return t[0];if(1===i)return{x:o*r[0].x+e*r[1].x,y:o*r[0].y+e*r[1].y};if(4>i){var a,l,u,h=o*o,d=e*e,p=0;return 2===i?(r=[r[0],r[1],r[2],n],a=h,l=o*e*2,u=d):3===i&&(a=h*o,l=h*e*3,u=o*d*3,p=e*d),{x:a*r[0].x+l*r[1].x+u*r[2].x+p*r[3].x,y:a*r[0].y+l*r[1].y+u*r[2].y+p*r[3].y}}return n}function computeBezierLength(e){var t=0;if(!isPoint(e))for(var n=function _getLUT(e,t){var n=[];e--;for(var i=0;i<=e;i++)n.push(_computeLookup(i/e,t));return n}(16,e),i=0;i<15;i++){t+=dist(n[i],n[i+1])}return t}var Nr=new Map;function pointOnCurve(e,t){for(var n=function _getCurveFunctions(e){var t=Nr.get(e);if(!t){var n=function c_term(e){return function(t){return e}},i=function _termFunc(e){return function(t){for(var n=1,i=0;i<e.length;i++)n*=e[i](t);return n}};(t=[]).push(function f_term(){return function(t){return Math.pow(t,e)}}());for(var r=1;r<e;r++){for(var o=[n(e)],a=0;a<e-r;a++)o.push((function(e){return e}));for(var l=0;l<r;l++)o.push((function(e){return 1-e}));t.push(i(o))}t.push(function l_term(){return function(t){return Math.pow(1-t,e)}}()),Nr.set(e,t)}return t}(e.length-1),i=0,r=0,o=0;o<e.length;o++)i+=e[o].x*n[o](t),r+=e[o].y*n[o](t);return{x:i,y:r}}function dist(e,t){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}function isPoint(e){return e[0].x===e[1].x&&e[0].y===e[1].y}function pointAlongPath(e,t,n){if(isPoint(e))return{point:e[0],location:t};for(var i=pointOnCurve(e,t),r=0,o=t,a=n>0?1:-1,l=null;r<Math.abs(n);)r+=dist(l=pointOnCurve(e,o+=.005*a),i),i=l;return{point:l,location:o}}function pointAlongCurveFrom(e,t,n){return pointAlongPath(e,t,n).point}function locationAlongCurveFrom(e,t,n){return pointAlongPath(e,t,n).location}function gradientAtPoint(e,t){var n=pointOnCurve(e,t),i=pointOnCurve(e.slice(0,e.length-1),t),r=i.y-n.y,o=i.x-n.x;return 0===r?1/0:Math.atan(r/o)}function bezierLineIntersection(e,t,n,i,r){var o=i-t,a=e-n,l=e*(t-i)+t*(n-e),u=function _computeCoefficients(e){return[_computeCoefficientsForAxis(e,"x"),_computeCoefficientsForAxis(e,"y")]}(r),h=[o*u[0][0]+a*u[1][0],o*u[0][1]+a*u[1][1],o*u[0][2]+a*u[1][2],o*u[0][3]+a*u[1][3]+l],d=_cubicRoots.apply(null,h),p=[];if(null!=d)for(var v=0;v<3;v++){var g=d[v],_=Math.pow(g,2),m=Math.pow(g,3),E={x:u[0][0]*m+u[0][1]*_+u[0][2]*g+u[0][3],y:u[1][0]*m+u[1][1]*_+u[1][2]*g+u[1][3]},P=void 0;P=n-e!=0?(E[0]-e)/(n-e):(E[1]-t)/(i-t),g>=0&&g<=1&&P>=0&&P<=1&&p.push(E)}return p}function _computeCoefficientsForAxis(e,t){return[-e[0][t]+3*e[1][t]+-3*e[2][t]+e[3][t],3*e[0][t]-6*e[1][t]+3*e[2][t],-3*e[0][t]+3*e[1][t],e[0][t]]}function _cubicRoots(e,t,n,i){var r,o,a=t/e,l=n/e,u=i/e,h=(3*l-Math.pow(a,2))/9,d=(9*a*l-27*u-2*Math.pow(a,3))/54,p=Math.pow(h,3)+Math.pow(d,2),v=[0,0,0];if(p>=0)r=sgn$1(d+Math.sqrt(p))*Math.pow(Math.abs(d+Math.sqrt(p)),1/3),o=sgn$1(d-Math.sqrt(p))*Math.pow(Math.abs(d-Math.sqrt(p)),1/3),v[0]=-a/3+(r+o),v[1]=-a/3-(r+o)/2,v[2]=-a/3-(r+o)/2,0!==Math.abs(Math.sqrt(3)*(r-o)/2)&&(v[1]=-1,v[2]=-1);else{var g=Math.acos(d/Math.sqrt(-Math.pow(h,3)));v[0]=2*Math.sqrt(-h)*Math.cos(g/3)-a/3,v[1]=2*Math.sqrt(-h)*Math.cos((g+2*Math.PI)/3)-a/3,v[2]=2*Math.sqrt(-h)*Math.cos((g+4*Math.PI)/3)-a/3}for(var _=0;_<3;_++)(v[_]<0||v[_]>1)&&(v[_]=-1);return v}var zr=function(e){_inherits(BezierSegment,e);var t=_createSuper(BezierSegment);function BezierSegment(e){var n;return _classCallCheck(this,BezierSegment),_defineProperty(_assertThisInitialized(n=t.call(this,e)),"curve",void 0),_defineProperty(_assertThisInitialized(n),"cp1x",void 0),_defineProperty(_assertThisInitialized(n),"cp1y",void 0),_defineProperty(_assertThisInitialized(n),"cp2x",void 0),_defineProperty(_assertThisInitialized(n),"cp2y",void 0),_defineProperty(_assertThisInitialized(n),"length",0),_defineProperty(_assertThisInitialized(n),"type",BezierSegment.segmentType),n.cp1x=e.cp1x,n.cp1y=e.cp1y,n.cp2x=e.cp2x,n.cp2y=e.cp2y,n.x1=e.x1,n.x2=e.x2,n.y1=e.y1,n.y2=e.y2,n.curve=[{x:n.x1,y:n.y1},{x:n.cp1x,y:n.cp1y},{x:n.cp2x,y:n.cp2y},{x:n.x2,y:n.y2}],n.extents={xmin:Math.min(n.x1,n.x2,n.cp1x,n.cp2x),ymin:Math.min(n.y1,n.y2,n.cp1y,n.cp2y),xmax:Math.max(n.x1,n.x2,n.cp1x,n.cp2x),ymax:Math.max(n.y1,n.y2,n.cp1y,n.cp2y)},n}return _createClass(BezierSegment,[{key:"getPath",value:function getPath(e){return(e?"M "+this.x2+" "+this.y2+" ":"")+"C "+this.cp2x+" "+this.cp2y+" "+this.cp1x+" "+this.cp1y+" "+this.x1+" "+this.y1}},{key:"pointOnPath",value:function pointOnPath(e,t){return e=BezierSegment._translateLocation(this.curve,e,t),pointOnCurve(this.curve,e)}},{key:"gradientAtPoint",value:function gradientAtPoint$1(e,t){return e=BezierSegment._translateLocation(this.curve,e,t),gradientAtPoint(this.curve,e)}},{key:"pointAlongPathFrom",value:function pointAlongPathFrom(e,t,n){return e=BezierSegment._translateLocation(this.curve,e,n),pointAlongCurveFrom(this.curve,e,t)}},{key:"getLength",value:function getLength(){return null!=this.length&&0!==this.length||(this.length=computeBezierLength(this.curve)),this.length}},{key:"findClosestPointOnPath",value:function findClosestPointOnPath(e,t){var n=nearestPointOnCurve({x:e,y:t},this.curve);return{d:Math.sqrt(Math.pow(n.point.x-e,2)+Math.pow(n.point.y-t,2)),x:n.point.x,y:n.point.y,l:1-n.location,s:this,x1:null,y1:null,x2:null,y2:null}}},{key:"lineIntersection",value:function lineIntersection(e,t,n,i){return bezierLineIntersection(e,t,n,i,this.curve)}}],[{key:"_translateLocation",value:function _translateLocation(e,t,n){return n&&(t=locationAlongCurveFrom(e,t>0?0:1,t)),t}}]),BezierSegment}(jt);_defineProperty(zr,"segmentType","Bezier");var Fr=function(e){_inherits(BezierConnector,e);var t=_createSuper(BezierConnector);function BezierConnector(e,n){var i;return _classCallCheck(this,BezierConnector),(i=t.call(this,e,n)).connection=e,_defineProperty(_assertThisInitialized(i),"type",BezierConnector.type),_defineProperty(_assertThisInitialized(i),"majorAnchor",void 0),_defineProperty(_assertThisInitialized(i),"minorAnchor",void 0),n=n||{},i.majorAnchor=n.curviness||150,i.minorAnchor=10,i}return _createClass(BezierConnector,[{key:"getCurviness",value:function getCurviness(){return this.majorAnchor}},{key:"_findControlPoint",value:function _findControlPoint(e,t,n,i,r){var o={x:0,y:0};return i[0]!==r[0]||i[1]===r[1]?(0===r[0]?o.x=n.curX<t.curX?e.x+this.minorAnchor:e.x-this.minorAnchor:o.x=e.x+this.majorAnchor*r[0],0===r[1]?o.y=n.curY<t.curY?e.y+this.minorAnchor:e.y-this.minorAnchor:o.y=e.y+this.majorAnchor*i[1]):(0===i[0]?o.x=t.curX<n.curX?e.x+this.minorAnchor:e.x-this.minorAnchor:o.x=e.x-this.majorAnchor*i[0],0===i[1]?o.y=t.curY<n.curY?e.y+this.minorAnchor:e.y-this.minorAnchor:o.y=e.y+this.majorAnchor*r[1]),o}},{key:"_computeBezier",value:function _computeBezier(e,t,n,i,r,o){var a,l,u=n.curX<i.curX?r:0,h=n.curY<i.curY?o:0,d=n.curX<i.curX?0:r,p=n.curY<i.curY?0:o;!0!==this.edited?(a=this._findControlPoint({x:u,y:h},n,i,e.so,e.to),l=this._findControlPoint({x:d,y:p},i,n,e.to,e.so)):(a=this.geometry.controlPoints[0],l=this.geometry.controlPoints[1]),this.geometry={controlPoints:[a,l],source:t.sourcePos,target:t.targetPos},this._addSegment(zr,{x1:u,y1:h,x2:d,y2:p,cp1x:a.x,cp1y:a.y,cp2x:l.x,cp2y:l.y})}}]),BezierConnector}(Dr);_defineProperty(Fr,"type","Bezier");var Rr=function(e){_inherits(StateMachineConnector,e);var t=_createSuper(StateMachineConnector);function StateMachineConnector(e,n){var i;return _classCallCheck(this,StateMachineConnector),(i=t.call(this,e,n)).connection=e,_defineProperty(_assertThisInitialized(i),"type",StateMachineConnector.type),_defineProperty(_assertThisInitialized(i),"_controlPoint",void 0),i.curviness=n.curviness||10,i.margin=n.margin||5,i.proximityLimit=n.proximityLimit||80,i.clockwise=n.orientation&&"clockwise"===n.orientation,i}return _createClass(StateMachineConnector,[{key:"_computeBezier",value:function _computeBezier(e,t,n,i,r,o){var a,l,u,h,d=n.curX<i.curX?0:r,p=n.curY<i.curY?0:o,v=n.curX<i.curX?r:0,g=n.curY<i.curY?o:0;if(0===n.x&&(d-=this.margin),1===n.x&&(d+=this.margin),0===n.y&&(p-=this.margin),1===n.y&&(p+=this.margin),0===i.x&&(v-=this.margin),1===i.x&&(v+=this.margin),0===i.y&&(g-=this.margin),1===i.y&&(g+=this.margin),!0!==this.edited){var _=(d+v)/2,m=(p+g)/2,E=function _segment(e,t,n,i){return e<=n&&i<=t?1:e<=n&&t<=i?2:n<=e&&i>=t?3:4}(d,p,v,g),P=Math.sqrt(Math.pow(v-d,2)+Math.pow(g-p,2));this._controlPoint=function _findControlPoint(e,t,n,i,r,o,a,l,u){return l<=u?{x:e,y:t}:1===n?i.curY<=0&&r.curY>=1?{x:e+(i.x<.5?-1*o:o),y:t}:i.curX>=1&&r.curX<=0?{x:e,y:t+(i.y<.5?-1*a:a)}:{x:e+-1*o,y:t+-1*a}:2===n?i.curY>=1&&r.curY<=0?{x:e+(i.x<.5?-1*o:o),y:t}:i.curX>=1&&r.curX<=0?{x:e,y:t+(i.y<.5?-1*a:a)}:{x:e+o,y:t+-1*a}:3===n?i.curY>=1&&r.curY<=0?{x:e+(i.x<.5?-1*o:o),y:t}:i.curX<=0&&r.curX>=1?{x:e,y:t+(i.y<.5?-1*a:a)}:{x:e+-1*o,y:t+-1*a}:4===n?i.curY<=0&&r.curY>=1?{x:e+(i.x<.5?-1*o:o),y:t}:i.curX<=0&&r.curX>=1?{x:e,y:t+(i.y<.5?-1*a:a)}:{x:e+o,y:t+-1*a}:void 0}(_,m,E,t.sourcePos,t.targetPos,this.curviness,this.curviness,P,this.proximityLimit)}else this._controlPoint=this.geometry.controlPoints[0];a=this._controlPoint.x,l=this._controlPoint.x,u=this._controlPoint.y,h=this._controlPoint.y,this.geometry={controlPoints:[this._controlPoint,this._controlPoint],source:t.sourcePos,target:t.targetPos},this._addSegment(zr,{x1:v,y1:g,x2:d,y2:p,cp1x:a,cp1y:u,cp2x:l,cp2y:h})}}]),StateMachineConnector}(Dr);function sgn(e){return e<0?-1:0===e?0:1}function segmentDirections(e){return[sgn(e[2]-e[0]),sgn(e[3]-e[1])]}function segLength(e){return Math.sqrt(Math.pow(e[0]-e[2],2)+Math.pow(e[1]-e[3],2))}function _cloneArray(e){var t=[];return t.push.apply(t,e),t}_defineProperty(Rr,"type","StateMachine"),hr.register(Fr.type,Fr),hr.register(Rr.type,Rr);var Br=function(e){_inherits(FlowchartConnector,e);var t=_createSuper(FlowchartConnector);function FlowchartConnector(e,n){var i;return _classCallCheck(this,FlowchartConnector),(i=t.call(this,e,n)).connection=e,_defineProperty(_assertThisInitialized(i),"type",FlowchartConnector.type),_defineProperty(_assertThisInitialized(i),"internalSegments",[]),_defineProperty(_assertThisInitialized(i),"midpoint",void 0),_defineProperty(_assertThisInitialized(i),"alwaysRespectStubs",void 0),_defineProperty(_assertThisInitialized(i),"cornerRadius",void 0),_defineProperty(_assertThisInitialized(i),"lastx",void 0),_defineProperty(_assertThisInitialized(i),"lasty",void 0),_defineProperty(_assertThisInitialized(i),"lastOrientation",void 0),_defineProperty(_assertThisInitialized(i),"loopbackRadius",void 0),_defineProperty(_assertThisInitialized(i),"isLoopbackCurrently",void 0),i.midpoint=null==n.midpoint||isNaN(n.midpoint)?.5:n.midpoint,i.cornerRadius=null!=n.cornerRadius?n.cornerRadius:0,i.alwaysRespectStubs=!0===n.alwaysRespectStubs,i.lastx=null,i.lasty=null,i.lastOrientation=null,i.loopbackRadius=n.loopbackRadius||25,i.isLoopbackCurrently=!1,i}return _createClass(FlowchartConnector,[{key:"getDefaultStubs",value:function getDefaultStubs(){return[30,30]}},{key:"addASegment",value:function addASegment(e,t,n){if(this.lastx!==e||this.lasty!==t){var i=null==this.lastx?n.sx:this.lastx,r=null==this.lasty?n.sy:this.lasty,o=i===e?"v":"h";this.lastx=e,this.lasty=t,this.internalSegments.push([i,r,e,t,o])}}},{key:"writeSegments",value:function writeSegments(e){for(var t,n,i,r=null,o=0;o<this.internalSegments.length-1;o++){if(r=r||_cloneArray(this.internalSegments[o]),t=_cloneArray(this.internalSegments[o+1]),n=segmentDirections(r),i=segmentDirections(t),this.cornerRadius>0&&r[4]!==t[4]){var a=Math.min(segLength(r),segLength(t)),l=Math.min(this.cornerRadius,a/2);r[2]-=n[0]*l,r[3]-=n[1]*l,t[0]+=i[0]*l,t[1]+=i[1]*l;var u=n[1]===i[0]&&1===i[0]||n[1]===i[0]&&0===i[0]&&n[0]!==i[1]||n[1]===i[0]&&-1===i[0],h=(t[1]>r[3]?1:-1)===(t[0]>r[2]?1:-1),d=h&&u||!h&&!u?t[0]:r[2],p=h&&u||!h&&!u?r[3]:t[1];this._addSegment(dr,{x1:r[0],y1:r[1],x2:r[2],y2:r[3]}),this._addSegment(Or,{r:l,x1:r[2],y1:r[3],x2:t[0],y2:t[1],cx:d,cy:p,ac:u})}else this._addSegment(dr,{x1:r[0],y1:r[1],x2:r[2],y2:r[3]});r=t}null!=t&&this._addSegment(dr,{x1:t[0],y1:t[1],x2:t[2],y2:t[3]})}},{key:"_compute",value:function _compute(e,t){var n=this;this.internalSegments.length=0,this.lastx=null,this.lasty=null,this.lastOrientation=null;var i=function commonStubCalculator(t){return[e.startStubX,e.startStubY,e.endStubX,e.endStubY]},r={perpendicular:i,orthogonal:i,opposite:function opposite(t){var i=e,r="x"===t?0:1,o={x:function x(){return 1===i.so[r]&&(i.startStubX>i.endStubX&&i.tx>i.startStubX||i.sx>i.endStubX&&i.tx>i.sx)||-1===i.so[r]&&(i.startStubX<i.endStubX&&i.tx<i.startStubX||i.sx<i.endStubX&&i.tx<i.sx)},y:function y(){return 1===i.so[r]&&(i.startStubY>i.endStubY&&i.ty>i.startStubY||i.sy>i.endStubY&&i.ty>i.sy)||-1===i.so[r]&&(i.startStubY<i.endStubY&&i.ty<i.startStubY||i.sy<i.endStubY&&i.ty<i.sy)}};return!n.alwaysRespectStubs&&o[t]()?{x:[(e.sx+e.tx)/2,e.startStubY,(e.sx+e.tx)/2,e.endStubY],y:[e.startStubX,(e.sy+e.ty)/2,e.endStubX,(e.sy+e.ty)/2]}[t]:[e.startStubX,e.startStubY,e.endStubX,e.endStubY]}},o=r[e.anchorOrientation](e.sourceAxis),a="x"===e.sourceAxis?0:1,l="x"===e.sourceAxis?1:0,u=o[a],h=o[l],d=o[a+2],p=o[l+2];this.addASegment(o[0],o[1],e);var v=e.startStubX+(e.endStubX-e.startStubX)*this.midpoint,g=e.startStubY+(e.endStubY-e.startStubY)*this.midpoint,_={x:[0,1],y:[1,0]},m={perpendicular:function perpendicular(t,n,i,r,o){var a=e,l={x:[[a.startStubX,a.endStubX],null,[a.endStubX,a.startStubX]],y:[[a.startStubY,a.endStubY],null,[a.endStubY,a.startStubY]]},u={x:[[v,a.startStubY],[v,a.endStubY]],y:[[a.startStubX,g],[a.endStubX,g]]},h={x:[[a.endStubX,a.startStubY]],y:[[a.startStubX,a.endStubY]]},d={x:[[a.startStubX,a.endStubY],[a.endStubX,a.endStubY]],y:[[a.endStubX,a.startStubY],[a.endStubX,a.endStubY]]},p={x:[[a.startStubX,g],[a.endStubX,g],[a.endStubX,a.endStubY]],y:[[v,a.startStubY],[v,a.endStubY],[a.endStubX,a.endStubY]]},m={x:[a.startStubY,a.endStubY],y:[a.startStubX,a.endStubX]},E=_[t][0],P=_[t][1],C=a.so[E]+1,T=a.to[P]+1,b=-1===a.to[P]&&m[t][1]<m[t][0]||1===a.to[P]&&m[t][1]>m[t][0],S=l[t][C][0],k=l[t][C][1],I={x:[[[1,2,3,4],null,[2,1,4,3]],null,[[4,3,2,1],null,[3,4,1,2]]],y:[[[3,2,1,4],null,[2,3,4,1]],null,[[4,1,2,3],null,[1,4,3,2]]]}[t][C][T];return a.segment===I[3]||a.segment===I[2]&&b?u[t]:a.segment===I[2]&&k<S?h[t]:a.segment===I[2]&&k>=S||a.segment===I[1]&&!b?p[t]:a.segment===I[0]||a.segment===I[1]&&b?d[t]:void 0},orthogonal:function orthogonal(t,n,i,r,o){var a=e,l={x:-1===a.so[0]?Math.min(n,r):Math.max(n,r),y:-1===a.so[1]?Math.min(n,r):Math.max(n,r)}[t];return{x:[[l,i],[l,o],[r,o]],y:[[i,l],[o,l],[o,r]]}[t]},opposite:function opposite(i,r,o,l,u){var h=e,d={x:"y",y:"x"}[i],p={x:"h",y:"w"}[i],_=h["is"+i.toUpperCase()+"GreaterThanStubTimes2"];if(t.sourceEndpoint.elementId===t.targetEndpoint.elementId){var m=o+(1-t.sourceEndpoint._anchor.computedPosition[d])*t.sourceInfo[p]+n.maxStub;return{x:[[r,m],[l,m]],y:[[m,r],[m,l]]}[i]}return!_||1===h.so[a]&&r>l||-1===h.so[a]&&r<l?{x:[[r,g],[l,g]],y:[[v,r],[v,l]]}[i]:1===h.so[a]&&r<l||-1===h.so[a]&&r>l?{x:[[v,h.sy],[v,h.ty]],y:[[h.sx,g],[h.tx,g]]}[i]:void 0}},E=m[e.anchorOrientation](e.sourceAxis,u,h,d,p);if(E)for(var P=0;P<E.length;P++)this.addASegment(E[P][0],E[P][1],e);this.addASegment(o[2],o[3],e),this.addASegment(e.tx,e.ty,e),this.writeSegments(e)}},{key:"transformGeometry",value:function transformGeometry(e,t,n){return e}}]),FlowchartConnector}(Bi);_defineProperty(Br,"type","Flowchart"),hr.register(Br.type,Br),Wn.registerHandler(Ki),Wn.registerHandler(_r),Wn.registerHandler(Pr),hr.register(pr.type,pr);for(var Hr={clientX:5e4,clientY:5e4,screenX:5e4,screenY:5e4,pageX:5e4,pageY:5e4},Vr=[],Ur=0;Ur<256;Ur++)Vr[Ur]=(Ur<16?"0":"")+Ur.toString(16);var Yr=function(){function BrowserUITestSupport(e,t,n){_classCallCheck(this,BrowserUITestSupport),this._jsPlumb=e,this.ok=t,this.equal=n,_defineProperty(this,"_divs",[]),_defineProperty(this,"mottle",void 0),this.mottle=new $t}return _createClass(BrowserUITestSupport,[{key:"_t",value:function _t(e,t,n,i){this.mottle.trigger(e,t,{pageX:n,pageY:i,screenX:n,screenY:i,clientX:n,clientY:i})}},{key:"addDiv",value:function addDiv(e,t,n,i,r,o,a){var l=document.createElement("div");return l.style.position="absolute",l.innerHTML=e,t?t.appendChild(l):this._jsPlumb.getContainer().appendChild(l),l.setAttribute("id",e),l.style.left=(null!=i?i:Math.floor(1e3*Math.random()))+"px",l.style.top=(null!=r?r:Math.floor(1e3*Math.random()))+"px",n&&(l.className=n),o&&(l.style.width=o+"px"),a&&(l.style.height=a+"px"),this._divs.push(e),l}},{key:"addDivs",value:function addDivs(e,t){for(var n=0;n<e.length;n++)this.addDiv(e[n],t)}},{key:"assertEndpointCount",value:function assertEndpointCount(e,t){var n=this._jsPlumb.getEndpoints(e),i=n?n.length:0;this.equal(i,t,e.getAttribute("data-jtk-managed")+" has "+t+(t>1||0==t?" endpoints":" endpoint"))}},{key:"_assertManagedEndpointCount",value:function _assertManagedEndpointCount(e,t){var n=this._jsPlumb.getId(e),i=this._jsPlumb._managedElements[n];this.equal(i.endpoints.length,t,n+" has "+t+" endpoints in managed record")}},{key:"_assertManagedConnectionCount",value:function _assertManagedConnectionCount(e,t){var n=this._jsPlumb.getId(e),i=this._jsPlumb._managedElements[n];this.equal(i.connections.length,t,n+" has "+t+" connections in managed record")}},{key:"_registerDiv",value:function _registerDiv(e){this._divs.push(e)}},{key:"makeDragStartEvt",value:function makeDragStartEvt(e){var t=this.makeEvent(e),n=this._jsPlumb.getContainer();return t.clientX+=n.offsetLeft,t.screenX+=n.offsetLeft,t.pageX+=n.offsetLeft,t.clientY+=n.offsetTop,t.screenY+=n.offsetTop,t.pageY+=n.offsetTop,t}},{key:"getAttribute",value:function getAttribute(e,t){return e.getAttribute(t)}},{key:"dragNodeBy",value:function dragNodeBy(e,t,n,i){(i=i||{}).before&&i.before();var r=this.makeEvent(e);this._jsPlumb.trigger(e,Ne,r),i.beforeMouseMove&&i.beforeMouseMove(),this._t(document,Re,r.pageX+t,r.pageY+n),i.beforeMouseUp&&i.beforeMouseUp(),this.mottle.trigger(document,Be,null),i.after&&i.after()}},{key:"dragNodeTo",value:function dragNodeTo(e,t,n,i){i=i||{};var r=this._jsPlumb.viewport.getPosition(this._jsPlumb.getId(e));i.before&&i.before();var o=this.makeEvent(e);this._jsPlumb.trigger(e,Ne,o);var a=this._jsPlumb.getContainer().getBoundingClientRect();i.beforeMouseMove&&i.beforeMouseMove(),this._t(document,Re,a.x+t+r.w/2,a.y+n+r.h/2),i.beforeMouseUp&&i.beforeMouseUp(),this.mottle.trigger(document,Be,null),i.after&&i.after()}},{key:"dragToGroup",value:function dragToGroup(e,t,n){var i=this._jsPlumb.getGroup(t),r=this._jsPlumb.viewport.getPosition(i.elId),o=r.x+r.w/2,a=r.y+r.h/2;this.dragNodeTo(e,o,a,n)}},{key:"aSyncDragNodeBy",value:function aSyncDragNodeBy(e,t,n,i){var r=this;(i=i||{}).before&&i.before();var o=this.makeEvent(e);this._jsPlumb.trigger(e,Ne,o),i.beforeMouseMove&&i.beforeMouseMove(),setTimeout((function(){r._t(document,Re,o.pageX+t,o.pageY+n),i.beforeMouseUp&&i.beforeMouseUp(),setTimeout((function(){r.mottle.trigger(document,Be,null),i.after&&i.after()}),45)}),45)}},{key:"dragANodeAround",value:function dragANodeAround(e,t,n){this._jsPlumb.trigger(e,Ne,this.makeEvent(e));for(var i,r,o=50*Math.random(),a=0;a<o;a++){var l=(i=void 0,r=void 0,i=Math.floor(2e3*Math.random()),r=Math.floor(2e3*Math.random()),{clientX:i,clientY:r,screenX:i,screenY:r,pageX:i,pageY:r});e.style.left=l.screenX+"px",e.style.top=l.screenY+"px",this._jsPlumb.trigger(document,Re,l)}t&&this.ok(t(),n||"while dragging assert"),this._jsPlumb.trigger(document,Be,Hr)}},{key:"dragConnection",value:function dragConnection(e,t,n,i){var r=this.getCanvas(e),o=this.getCanvas(t),a=this.makeEvent(r),l=this.makeEvent(o);i=i||{};var u=this._jsPlumb.select().length;return this._jsPlumb.trigger(r,Ne,a),i.beforeMouseMove&&i.beforeMouseMove(),this._jsPlumb.trigger(n?o:document,Re,l),i.beforeMouseUp&&i.beforeMouseUp(),this._jsPlumb.trigger(n?o:document,Be,l),this._jsPlumb.select().get(u)}},{key:"aSyncDragConnection",value:function aSyncDragConnection(e,t,n){var i=this;n=n||{};var r=this.getCanvas(e),o=this.getCanvas(t),a=this.makeEvent(r),l=this.makeEvent(o),u=this._jsPlumb.select().length;this._jsPlumb.trigger(r,Ne,a),setTimeout((function(){n.beforeMouseMove&&n.beforeMouseMove(),i._jsPlumb.trigger(document,Re,l),setTimeout((function(){n.beforeMouseUp&&n.beforeMouseUp(),i._jsPlumb.trigger(o,Be,l),n.after&&n.after(i._jsPlumb.select().get(u))}),5)}),5)}},{key:"dragAndAbortConnection",value:function dragAndAbortConnection(e){var t=this.getCanvas(e),n=this.makeEvent(t);this._jsPlumb.trigger(t,Ne,n),this._jsPlumb.trigger(document,Re,Hr),this._jsPlumb.trigger(document,Be,Hr)}},{key:"detachConnection",value:function detachConnection(e,t){t=t||{};var n=this.getEndpointCanvas(e),i=this.makeEvent(n);t.before&&t.before(),this._jsPlumb.trigger(n,Ne,i),t.beforeMouseMove&&t.beforeMouseMove(),this._jsPlumb.trigger(document,Re,Hr),t.beforeMouseUp&&t.beforeMouseUp(),this._jsPlumb.trigger(document,Be,Hr),t.after&&t.after()}},{key:"detachAndReattachConnection",value:function detachAndReattachConnection(e,t){t=t||{};var n=this.getEndpointCanvas(e),i=this.makeEvent(n);t.before&&t.before(),this._jsPlumb.trigger(n,Ne,i),t.beforeMouseMove&&t.beforeMouseMove(),this._jsPlumb.trigger(document,Re,Hr),this._jsPlumb.trigger(document,Re,i),t.beforeMouseUp&&t.beforeMouseUp(),this._jsPlumb.trigger(document,Be,i),t.after&&t.after()}},{key:"detachConnectionByTarget",value:function detachConnectionByTarget(e,t){this.detachConnection(e.endpoints[1],t)}},{key:"relocateTarget",value:function relocateTarget(e,t,n){this.relocate(e,1,t,n)}},{key:"relocate",value:function relocate(e,t,n,i){i=i||{},n=this.getCanvas(n);var r=this.getEndpointCanvas(e.endpoints[t]),o=this.makeEvent(r),a=this.makeEvent(n);i.before&&i.before(),this._jsPlumb.trigger(r,Ne,o),i.beforeMouseMove&&i.beforeMouseMove(),this._jsPlumb.trigger(document,Re,a),i.beforeMouseUp&&i.beforeMouseUp(),this._jsPlumb.trigger(n,Be,a),i.after&&i.after()}},{key:"relocateSource",value:function relocateSource(e,t,n){this.relocate(e,0,t,n)}},{key:"makeEvent",value:function makeEvent(e){var t=e.getBoundingClientRect(),n=t.x+t.width/2,i=t.y+t.height/2;return{clientX:n,clientY:i,screenX:n,screenY:i,pageX:n,pageY:i}}},{key:"getCanvas",value:function getCanvas(e){return e.endpoint?this.getEndpointCanvas(e):e}},{key:"getEndpointCanvas",value:function getEndpointCanvas(e){return e.endpoint.canvas}},{key:"getConnectionCanvas",value:function getConnectionCanvas(e){return e.connector.canvas}},{key:"getEndpointCanvasPosition",value:function getEndpointCanvasPosition(e){var t=this.getEndpointCanvas(e);return{x:parseInt(t.style.left,10),y:parseInt(t.style.top,10),w:t.getAttribute("width"),h:t.getAttribute("height")}}},{key:"within",value:function within(e,t,n){this.ok(Math.abs(e-t)<1e-11,n+"[expected: "+t+" got "+e+"] [diff:"+Math.abs(e-t)+"]")}},{key:"assertManagedEndpointCount",value:function assertManagedEndpointCount(e,t){var n=this._jsPlumb.getId(e),i=this._jsPlumb._managedElements[n];this.equal(i.endpoints.length,t,n+" has "+t+" endpoints in managed record")}},{key:"assertManagedConnectionCount",value:function assertManagedConnectionCount(e,t){var n=this._jsPlumb.getId(e),i=this._jsPlumb._managedElements[n];this.equal(i.connections.length,t,n+" has "+t+" connections in managed record")}},{key:"fireEventOnEndpoint",value:function fireEventOnEndpoint(e){for(var t=this.getEndpointCanvas(e),n=0;n<(arguments.length<=1?0:arguments.length-1);n++)this._jsPlumb.trigger(t,n+1<1||arguments.length<=n+1?void 0:arguments[n+1])}},{key:"fireEventOnElement",value:function fireEventOnElement(e){for(var t=0;t<(arguments.length<=1?0:arguments.length-1);t++)this._jsPlumb.trigger(e,t+1<1||arguments.length<=t+1?void 0:arguments[t+1])}},{key:"fireEventOnConnection",value:function fireEventOnConnection(e){for(var t=this.getConnectionCanvas(e),n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];this.fireEventOnElement.apply(this,[t].concat(i))}},{key:"clickOnConnection",value:function clickOnConnection(e){this.fireEventOnConnection(e,we)}},{key:"dblClickOnConnection",value:function dblClickOnConnection(e){this.fireEventOnConnection(e,Le)}},{key:"tapOnConnection",value:function tapOnConnection(e){this.fireEventOnConnection(e,Ne),this.fireEventOnConnection(e,Be)}},{key:"dblTapOnConnection",value:function dblTapOnConnection(e){this.fireEventOnConnection(e,Ne),this.fireEventOnConnection(e,Be),this.fireEventOnConnection(e,Ne),this.fireEventOnConnection(e,Be)}},{key:"clickOnElement",value:function clickOnElement(e,t){this._jsPlumb.trigger(e,we,null,null,null==t?1:t)}},{key:"dblClickOnElement",value:function dblClickOnElement(e){this._jsPlumb.trigger(e,Le)}},{key:"tapOnElement",value:function tapOnElement(e){this._jsPlumb.trigger(e,Ne),this._jsPlumb.trigger(e,Be)}},{key:"dblTapOnElement",value:function dblTapOnElement(e){this._jsPlumb.trigger(e,Ne),this._jsPlumb.trigger(e,Be),this._jsPlumb.trigger(e,Ne),this._jsPlumb.trigger(e,Be)}},{key:"getOverlayCanvas",value:function getOverlayCanvas(e){return e.canvas||e.path}},{key:"fireEventOnOverlay",value:function fireEventOnOverlay(e,t,n){var i=e.getOverlay(t),r=this.getOverlayCanvas(i);this._jsPlumb.trigger(r,n)}},{key:"clickOnOverlay",value:function clickOnOverlay(e,t){this.fireEventOnOverlay(e,t,we)}},{key:"dblClickOnOverlay",value:function dblClickOnOverlay(e,t){this.fireEventOnOverlay(e,t,Le)}},{key:"tapOnOverlay",value:function tapOnOverlay(e,t){this.fireEventOnOverlay(e,t,Ne),this.fireEventOnOverlay(e,t,Be)}},{key:"dblTapOnOverlay",value:function dblTapOnOverlay(e,t){this.fireEventOnOverlay(e,t,Ne),this.fireEventOnOverlay(e,t,Be),this.fireEventOnOverlay(e,t,Ne),this.fireEventOnOverlay(e,t,Be)}},{key:"cleanup",value:function cleanup(){var e=this._jsPlumb.getContainer();for(var t in this._jsPlumb.destroy(),this._divs){var n=document.getElementById(this._divs[t]);n&&n.parentNode.removeChild(n)}this._divs.length=0;var i=this._jsPlumb.select().length,r=this._jsPlumb.selectEndpoints().length,o=e.querySelectorAll(".jtk-endpoint").length,a=e.querySelectorAll(".jtk-connector").length;for(var l in e.__ta)for(var u in e.__ta[l])throw"Container event bindings not empty for key "+l;if(i>0)throw"there are connections in the data model!";if(r>0)throw"there are endpoints in the data model!";if(o>0)throw"there are "+o+" endpoints left in the dom!";if(a>0)throw"there are "+a+" connections left in the dom!"}},{key:"makeContent",value:function makeContent(e){var t=document.createElement("div");return t.innerHTML=e,t.firstChild}},{key:"length",value:function length(e){var t=0;for(var n in e)e.hasOwnProperty(n)&&t++;return t}},{key:"head",value:function head(e){for(var t in e)return e[t]}},{key:"uuid",value:function uuid$1(){return uuid()}}]),BrowserUITestSupport}();var Xr=0;e.ABSOLUTE=u,e.ADD_CLASS_ACTION="add",e.ATTRIBUTE_CONTAINER=Te,e.ATTRIBUTE_GROUP=p,e.ATTRIBUTE_GROUP_CONTENT=be,e.ATTRIBUTE_JTK_ENABLED=Se,e.ATTRIBUTE_JTK_SCOPE=ke,e.ATTRIBUTE_MANAGED=v,e.ATTRIBUTE_NOT_DRAGGABLE=g,e.ATTRIBUTE_SCOPE=m,e.ATTRIBUTE_SCOPE_PREFIX=E,e.ATTRIBUTE_TABINDEX=_,e.ATTR_SCROLLABLE_LIST=br,e.AbstractBezierConnector=Dr,e.AbstractConnector=Bi,e.AbstractSegment=jt,e.ArcSegment=Or,e.ArrowOverlay=Hi,e.BLOCK=a,e.BOTTOM=Zn,e.BezierConnector=Fr,e.BezierSegment=zr,e.BlankEndpoint=mr,e.BlankEndpointHandler=Pr,e.BrowserJsPlumbInstance=vr,e.BrowserUITestSupport=Yr,e.CHECK_CONDITION=P,e.CHECK_DROP_ALLOWED=C,e.CLASS_CONNECTED=S,e.CLASS_CONNECTOR=T,e.CLASS_CONNECTOR_OUTLINE=b,e.CLASS_DELEGATED_DRAGGABLE=Dn,e.CLASS_DRAGGABLE=wn,e.CLASS_DRAGGED=jn,e.CLASS_DRAG_ACTIVE=Gn,e.CLASS_DRAG_CONTAINER=Mn,e.CLASS_DRAG_HOVER=Nn,e.CLASS_ENDPOINT=k,e.CLASS_ENDPOINT_ANCHOR_PREFIX=M,e.CLASS_ENDPOINT_CONNECTED=I,e.CLASS_ENDPOINT_DROP_ALLOWED=D,e.CLASS_ENDPOINT_DROP_FORBIDDEN=w,e.CLASS_ENDPOINT_FLOATING=O,e.CLASS_ENDPOINT_FULL=A,e.CLASS_GHOST_PROXY=Ln,e.CLASS_GROUP_COLLAPSED=L,e.CLASS_GROUP_EXPANDED=G,e.CLASS_OVERLAY=j,e.CONNECTION=Oe,e.Collicat=In,e.Component=Mi,e.Connection=zi,e.ConnectionDragSelector=pi,e.ConnectionSelection=nr,e.Connectors=hr,e.CustomOverlay=Yi,e.DEFAULT=zt,e.DEFAULT_KEY_ALLOW_NESTED_GROUPS=Xi,e.DEFAULT_KEY_ANCHOR="anchor",e.DEFAULT_KEY_ANCHORS="anchors",e.DEFAULT_KEY_CONNECTIONS_DETACHABLE="connectionsDetachable",e.DEFAULT_KEY_CONNECTION_OVERLAYS="connectionOverlays",e.DEFAULT_KEY_CONNECTOR="connector",e.DEFAULT_KEY_CONTAINER="container",e.DEFAULT_KEY_ENDPOINT="endpoint",e.DEFAULT_KEY_ENDPOINTS="endpoints",e.DEFAULT_KEY_ENDPOINT_HOVER_STYLE="endpointHoverStyle",e.DEFAULT_KEY_ENDPOINT_HOVER_STYLES="endpointHoverStyles",e.DEFAULT_KEY_ENDPOINT_OVERLAYS="endpointOverlays",e.DEFAULT_KEY_ENDPOINT_STYLE="endpointStyle",e.DEFAULT_KEY_ENDPOINT_STYLES="endpointStyles",e.DEFAULT_KEY_HOVER_CLASS="hoverClass",e.DEFAULT_KEY_HOVER_PAINT_STYLE="hoverPaintStyle",e.DEFAULT_KEY_LIST_STYLE="listStyle",e.DEFAULT_KEY_MAX_CONNECTIONS="maxConnections",e.DEFAULT_KEY_PAINT_STYLE=Wi,e.DEFAULT_KEY_REATTACH_CONNECTIONS="reattachConnections",e.DEFAULT_KEY_SCOPE=qi,e.DEFAULT_LIST_OPTIONS=Tr,e.DiamondOverlay=Vi,e.DotEndpoint=Ji,e.DotEndpointHandler=Ki,e.Drag=Sn,e.DragManager=zn,e.ELEMENT=Ae,e.ELEMENT_DIV=De,e.EMPTY_BOUNDS=EMPTY_BOUNDS,e.ENDPOINT=Ie,e.ERROR_SOURCE_DOES_NOT_EXIST=de,e.ERROR_SOURCE_ENDPOINT_FULL=ue,e.ERROR_TARGET_DOES_NOT_EXIST=pe,e.ERROR_TARGET_ENDPOINT_FULL=he,e.EVENT_ANCHOR_CHANGED=N,e.EVENT_BEFORE_START=rn,e.EVENT_CLICK=we,e.EVENT_CONNECTION=z,e.EVENT_CONNECTION_ABORT=Ze,e.EVENT_CONNECTION_CLICK=mt,e.EVENT_CONNECTION_CONTEXTMENU=St,e.EVENT_CONNECTION_DBL_CLICK=Et,e.EVENT_CONNECTION_DBL_TAP=Pt,e.EVENT_CONNECTION_DETACHED=R,e.EVENT_CONNECTION_DRAG=Qe,e.EVENT_CONNECTION_MOUSEDOWN=bt,e.EVENT_CONNECTION_MOUSEOUT=Ct,e.EVENT_CONNECTION_MOUSEOVER=xt,e.EVENT_CONNECTION_MOUSEUP=Tt,e.EVENT_CONNECTION_MOVED=B,e.EVENT_CONNECTION_TAP=kt,e.EVENT_CONTAINER_CHANGE=H,e.EVENT_CONTEXTMENU=Me,e.EVENT_DBL_CLICK=Le,e.EVENT_DBL_TAP=Ge,e.EVENT_DRAG=sn,e.EVENT_DRAG_MOVE=qe,e.EVENT_DRAG_START=Ke,e.EVENT_DRAG_STOP=Je,e.EVENT_DROP=an,e.EVENT_ELEMENT_CLICK=et,e.EVENT_ELEMENT_CONTEXTMENU=lt,e.EVENT_ELEMENT_DBL_CLICK=tt,e.EVENT_ELEMENT_DBL_TAP=nt,e.EVENT_ELEMENT_MOUSE_DOWN=at,e.EVENT_ELEMENT_MOUSE_MOVE=ot,e.EVENT_ELEMENT_MOUSE_OUT=it,e.EVENT_ELEMENT_MOUSE_OVER=rt,e.EVENT_ELEMENT_MOUSE_UP=st,e.EVENT_ELEMENT_TAP=ct,e.EVENT_ENDPOINT_CLICK=ut,e.EVENT_ENDPOINT_DBL_CLICK=ht,e.EVENT_ENDPOINT_DBL_TAP=dt,e.EVENT_ENDPOINT_MOUSEDOWN=vt,e.EVENT_ENDPOINT_MOUSEOUT=pt,e.EVENT_ENDPOINT_MOUSEOVER=ft,e.EVENT_ENDPOINT_MOUSEUP=yt,e.EVENT_ENDPOINT_REPLACED=V,e.EVENT_ENDPOINT_TAP=gt,e.EVENT_FOCUS=je,e.EVENT_GROUP_ADDED=W,e.EVENT_GROUP_COLLAPSE=q,e.EVENT_GROUP_EXPAND=J,e.EVENT_GROUP_MEMBER_ADDED=K,e.EVENT_GROUP_MEMBER_REMOVED=$,e.EVENT_GROUP_REMOVED=Z,e.EVENT_INTERNAL_CONNECTION=F,e.EVENT_INTERNAL_CONNECTION_DETACHED=Y,e.EVENT_INTERNAL_ENDPOINT_UNREGISTERED=U,e.EVENT_MANAGE_ELEMENT=X,e.EVENT_MAX_CONNECTIONS=Q,e.EVENT_MOUSEDOWN=Ne,e.EVENT_MOUSEENTER=ze,e.EVENT_MOUSEEXIT=Fe,e.EVENT_MOUSEMOVE=Re,e.EVENT_MOUSEOUT=He,e.EVENT_MOUSEOVER=Ve,e.EVENT_MOUSEUP=Be,e.EVENT_NESTED_GROUP_ADDED=ee,e.EVENT_NESTED_GROUP_REMOVED=te,e.EVENT_OUT="out",e.EVENT_OVER=ln,e.EVENT_REVERT=$e,e.EVENT_SCROLL=kr,e.EVENT_START=nn,e.EVENT_STOP=cn,e.EVENT_TAP=Ue,e.EVENT_TOUCHEND=Xe,e.EVENT_TOUCHMOVE=We,e.EVENT_TOUCHSTART=Ye,e.EVENT_UNMANAGE_ELEMENT=ne,e.EVENT_ZOOM=ie,e.ElementDragHandler=Vn,e.Endpoint=Gi,e.EndpointFactory=Wn,e.EndpointRepresentation=qn,e.EndpointSelection=tr,e.EventGenerator=xi,e.EventManager=$t,e.FALSE=Rt,e.FIXED=h,e.FlowchartConnector=Br,e.GroupManager=Qi,e.INTERCEPT_BEFORE_DETACH=ae,e.INTERCEPT_BEFORE_DRAG=oe,e.INTERCEPT_BEFORE_DROP=se,e.INTERCEPT_BEFORE_START_DETACH=le,e.IS_DETACH_ALLOWED=re,e.JsPlumbInstance=fr,e.JsPlumbList=Ar,e.JsPlumbListManager=Ir,e.KEY_CONNECTION_OVERLAYS=fe,e.LEFT=Kn,e.LabelOverlay=Ii,e.LightweightFloatingAnchor=ti,e.LightweightRouter=cr,e.NONE=l,e.OptimisticEventGenerator=Ti,e.Overlay=bi,e.OverlayFactory=ki,e.PROPERTY_POSITION=It,e.PlainArrowOverlay=Ui,e.REDROP_POLICY_ANY="any",e.REDROP_POLICY_ANY_SOURCE=yi,e.REDROP_POLICY_ANY_SOURCE_OR_TARGET=gi,e.REDROP_POLICY_ANY_TARGET=vi,e.REDROP_POLICY_STRICT=fi,e.REMOVE_CLASS_ACTION="remove",e.RIGHT=$n,e.RectangleEndpoint=gr,e.RectangleEndpointHandler=_r,e.SELECTOR_CONNECTOR=At,e.SELECTOR_ENDPOINT=Ot,e.SELECTOR_GROUP=Dt,e.SELECTOR_GROUP_CONTAINER=wt,e.SELECTOR_MANAGED_ELEMENT=ce,e.SELECTOR_OVERLAY=Mt,e.SELECTOR_SCROLLABLE_LIST=Sr,e.SOURCE=r,e.SOURCE_INDEX=0,e.STATIC=d,e.StateMachineConnector=Rr,e.StraightConnector=pr,e.StraightSegment=dr,e.TARGET=o,e.TARGET_INDEX=1,e.TOP=Jn,e.TRUE=Ft,e.TWO_PI=en,e.UIGroup=Zi,e.UINode=$i,e.UNDEFINED=Nt,e.Viewport=ar,e.WILDCARD=Bt,e.X_AXIS_FACES=Qn,e.Y_AXIS_FACES=ei,e._createPerimeterAnchor=_createPerimeterAnchor,e._removeTypeCssHelper=_removeTypeCssHelper,e._updateHoverStyle=_updateHoverStyle,e.add=function add(e,t){return{x:e.x+t.x,y:e.y+t.y}},e.addClass=addClass,e.addToDictionary=addToDictionary,e.addToList=function addToList(e,t,n,i){var r=e.get(t);return null==r&&(r=[],e.set(t,r)),r[i?"unshift":"push"](n),r},e.addWithFunction=function addWithFunction(e,t,n){-1===findWithFunction(e,n)&&e.push(t)},e.arraysEqual=arraysEqual,e.att=att,e.bezierLineIntersection=bezierLineIntersection,e.boundingBoxIntersection=function boundingBoxIntersection(e,t){var n=[];return n.push.apply(n,bezierLineIntersection(e.x,e.y,e.x+e.w,e.y,t)),n.push.apply(n,bezierLineIntersection(e.x+e.w,e.y,e.x+e.w,e.y+e.h,t)),n.push.apply(n,bezierLineIntersection(e.x+e.w,e.y+e.h,e.x,e.y+e.h,t)),n.push.apply(n,bezierLineIntersection(e.x,e.y+e.h,e.x,e.y,t)),n},e.boxIntersection=function boxIntersection(e,t,n,i,r){var o=[];return o.push.apply(o,bezierLineIntersection(e,t,e+n,t,r)),o.push.apply(o,bezierLineIntersection(e+n,t,e+n,t+i,r)),o.push.apply(o,bezierLineIntersection(e+n,t+i,e,t+i,r)),o.push.apply(o,bezierLineIntersection(e,t+i,e,t,r)),o},e.classList=classList,e.clone=clone,e.cls=cls,e.compoundEvent=compoundEvent,e.computeBezierLength=computeBezierLength,e.consume=consume,e.convertToFullOverlaySpec=convertToFullOverlaySpec,e.createElement=createElement,e.createElementNS=createElementNS,e.createFloatingAnchor=createFloatingAnchor,e.createTestSupportInstance=function createTestSupportInstance(e,t,n){return new Yr(e,t,n)},e.createTestSupportInstanceQUnit=function createTestSupportInstanceQUnit(e){return new Yr(e,QUnit.ok,QUnit.equal)},e.dist=dist,e.distanceFromCurve=distanceFromCurve,e.each=each,e.encloses=function encloses(e,t,n){var i=e.x,r=e.x+e.w,o=e.y,a=e.y+e.h,l=t.x,u=t.x+t.w,h=t.y,d=t.y+t.h,p=function c(e,t,i,r){return n?e<=t&&i>=r:e<t&&i>r};return p(i,l,r,u)&&p(o,h,a,d)},e.extend=extend,e.fastTrim=fastTrim,e.filterList=filterList,e.filterNull=function filterNull(e){var t={};for(var n in e)null!=e[n]&&(t[n]=e[n]);return t},e.findAllWithFunction=findAllWithFunction,e.findParent=findParent,e.findWithFunction=findWithFunction,e.fixPrecision=fixPrecision,e.forEach=forEach,e.fromArray=fromArray,e.functionChain=functionChain,e.getAllWithFunction=getAllWithFunction,e.getClass=getClass,e.getDefaultFace=getDefaultFace,e.getElementPosition=getElementPosition,e.getElementSize=getElementSize,e.getElementType=getElementType,e.getEventSource=getEventSource,e.getFromSetWithFunction=getFromSetWithFunction,e.getPageLocation=function getPageLocation(e){if(null==e)return{x:0,y:0};if(null!==e.pageX)return{x:e.pageX,y:e.pageY};var t=getTouch(touches(e),0);return null!=t&&null!=t.pageX?{x:t.pageX,y:t.pageY}:{x:0,y:0}},e.getPositionOnElement=getPositionOnElement,e.getTouch=getTouch,e.getWithFunction=getWithFunction,e.getsert=getsert,e.gradient=gradient,e.gradientAtPoint=gradientAtPoint,e.gradientAtPointAlongPathFrom=function gradientAtPointAlongPathFrom(e,t,n){var i=pointAlongPath(e,t,n);return i.location>1&&(i.location=1),i.location<0&&(i.location=0),gradientAtPoint(e,i.location)},e.groupDragConstrain=groupDragConstrain,e.hasClass=hasClass,e.insertSorted=insertSorted,e.intersects=intersects,e.isArrayLike=function isArrayLike(e){return!isString(e)&&(Array.isArray(e)||isNodeList(e))},e.isArrowOverlay=isArrowOverlay,e.isAssignableFrom=isAssignableFrom,e.isBoolean=isBoolean,e.isContinuous=isContinuous,e.isCustomOverlay=isCustomOverlay,e.isDate=isDate,e.isDiamondOverlay=isDiamondOverlay,e.isDynamic=isDynamic,e.isEdgeSupported=isEdgeSupported,e.isEmpty=function isEmpty(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0},e.isFloating=_isFloating,e.isFullOverlaySpec=function isFullOverlaySpec(e){return null!=e.type&&null!=e.options},e.isFunction=isFunction,e.isInsideParent=isInsideParent,e.isLabelOverlay=isLabelOverlay,e.isMouseDevice=isMouseDevice,e.isNamedFunction=function isNamedFunction(e){return isFunction(e)&&null!=e.name&&e.name.length>0},e.isNodeList=isNodeList,e.isNumber=isNumber,e.isObject=isObject,e.isPlainArrowOverlay=isPlainArrowOverlay,e.isPoint=isPoint,e.isSVGElement=isSVGElement,e.isString=isString,e.isTouchDevice=isTouchDevice,e.lineIntersection=lineIntersection,e.lineLength=lineLength,e.lineRectangleIntersection=function lineRectangleIntersection(e,t){var n=[];return forEach([[{x:t.x,y:t.y},{x:t.x+t.w,y:t.y}],[{x:t.x+t.w,y:t.y},{x:t.x+t.w,y:t.y+t.h}],[{x:t.x,y:t.y},{x:t.x,y:t.y+t.h}],[{x:t.x,y:t.y+t.h},{x:t.x+t.w,y:t.y+t.h}]],(function(t){var i=lineIntersection(e,t);null!=i&&n.push(i)})),n},e.locationAlongCurveFrom=locationAlongCurveFrom,e.log=log,e.logEnabled=!0,e.makeLightweightAnchorFromSpec=makeLightweightAnchorFromSpec,e.map=map,e.matchesSelector=matchesSelector$1,e.merge=merge,e.nearestPointOnCurve=nearestPointOnCurve,e.newInstance=function newInstance(e){return new vr(function getInstanceIndex(){var e=Xr+1;return Xr++,e}(),e)},e.normal=normal,e.objectsEqual=objectsEqual,e.offsetRelativeToRoot=offsetRelativeToRoot,e.offsetSize=offsetSize,e.onDocumentReady=function onDocumentReady(e){!function _do(){/complete|loaded|interactive/.test(document.readyState)&&void 0!==document.body&&null!=document.body?e():setTimeout(_do,9)}()},e.pageLocation=pageLocation,e.perpendicularLineTo=perpendicularLineTo,e.perpendicularToPathAt=function perpendicularToPathAt(e,t,n,i){var r=pointAlongPath(e,t,i=null==i?0:i),o=gradientAtPoint(e,r.location),a=Math.atan(-1/o),l=n/2*Math.sin(a),u=n/2*Math.cos(a);return[{x:r.point.x+u,y:r.point.y+l},{x:r.point.x-u,y:r.point.y-l}]},e.pointAlongCurveFrom=pointAlongCurveFrom,e.pointAlongPath=pointAlongPath,e.pointOnCurve=pointOnCurve,e.pointOnLine=pointOnLine,e.populate=populate,e.quadrant=quadrant,e.ready=function ready(e){!function _do(){/complete|loaded|interactive/.test(document.readyState)&&void 0!==document.body&&null!=document.body?e():setTimeout(_do,9)}()},e.registerEndpointRenderer=registerEndpointRenderer,e.remove=remove,e.removeClass=removeClass,e.removeWithFunction=removeWithFunction,e.replace=function replace(e,t,n){if(null!=e){var i=e;return t.replace(/([^\.])+/g,(function(e,t,r,o){var a=e.match(/([^\[0-9]+){1}(\[)([0-9+])/),l=function _getArray(){return i[a[1]]||(i[a[1]]=[],i[a[1]])};if(r+e.length>=o.length)a?l()[a[3]]=n:i[e]=n;else if(a){var u=l();i=u[a[3]]||(u[a[3]]={},u[a[3]])}else i=i[e]||(i[e]={},i[e]);return""})),e}},e.rotateAnchorOrientation=function rotateAnchorOrientation(e,t){var n=rotatePoint({x:e[0],y:e[1]},{x:0,y:0},t);return[Math.round(n.x),Math.round(n.y)]},e.rotatePoint=rotatePoint,e.setForceMouseEvents=function setForceMouseEvents(e){Ut=e},e.setForceTouchEvents=function setForceTouchEvents(e){Vt=e},e.setToArray=setToArray,e.sgn=sgn$1,e.snapToGrid=snapToGrid,e.subtract=function subtract(e,t){return{x:e.x-t.x,y:e.y-t.y}},e.suggest=suggest,e.svg=Pe,e.svgWidthHeightSize=svgWidthHeightSize,e.svgXYPosition=svgXYPosition,e.theta=theta,e.toggleClass=toggleClass,e.touchCount=touchCount,e.touches=touches,e.uuid=uuid,e.wrap=wrap,Object.defineProperty(e,"__esModule",{value:!0})}));